!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.config(["$routeProvider","$locationProvider",function(t,r){t.when("/login",{templateUrl:"/views/login.html",controller:"AuthController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}]),t.run(["$location","$rootScope","AuthService",function(t,r,e){r.$watch("currentUser",function(o){r.currentUser||"/login"==t.path()||"/register"==t.path()||e.getCurrentUser()}),r.$on("$locationChangeStart",function(t,o,n){var l=o.auth;l&&!r.currentUser&&e.getCurrentUser()})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$rootScope","$location","AuthService",function(t,r,e,n){"use strict";r.currentUser=n.getCurrentUser(),t.setCurrentUser=function(t){r.currentUser=t},t.logout=function(){n.logout().then(function(){}),r.currentUser=null,e.path("/login")}}]);
angular.module("chatApp").controller("AuthController",["$scope","$location","AuthService",function(r,t,e){"use strict";r.credentials={email:"",password:""},r.formregister={error:!1},r.authenticate=function(o){e.login(o).then(function(e){r.setCurrentUser(e),t.path("/chat")},function(){r.formregister.error=!0})}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","$http","$location",function(o,t,c){"use strict";function s(c){t.get("/api/history/"+c).success(function(t){o.chatRoomName=c,o.chatLines=t})}o.chatRoomName="Lobby",t.get("/api/chatroom").success(function(t){o.chatRooms=t}),t.get("/api/history/Lobby").success(function(o){s("Lobby")}),o.reloadHistory=function(o){s(o)}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location",function(r,e,o){"use strict";r.user={email:"",username:"",password:""},r.formregister={error:!1},r.register=function(t){e.post("/users",{user:t},{headers:{"Content-Type":"application/json; charset=UTF-8"}}).success(function(){o.path("/")}).error(function(){r.formregister.error=!0})}}]);
angular.module("chatApp").factory("AuthService",["$http","$window",function(t,r){"use strict";var e={};return e.login=function(e){return t.post("/auth",e,{headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(t){return r.localStorage.currentUser=JSON.stringify(t.data),t.data})},e.logout=function(){return r.localStorage.currentUser?(r.localStorage.currentUser=null,t["delete"]("/auth")):void 0},e.getCurrentUser=function(){return r.localStorage.currentUser?JSON.parse(r.localStorage.currentUser):t.get("/auth").then(function(t){return r.localStorage.currentUser=JSON.stringify(t.data),t.data})},e}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYXV0aENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2NoYXRIaXN0b3J5Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3JlZ2lzdGVyQ29udHJvbGxlci5qcyIsInNlcnZpY2VzL2F1dGhTZXJ2aWNlLmpzIiwic2VydmljZXMvc29ja2V0U2VydmljZS5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJhdXRoIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsInJ1biIsIiRsb2NhdGlvbiIsIiRyb290U2NvcGUiLCJBdXRoU2VydmljZSIsIiR3YXRjaCIsImN1cnJlbnRVc2VyIiwicGF0aCIsImdldEN1cnJlbnRVc2VyIiwiJG9uIiwiZXZlbnQiLCJuZXh0IiwiY3VycmVudCIsInJlcXVpcmVMb2dpbiIsIiRzY29wZSIsInNldEN1cnJlbnRVc2VyIiwidXNlciIsImxvZ291dCIsInRoZW4iLCJjcmVkZW50aWFscyIsImVtYWlsIiwicGFzc3dvcmQiLCJmb3JtcmVnaXN0ZXIiLCJlcnJvciIsImF1dGhlbnRpY2F0ZSIsImxvZ2luIiwiJHdpbmRvdyIsIiRzY2UiLCJTb2NrZXRTZXJ2aWNlIiwicHJvY2Vzc1VzZXJJbnB1dCIsIm1lc3NhZ2UiLCJzeXN0ZW1NZXNzYWdlIiwiY2hhckF0IiwicHJvY2Vzc0NvbW1hbmQiLCJtZXNzYWdlcyIsInB1c2giLCJzZW5kTWVzc2FnZSIsInJvb20iLCJpbnB1dE1lc3NhZ2UiLCJ0ZXh0IiwiZW1pdCIsImNoYW5nZVJvb20iLCJuZXdSb29tIiwiY29tbWFuZCIsIndvcmRzIiwic3BsaXQiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsInNoaWZ0Iiwiam9pbiIsIm5hbWUiLCJyb29tTGlzdCIsIm5ld1Jvb21FcnJvciIsIm9uIiwicmVzdWx0Iiwic3VjY2VzcyIsInJvb21zIiwic2V0SW50ZXJ2YWwiLCJzdWJtaXQiLCJmb2N1c0NoYXRyb29tIiwiY3JlYXRlTmV3Q2hhdHJvb20iLCIkIiwibW9kYWwiLCJzYW5pdGl6ZUh0bWwiLCJ2YWx1ZSIsInRydXN0QXNIdG1sIiwiJGh0dHAiLCJnZXRIaXN0b3J5IiwiY2hhdFJvb20iLCJnZXQiLCJkYXRhIiwiY2hhdFJvb21OYW1lIiwiY2hhdExpbmVzIiwiY2hhdFJvb21zIiwicmVsb2FkSGlzdG9yeSIsInVzZXJuYW1lIiwicmVnaXN0ZXIiLCJwb3N0IiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsImZhY3RvcnkiLCJhdXRoU2VydmljZSIsInJlcyIsImxvY2FsU3RvcmFnZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYXJzZSIsInNvY2tldFNlcnZpY2UiLCJzb2NrZXQiLCJpbyIsImNvbm5lY3QiLCJldmVudE5hbWUiLCJjYWxsYmFjayIsImFyZ3MiLCJhcmd1bWVudHMiLCIkYXBwbHkiLCJhcHBseSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FFQSxZQUlBLElBQUlBLEdBQU1DLFFBQVFDLE9BQU8sV0FBWSxVQUFXLGNBR2hERixHQUFJRyxRQUFRLGlCQUFrQixvQkFBc0IsU0FBVUMsRUFBZ0JDLEdBS3hFRCxFQUNPRSxLQUFLLFVBQ05DLFlBQWEsb0JBQ2JDLFdBQVksaUJBQ1pDLE1BQU0sSUFFTEgsS0FBSyxTQUNOQyxZQUFhLG1CQUNiQyxXQUFZLGlCQUNaQyxNQUFNLElBRUxILEtBQUssWUFDTkMsWUFBYSwwQkFDYkMsV0FBWSx3QkFDWkMsTUFBTSxJQUVMSCxLQUFLLGFBQ05DLFlBQWEsdUJBQ2JDLFdBQVkscUJBQ1pDLE1BQU0sSUFHWEMsV0FBWUMsV0FBWSxjQUkvQlgsRUFBSVksS0FBSyxZQUFhLGFBQWMsY0FB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LEdBQUssU0FBVXNDLEVBQVdDLEdBQ2xDSixFQUFPbkMsR0FBR3NDLEVBQVcsV0FDZixHQUFJRSxHQUFPQyxTQUNYNUYsR0FBVzZGLE9BQU8sV0FDWkgsRUFBU0ksTUFBTVIsRUFBUUssUUFLekNOLEVBQWNoRCxLQUFPLFNBQVVvRCxFQUFXckIsRUFBTXNCLEdBQzFDSixFQUFPakQsS0FBS29ELEVBQVdyQixFQUFNLFdBQ3ZCLEdBQUl1QixHQUFPQyxTQUNYNUYsR0FBVzZGLE9BQU8sV0FDUkgsR0FDREEsRUFBU0ksTUFBTVIsRUFBUUssUUFNckNOIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtcclxuICAgIFxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG4gICAgXHJcbi8vIERlY2xhcmUgYXBwIGxldmVsIG1vZHVsZVxyXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnLCBbJ25nUm91dGUnLCAnbmdTYW5pdGl6ZSddKTtcclxuXHJcbi8vIENvbmZpZ3VyZSB0aGUgYXBwbGljYXRpb24gcm91dGVzXHJcbmFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlcicgLCBmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZW1vdmUgdGhlIGhhc2ggZnJvbSB1cmxcclxuICAgICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG4gICAgICBcclxuICAgICAgJHJvdXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLndoZW4oJy9sb2dpbicsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBdXRoQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IGZhbHNlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvY2hhdCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY2hhdC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NoYXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogdHJ1ZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL2hpc3RvcnknLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NoYXRIaXN0b3J5Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ2hhdEhpc3RvcnlDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogdHJ1ZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWdpc3Rlci5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IGZhbHNlXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICAub3RoZXJ3aXNlKHsgcmVkaXJlY3RUbzogJy9sb2dpbicgfSk7XHJcbn1dKTtcclxuXHJcbi8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWQsIGFuZCBpZiBub3Qgc2hvdyB0aGUgbG9naW4gcGFnZVxyXG5hcHAucnVuKFsnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCBBdXRoU2VydmljZSkge1xyXG4gXHJcbiAgICAgIC8vIFdhdGNoIHRoZSBjdXJyZW50VXNlciB2YXJpYWJsZSAgIFxyXG4gICAgICAkcm9vdFNjb3BlLiR3YXRjaCgnY3VycmVudFVzZXInLCBmdW5jdGlvbiAoY3VycmVudFVzZXIpIHtcclxuICAgICAgIFxyXG4gICAgICAgICAgICAvLyBJZiB0aGUgdXNlciBpcyBub3QgaW4gdGhlIHJvb3RTY29wZSBhZG4gdGhlIHBhZ2UgcmVxdWlyZXMgYXV0aCwgdHJ5IHRvIGdldCBpdFxyXG4gICAgICAgICAgICBpZiAoISRyb290U2NvcGUuY3VycmVudFVzZXIgJiYgJGxvY2F0aW9uLnBhdGgoKSAhPSBcIi9sb2dpblwiICYmICRsb2NhdGlvbi5wYXRoKCkgIT0gXCIvcmVnaXN0ZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICBBdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgICRyb290U2NvcGUuJG9uKCckbG9jYXRpb25DaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgbmV4dCwgY3VycmVudCkge1xyXG4gICAgICAgICAgICB2YXIgcmVxdWlyZUxvZ2luID0gbmV4dC5hdXRoO1xyXG4gICAgICAgICAgICBpZiAocmVxdWlyZUxvZ2luICYmICEkcm9vdFNjb3BlLmN1cnJlbnRVc2VyKSB7IFxyXG4gICAgICAgICAgICAgICAgICBBdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbn1dKTtcclxuXHJcbn0pKCk7XHJcbiIsIi8vIENvbnRhaW5lciBmb3IgdGhlIGdsb2JhbCBhcHBsaWNhdGlvbiBsb2dpYyAvIEFsdGVybmF0aXZlIHRvIHRoZSBBbmd1bGFyJ3MgcnVuIGZ1bmN0aW9uXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQXBwbGljYXRpb25Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7ICAgICAgICAgICAgXHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHRoZSBjdXJyZW50IHVzZXIgaW4gdGhlIGFwcCByb290U2NvcGUgICAgXHJcbiAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXIgPSBBdXRoU2VydmljZS5nZXRDdXJyZW50VXNlcigpO1xyXG4gICAgICAgXHJcbiAgICAgIC8vIEhlbHBlciBtZXRob2QgZm9yIHNldHRpbmcgdGhlIHVzZXIgaW4gdGhlIHJvb3RTY29wZVxyXG4gICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcclxuICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgLy8gTG9nb3V0IGZyb20gdGhlIGNoYXRcclxuICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ291dCgpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkxvZ291dCBzdWNjZXNzLlwiKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gbnVsbDtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgfTtcclxufV0pOyAiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0F1dGhDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSBjcmVkZW50aWFsc1xyXG4gICAgICAkc2NvcGUuY3JlZGVudGlhbHMgPSB7XHJcbiAgICAgICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6ICcnXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIGxvZ2luIGVycm9yIG1lc3NhZ2UgdmlzaWJpbGl0eVxyXG4gICAgICAkc2NvcGUuZm9ybXJlZ2lzdGVyID0ge1xyXG4gICAgICAgICAgICBlcnJvcjogZmFsc2VcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIEF1dGhlbnRpY2F0ZVxyXG4gICAgICAkc2NvcGUuYXV0aGVudGljYXRlID0gZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgICAgIC8vIFRyeSB0byBsb2dpbiBhbmQgc2VuZCB0aGUgYXV0aCBldmVudHMgb24gc3VjY2VzcyBhbmQgZmFpbHVyZVxyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5sb2dpbihjcmVkZW50aWFscykudGhlbihmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkxvZ2luIHN1Y2Nlc3MuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIodXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY2hhdCcpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAvLyBTaG93IHRoZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZvcm1yZWdpc3Rlci5lcnJvciA9IHRydWU7ICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxufV0pOyAiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0NoYXRDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHdpbmRvdycsICckc2NlJywgJ1NvY2tldFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkd2luZG93LCAkc2NlLCBTb2NrZXRTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgJHNjb3BlLnJvb21MaXN0ID0gW107XHJcbiAgICAgICRzY29wZS5yb29tID0gJ0xvYmJ5JztcclxuICAgICAgJHNjb3BlLmlucHV0TWVzc2FnZSA9ICcnO1xyXG4gICAgICAkc2NvcGUubmV3Um9vbSA9ICcnO1xyXG4gICAgICAkc2NvcGUubmV3Um9vbUVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IHJlc3VsdHMgb2YgYSBuYW1lLWNoYW5nZSBhdHRlbXB0XHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ25hbWVSZXN1bHQnLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICBcdHZhciBtZXNzYWdlO1xyXG4gICAgICAgICAgXHRcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnWW91IGFyZSBub3cga25vd24gYXMgJyArIHJlc3VsdC5uYW1lICsgJy4nO1xyXG4gICAgICAgICAgXHR9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlID0gcmVzdWx0Lm1lc3NhZ2U7XHJcbiAgICAgICAgICBcdH1cclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IHJlc3VsdHMgb2YgYSByb29tIGNoYW5nZSAgICAgICBcclxuICAgICAgU29ja2V0U2VydmljZS5vbignam9pblJlc3VsdCcsIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgIFx0JHNjb3BlLnJvb20gPSByZXN1bHQucm9vbTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKCdZb3UgYXJlIG5vdyBpbiB0aGUgcm9vbSAnICsgcmVzdWx0LnJvb20pO1xyXG4gICAgICB9KTsgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZWNlaXZlZCBtZXNzYWdlc1xyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCdtZXNzYWdlJywgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2gobWVzc2FnZS50ZXh0KTtcclxuICAgICAgfSk7ICAgIFx0XHRcdFxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgbGlzdCBvZiByb29tcyBhdmFpbGFibGVcclxuICAgICAgU29ja2V0U2VydmljZS5vbigncm9vbXMnLCBmdW5jdGlvbiAocm9vbXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnJvb21MaXN0ID0gW107XHJcbiAgICAgICAgICBcdGZvciAodmFyIHJvb20gaW4gcm9vbXMpIHtcclxuICAgICAgICAgICAgICAgIHJvb20gPSByb29tLnN1YnN0cmluZygxLCByb29tLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocm9vbSAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucm9vbUxpc3QucHVzaChyb29tKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgIFx0fVxyXG5cclxuICAgICAgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gUmVxdWVzdCBsaXN0IG9mIHJvb21zIGF2YWlsYWJsZSBpbnRlcm1pdHRlbnRseVxyXG4gICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgncm9vbXMnKTtcclxuICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gQWxsb3cgc3VibWl0dGluZyB0aGUgZm9ybSB0byBzZW5kIGEgY2hhdCBtZXNzYWdlXHJcbiAgICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgIFx0cHJvY2Vzc1VzZXJJbnB1dChtZXNzYWdlKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEFsbG93IGNsaWNrIGEgcm9vbSBuYW1lIHRvIGNoYW5nZSB0byB0aGF0IGNoYXRyb29tXHJcbiAgICAgICRzY29wZS5mb2N1c0NoYXRyb29tID0gZnVuY3Rpb24gKHJvb20pIHtcclxuXHRcdHByb2Nlc3NDb21tYW5kKCcvam9pbiAnICsgcm9vbSk7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaCgnUm9vbSBjaGFuZ2VkLicpO1xyXG5cdH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBDcmVhdGUgbmV3IGNoYXRyb29tXHJcbiAgICAgICRzY29wZS5jcmVhdGVOZXdDaGF0cm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcbiAgICAgICAgICAgIGlmICghcm9vbSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubmV3Um9vbUVycm9yID0gdHJ1ZTtcclxuXHQgICAgICB9IGVsc2Uge1xyXG4gICAgICBcdFx0IHByb2Nlc3NVc2VySW5wdXQoXCIvam9pbiBcIiArIHJvb20pO1xyXG4gICAgICBcdCAgXHQgJCgnI215TW9kYWwnKS5tb2RhbCgnaGlkZScpO1xyXG4gICAgICBcdFx0ICRzY29wZS5uZXdSb29tRXJyb3IgPSBmYWxzZTtcclxuICAgICAgXHR9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBTYW5peml0ZSBIdG1sXHJcbiAgICAgICRzY29wZS5zYW5pdGl6ZUh0bWwgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHZhbHVlKTtcclxuICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgLyoqXHJcbiAgICAgICAqIFByaXZhdGUgaGVscGVyc1xyXG4gICAgICAgKi9cclxuICAgICAgXHJcbiAgICAgIC8vIFByb2Nlc3MgdGhlIGlucHV0IFxyXG4gICAgICBmdW5jdGlvbiBwcm9jZXNzVXNlcklucHV0KG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdmFyIHN5c3RlbU1lc3NhZ2U7XHJcbiAgICAgICAgICBcdFxyXG4gICAgICAgICAgICAvLyBJZiB1c2VyIGlucHV0IGJlZ2lucyB3aXRoIHNsYXNoLCB0cmVhdCBpdCBhcyBjb21tYW5kXHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLmNoYXJBdCgwKSA9PSAnLycpIHtcclxuICAgICAgICAgICAgICAgICAgc3lzdGVtTWVzc2FnZSA9IHByb2Nlc3NDb21tYW5kKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAoc3lzdGVtTWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChzeXN0ZW1NZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAvLyBCcm9hZGNhc3Qgbm9uY29tbWFuZCBpbnB1dCB0byBvdGhlciB1c2Vyc1xyXG4gICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZSgkc2NvcGUucm9vbSwgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGVzY2FwYXIgZWwgc2lndWllbnRlIG1lbnNhamVcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goXCJNZTogXCIgKyBtZXNzYWdlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmlucHV0TWVzc2FnZSA9ICcnO1xyXG4gICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gU2VuZCBjaGF0IG1lc3NhZ2VzXHJcbiAgICAgIGZ1bmN0aW9uIHNlbmRNZXNzYWdlKHJvb20sIHRleHQpIHtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgIHJvb206IHJvb20sXHJcbiAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCdtZXNzYWdlJywgbWVzc2FnZSk7XHJcbiAgICAgIH1cclxuICAgICAgXHRcclxuICAgICAgLy8gQ2hhbmdlIHJvb21zXHJcbiAgICAgIGZ1bmN0aW9uIGNoYW5nZVJvb20ocm9vbSkge1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ2pvaW4nLCB7XHJcbiAgICAgICAgICAgICAgICAgIG5ld1Jvb206IHJvb21cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHRcclxuICAgICAgLy8gUHJvY2Vzc2luZyBjaGF0IGNvbW1hbmRzXHJcbiAgICAgIGZ1bmN0aW9uIHByb2Nlc3NDb21tYW5kKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgdmFyIHdvcmRzID0gY29tbWFuZC5zcGxpdCgnICcpO1xyXG4gICAgICAgICAgICAvLyBQYXJzZSBjb21tYW5kIGZyb20gZmlyc3Qgd29yZFxyXG4gICAgICAgICAgICBjb21tYW5kID0gd29yZHNbMF1cclxuICAgICAgICAgICAgICAgICAgLnN1YnN0cmluZygxLCB3b3Jkc1swXS5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGZhbHNlO1xyXG4gIFxyXG4gICAgICAgICAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgICAgICAgY2FzZSAnam9pbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb29tID0gd29yZHMuam9pbignICcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgcm9vbSBjaGFuZ2luZyAvIGNyZWF0aW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZVJvb20ocm9vbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICduaWNrJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB3b3Jkcy5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBuYW1lLWNoYW5nZSBhdHRlbXB0c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ25hbWVBdHRlbXB0JywgbmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgbWVzc2FnZSBpZiBjb21tYW5kIGlzbid0IHJlY29nbml6ZWQgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnVW5yZWNvZ25pemVkIGNvbW1hbmQuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xyXG4gICAgICB9XHJcblxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdDaGF0SGlzdG9yeUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XHJcbiAgICBcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgIFxyXG4gICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9IFwiTG9iYnlcIjtcclxuICAgXHJcbiAgICAkaHR0cC5nZXQoJy9hcGkvY2hhdHJvb20nKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsgICAgICAgIFxyXG4gICAgICAgICRzY29wZS5jaGF0Um9vbXMgPSBkYXRhO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgICRodHRwLmdldCgnL2FwaS9oaXN0b3J5L0xvYmJ5Jykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGdldEhpc3RvcnkoXCJMb2JieVwiKTsgICAgICAgIFxyXG4gICAgfSk7ICAgIFxyXG4gICAgXHJcbiAgICAkc2NvcGUucmVsb2FkSGlzdG9yeSA9IGZ1bmN0aW9uIChjaGF0Um9vbSkge1xyXG4gICAgICAgIGdldEhpc3RvcnkoY2hhdFJvb20pO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gZ2V0SGlzdG9yeShjaGF0Um9vbSkge1xyXG4gICAgICAgICRodHRwLmdldCgnL2FwaS9oaXN0b3J5LycgKyBjaGF0Um9vbSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5jaGF0Um9vbU5hbWUgPSBjaGF0Um9vbTtcclxuICAgICAgICAgICAgJHNjb3BlLmNoYXRMaW5lcyA9IGRhdGE7XHJcbiAgICAgICAgfSk7ICAgIFxyXG4gICAgfVxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdSZWdpc3RlckNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHRoZSBVc2VyXHJcbiAgICAgICRzY29wZS51c2VyID0ge1xyXG4gICAgICAgICAgICBlbWFpbDogJycsXHJcbiAgICAgICAgICAgIHVzZXJuYW1lOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6ICcnXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHJlZ2lzdHJhdGlvbiBlcnJvciBtZXNzYWdlIHZpc2liaWxpdHlcclxuICAgICAgJHNjb3BlLmZvcm1yZWdpc3RlciA9IHtcclxuICAgICAgICAgICAgZXJyb3I6IGZhbHNlXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBSZWdpc3RlciBhIG5ldyB1c2VyXHJcbiAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvdXNlcnMnLCB7ICd1c2VyJzogdXNlciB9LFxyXG4gICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PVVURi04JyB9XHJcbiAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVkaXJlY3QgdG8gdGhlIGNoYXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyB0aGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZvcm1yZWdpc3Rlci5lcnJvciA9IHRydWU7ICAgXHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxufV0pOyIsIi8vIENyZWF0ZSBhIG5ldyBzZXJ2aWNlIGZvciBBdXRoLiBcclxuLy8gUkVNRU1CRVIgdGhhdCBhbGwgc2VydmljZXMgaW4gQW5ndWxhciBhcmUgc2luZ2xldG9ucyAodGhlIGluamVjdG9yIGNhY2hlcyB0aGUgcmVmZXJlbmNlIGZvciBhbGwgZnV0dXJlIG5lZWRzKVxyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgWyckaHR0cCcsICckd2luZG93JywgZnVuY3Rpb24gKCRodHRwLCAkd2luZG93KSB7XHJcblxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcclxuICAgICBcclxuICAgICAgLy8gQVBJIExvZ2luXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luID0gZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cFxyXG4gICAgICAgICAgICAgICAgICAucG9zdCgnL2F1dGgnLCBjcmVkZW50aWFscyxcclxuICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCcgfVxyXG4gICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyID0gSlNPTi5zdHJpbmdpZnkocmVzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQVBJIExvZ291dFxyXG4gICAgICBhdXRoU2VydmljZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5jdXJyZW50VXNlciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJy9hdXRoJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHVybnMgdGhlIGN1cnJlbnQgdXNlci4gVHJ5IHRvIGdldCBpdCBmcm9tIHRoZSBzZXNzaW9uLCBhbmQgaWYgaXQgaXMgbm90IHRoZXJlIHRoZW4gaGl0IHRoZSBhcGkuXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIChKU09OLnBhcnNlKCR3aW5kb3cubG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hdXRoJykudGhlbihmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIgPSBKU09OLnN0cmluZ2lmeShyZXMuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBhdXRoU2VydmljZTtcclxufV0pOyIsIi8vIENyZWF0ZSBhIG5ldyBzZXJ2aWNlIGZvciBtYW5hZ2luZyB3ZWJzb2NrZXRzIHdpdGggc29ja2V0SW8uIFxyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ1NvY2tldFNlcnZpY2UnLCBbJyRyb290U2NvcGUnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgdmFyIHNvY2tldFNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KCk7XHJcblxyXG4gICAgICBzb2NrZXRTZXJ2aWNlLm9uID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIHNvY2tldFNlcnZpY2U7XHJcbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=