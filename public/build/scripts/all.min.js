!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.constant("ApiBaseUrl","http://localhost:3000/api"),t.config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,o){o.interceptors.push("AuthInterceptor"),t.when("/login",{templateUrl:"/views/login.html",controller:"AuthController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}]),t.run(["$route","$rootScope","$location","AuthService",function(t,e,o,r){e.$on("$locationChangeStart",function(e,l,n){var i=o.path(),h=t.routes[i];h&&h.auth&&!r.isAuthed()&&o.path("/login")})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$window","$location","AuthService",function(e,t,r,n){"use strict";e.setCurrentUser=function(e,r,n){var o={_id:e,username:n,email:r};t.localStorage.setItem("currentUser",JSON.stringify(o))},e.getCurrentUser=function(){return JSON.parse(t.localStorage.getItem("currentUser"))},e.isAuthed=function(){return null!==n.isAuthed()&&n.isAuthed()!==!1},e.logout=function(){n.logout(),t.localStorage.removeItem("currentUser"),r.path("/login")}}]);
angular.module("chatApp").controller("AuthController",["$scope","$location","AuthService",function(e,r,t){"use strict";e.credentials={email:"",password:""},e.errorMessage="",e.authenticate=function(a){t.login(a).then(function(a,n,s,o){var u=t.parseToken(a.data.token);e.setCurrentUser(u.user._id,u.user.email,u.user.username),r.path("/chat")},function(r,t,a,n){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","$http","$location","ChatHistoryService",function(e,o,r,t){"use strict";function a(o){t.getChatRoomHistory(o).then(function(r,t,a,n){e.chatRoomName=o,e.chatLines=r.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."})}e.chatRoomName="Lobby",e.errorMessage="",t.getChatRooms().then(function(o,r,t,a){e.chatRooms=o.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."}),a("Lobby"),e.reloadHistory=function(e){return a(e)}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location","UserService","AuthService",function(e,r,s,t,a){"use strict";e.user={email:"",username:"",password:""},e.errorMessage="",e.register=function(r){t.register(r).then(function(r,t,n,o){var u=a.parseToken(r.data.token);e.setCurrentUser(u.user._id,u.user.email,u.user.username),s.path("/chat")},function(r,s,t,a){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").factory("AuthInterceptor",["$q","$injector",function(e,t){return{request:function(e){var n=t.get("AuthService"),r=n.getToken();return r&&(e.headers["x-access-token"]=r),e.headers["Content-Type"]="application/json; charset=UTF-8",e},response:function(e){var n=e.data.token,r=t.get("AuthService");return n&&r.saveToken(n),e}}}]);
angular.module("chatApp").factory("AuthService",["$http","$window","ApiBaseUrl",function(e,t,n){"use strict";var o={};return o.saveToken=function(e){t.localStorage.jwtToken=e},o.getToken=function(){return t.localStorage.jwtToken},o.login=function(t){return e.post(n+"/authenticate",t)},o.logout=function(){o.getToken()&&t.localStorage.removeItem("jwtToken")},o.isAuthed=function(){var e=o.getToken();if(e){var t=o.parseToken(e),n=Math.round((new Date).getTime()/1e3);return n<=t.exp}return!1},o.parseToken=function(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))},o}]);
angular.module("chatApp").factory("ChatHistoryService",["$http","ApiBaseUrl",function(t,r){"use strict";var o={};return o.getChatRoomHistory=function(o){return t.get(r+"/history/"+o)},o.getChatRooms=function(){return t.get(r+"/chatroom")},o}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
angular.module("chatApp").factory("UserService",["$http","ApiBaseUrl",function(r,e){"use strict";var t={};return t.register=function(t){return r.post(e+"/users",{user:t})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYXV0aENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2NoYXRIaXN0b3J5Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3JlZ2lzdGVyQ29udHJvbGxlci5qcyIsImludGVyY2VwdG9ycy9hdXRoSW50ZXJjZXB0b3IuanMiLCJzZXJ2aWNlcy9hdXRoU2VydmljZS5qcyIsInNlcnZpY2VzL2NoYXRIaXN0b3J5U2VydmljZS5qcyIsInNlcnZpY2VzL3NvY2tldFNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiYXV0aCIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCJydW4iLCIkcm91dGUiLCIkcm9vdFNjb3BlIiwiJGxvY2F0aW9uIiwiQXV0aFNlcnZpY2UiLCIkb24iLCJldiIsIm5leHQiLCJjdXJyZW50IiwibmV4dFBhdGgiLCJwYXRoIiwibmV4dFJvdXRlIiwicm91dGVzIiwiaXNBdXRoZWQiLCIkc2NvcGUiLCIkd2luZG93Iiwic2V0Q3VycmVudFVzZXIiLCJfaWQiLCJlbWFpbCIsInVzZXJuYW1lIiwibWUiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldEN1cnJlbnRVc2VyIiwicGFyc2UiLCJnZXRJdGVtIiwibG9nb3V0IiwicmVtb3ZlSXRlbSIsImNyZWRlbnRpYWxzIiwicGFzc3dvcmQiLCJlcnJvck1lc3NhZ2UiLCJhdXRoZW50aWNhdGUiLCJsb2dpbiIsInRoZW4iLCJyZXNwb25zZSIsInN0YXR1cyIsImhlYWRlcnMiLCJwYXJhbXMiLCJwYXJzZVRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlciIsIm1lc3NhZ2UiLCIkc2NlIiwiU29ja2V0U2VydmljZSIsInByb2Nlc3NVc2VySW5wdXQiLCJzeXN0ZW1NZXNzYWdlIiwiY2hhckF0IiwicHJvY2Vzc0NvbW1hbmQiLCJtZXNzYWdlcyIsInNlbmRNZXNzYWdlIiwicm9vbSIsImlucHV0TWVzc2FnZSIsInRleHQiLCJlbWl0IiwiY2hhbmdlUm9vbSIsIm5ld1Jvb20iLCJjb21tYW5kIiwid29yZHMiLCJzcGxpdCIsInN1YnN0cmluZyIsImxlbmd0aCIsInRvTG93ZXJDYXNlIiwic2hpZnQiLCJqb2luIiwibmFtZSIsInJvb21MaXN0IiwibmV3Um9vbUVycm9yIiwib24iLCJyZXN1bHQiLCJzdWNjZXNzIiwicm9vbXMiLCJzZXRJbnRlcnZhbCIsInN1Ym1pdCIsImZvY3VzQ2hhdHJvb20iLCJjcmVhdGVOZXdDaGF0cm9vbSIsIiQiLCJtb2RhbCIsInNhbml0aXplSHRtbCIsInZhbHVlIiwidHJ1c3RBc0h0bWwiLCIkaHR0cCIsIkNoYXRIaXN0b3J5U2VydmljZSIsImdldEhpc3RvcnkiLCJjaGF0Um9vbSIsImdldENoYXRSb29tSGlzdG9yeSIsImNoYXRSb29tTmFtZSIsImNoYXRMaW5lcyIsImdldENoYXRSb29tcyIsImNoYXRSb29tcyIsInJlbG9hZEhpc3RvcnkiLCJVc2VyU2VydmljZSIsInJlZ2lzdGVyIiwiZmFjdG9yeSIsIiRxIiwiJGluamVjdG9yIiwicmVxdWVzdCIsImdldCIsImdldFRva2VuIiwicmVzIiwic2F2ZVRva2VuIiwiQXBpQmFzZVVybCIsImF1dGhTZXJ2aWNlIiwiand0VG9rZW4iLCJwb3N0IiwiZGF0ZU5vdyIsIk1hdGgiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwiYmFzZTY0VXJsIiwiYmFzZTY0IiwicmVwbGFjZSIsImF0b2IiLCJjaGF0SGlzdG9yeVNlcnZpY2UiLCJzb2NrZXRTZXJ2aWNlIiwic29ja2V0IiwiaW8iLCJjb25uZWN0IiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiLCJ1c2VyU2VydmljZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FFQSxZQUlBLElBQUlBLEdBQU1DLFFBQVFDLE9BQU8sV0FBWSxVQUFXLGNBR2hERixHQUFJRyxTQUFTLGFBQWMsNkJBRzNCSCxFQUFJSSxRQUFRLGlCQUFrQixvQkFBcUIsZ0JBQWlCLFNBQVVDLEVBQWdCQyxFQUFtQkMsR0FLM0dBLEVBQWNDLGFBQWFDLEtBQUssbUJBRWhDSixFQUNPSyxLQUFLLFVBQ05DLFlBQWEsb0JBQ2JDLFdBQVksaUJBQ1pDLE1BQU0sSUFFTEgsS0FBSyxTQUNOQyxZQUFhLG1CQUNiQyxXQUFZLGlCQUNaQyxNQUFNLElBRUxILEtBQUssWUFDTkMsWUFBYSwwQkFDYkMsV0FBWSx3QkFDWkMsTUFBTSxJQUVMSCxLQUFLLGFBQ05DLFlBQWEsdUJBQ2JDLFdBQVkscUJBQ1pDLE1BQU0sSUFHWEMsV0FBWUMsV0FBWSxjQUkvQmYsRUFBSWdCLEtBQUssU0FBVSxhQUFjLFlBQWEsY0FBZSxTQUFVQyxFQUFRQyxFQUFZQyxFQUFXQyxHQUVqR0YsRUFBV0csSUFBSSx1QkFBd0IsU0FBU0MsRUFBSUMsRUFBTUMsR0FDckQsR0FBSUMsR0FBV04sRUFBVU8sT0FDckJDLEVBQVlWLEVBQU9XLE9BQU9ILEVBRTFCRSxJQUFhQSxFQUFVZCxPQUFTTyxFQUFZUyxZQUM5Q1YsRUFBVU8sS0FBSztBQ25EM0J6QixRQUFRQyxPQUFPLFdBQVdVLFdBQVcseUJBQTBCLFNBQVUsVUFBVyxZQUFhLGNBQWUsU0FBVWtCLEVBQVFDLEVBQVNaLEVBQVdDLEdBRWhKLFlBR0FVLEdBQU9FLGVBQWlCLFNBQVNDLEVBQUtDLEVBQU9DLEdBQ3ZDLEdBQUlDLElBQ0VILElBQUtBLEVBQ0xFLFNBQVVBLEVBQ1ZELE1BQU9BLEVBRWJILEdB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QUgsR0FBY2hELEdBQUssU0FBVW9ELEVBQVdDLEdBQ2xDSixFQUFPakQsR0FBR29ELEVBQVcsV0FDZixHQUFJRSxHQUFPQyxTQUNYM0gsR0FBVzRILE9BQU8sV0FDWkgsRUFBU0ksTUFBTVIsRUFBUUssUUFLekNOLEVBQWM5RCxLQUFPLFNBQVVrRSxFQUFXakYsRUFBTWtGLEdBQzFDSixFQUFPL0QsS0FBS2tFLEVBQVdqRixFQUFNLFdBQ3ZCLEdBQUltRixHQUFPQyxTQUNYM0gsR0FBVzRILE9BQU8sV0FDUkgsR0FDREEsRUFBU0ksTUFBTVIsRUFBUUssUUFNckNOO0FDN0JickksUUFBUUMsT0FBTyxXQUFXNkcsUUFBUSxlQUFnQixRQUFTLGFBQWMsU0FBVVosRUFBT29CLEdBRXBGLFlBRUEsSUFBSXlCLEtBT0osT0FKQUEsR0FBWWxDLFNBQVcsU0FBVW5ELEdBQzdCLE1BQU93QyxHQUFNdUIsS0FBS0gsRUFBYSxVQUFZNUQsS0FBUUEsS0FHaERxRiIsImZpbGUiOiJhbGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7XHJcbiAgICBcclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFxyXG4vLyBEZWNsYXJlIGFwcCBsZXZlbCBtb2R1bGVcclxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJywgWyduZ1JvdXRlJywgJ25nU2FuaXRpemUnXSk7XHJcblxyXG4vLyBEZWZpbmUgYSBjb25zdGFudCB3aXRoIHRoZSBBUEkgYmFzZSB1cmxcclxuYXBwLmNvbnN0YW50KCdBcGlCYXNlVXJsJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGknKTtcclxuXHJcbi8vIENvbmZpZ3VyZSB0aGUgYXBwbGljYXRpb24gcm91dGVzXHJcbmFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlcicsICckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJGh0dHBQcm92aWRlcikge1xyXG4gICAgICBcclxuICAgICAgLy8gUmVtb3ZlIHRoZSBoYXNoIGZyb20gdXJsXHJcbiAgICAgIC8vICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuICAgICAgXHJcbiAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG4gICAgICBcclxuICAgICAgJHJvdXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLndoZW4oJy9sb2dpbicsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBdXRoQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IGZhbHNlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvY2hhdCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY2hhdC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NoYXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogdHJ1ZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL2hpc3RvcnknLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NoYXRIaXN0b3J5Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ2hhdEhpc3RvcnlDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogdHJ1ZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWdpc3Rlci5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IGZhbHNlXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICAub3RoZXJ3aXNlKHsgcmVkaXJlY3RUbzogJy9sb2dpbicgfSk7XHJcbn1dKTtcclxuXHJcbi8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWQsIGFuZCBpZiBub3QgcmVkaXJlY3QgdG8gdGhlIGxvZ2luIHBhZ2VcclxuYXBwLnJ1bihbJyRyb3V0ZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkcm91dGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgQXV0aFNlcnZpY2UpIHtcclxuICAgXHJcbiAgICAgJHJvb3RTY29wZS4kb24oJyRsb2NhdGlvbkNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oZXYsIG5leHQsIGN1cnJlbnQpIHtcclxuICAgICAgICAgIHZhciBuZXh0UGF0aCA9ICRsb2NhdGlvbi5wYXRoKCk7XHJcbiAgICAgICAgICB2YXIgbmV4dFJvdXRlID0gJHJvdXRlLnJvdXRlc1tuZXh0UGF0aF07IFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAobmV4dFJvdXRlICYmIG5leHRSb3V0ZS5hdXRoICYmICFBdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTsgICAgICAgICAgXHJcbiAgICAgICAgICB9XHJcbiAgICAgIFxyXG4gICAgIH0pO1xyXG4gICAgXHJcbn1dKTtcclxuXHJcbn0pKCk7XHJcbiIsIi8vIENvbnRhaW5lciBmb3IgdGhlIGdsb2JhbCBhcHBsaWNhdGlvbiBsb2dpYyAvIEFsdGVybmF0aXZlIHRvIHRoZSBBbmd1bGFyJ3MgcnVuIGZ1bmN0aW9uXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQXBwbGljYXRpb25Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJHdpbmRvdycsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkd2luZG93LCAkbG9jYXRpb24sIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBTdG9yZSBjdXJyZW50IHVzZXIgaW5mb1xyXG4gICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbihfaWQsIGVtYWlsLCB1c2VybmFtZSkge1xyXG4gICAgICAgICAgICB2YXIgbWUgPSB7XHJcbiAgICAgICAgICAgICAgICAgIF9pZDogX2lkLFxyXG4gICAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbFxyXG4gICAgICAgICAgICB9OyBcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImN1cnJlbnRVc2VyXCIsIEpTT04uc3RyaW5naWZ5KG1lKSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZXRyaWV2ZSBjdXJyZW50IHVzZXIgaW5mb1xyXG4gICAgICAkc2NvcGUuZ2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImN1cnJlbnRVc2VyXCIpKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcclxuICAgICAgJHNjb3BlLmlzQXV0aGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gQXV0aFNlcnZpY2UuaXNBdXRoZWQoKSAhPT0gbnVsbCAmJiBBdXRoU2VydmljZS5pc0F1dGhlZCgpICE9PSBmYWxzZTsgICAgIFxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gTG9nb3V0IGZyb20gdGhlIGNoYXRcclxuICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UubG9nb3V0KCk7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2N1cnJlbnRVc2VyJyk7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgfTtcclxufV0pOyAgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdBdXRoQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRsb2NhdGlvbicsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgQXV0aFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgY3JlZGVudGlhbHNcclxuICAgICAgJHNjb3BlLmNyZWRlbnRpYWxzID0ge1xyXG4gICAgICAgICAgICBlbWFpbDogJycsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiAnJ1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgZXJyb3IgbWVzc2FnZVxyXG4gICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJyc7XHJcblxyXG4gICAgICAvLyBBdXRoZW50aWNhdGUgXHJcbiAgICAgICRzY29wZS5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFRyeSB0byBsb2dpbiBcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UubG9naW4oY3JlZGVudGlhbHMpXHJcbiAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IEF1dGhTZXJ2aWNlLnBhcnNlVG9rZW4ocmVzcG9uc2UuZGF0YS50b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRDdXJyZW50VXNlcihwYXJhbXMudXNlci5faWQsIHBhcmFtcy51c2VyLmVtYWlsLCBwYXJhbXMudXNlci51c2VybmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY2hhdCcpOyBcclxuICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlOyAgICAgIFxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbn1dKTsgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdDaGF0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnJHNjZScsICdTb2NrZXRTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgJHNjZSwgU29ja2V0U2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICRzY29wZS5yb29tTGlzdCA9IFtdO1xyXG4gICAgICAkc2NvcGUucm9vbSA9ICdMb2JieSc7XHJcbiAgICAgICRzY29wZS5pbnB1dE1lc3NhZ2UgPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb20gPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgbmFtZS1jaGFuZ2UgYXR0ZW1wdFxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCduYW1lUmVzdWx0JywgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgXHR2YXIgbWVzc2FnZTtcclxuICAgICAgICAgIFx0XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ1lvdSBhcmUgbm93IGtub3duIGFzICcgKyByZXN1bHQubmFtZSArICcuJztcclxuICAgICAgICAgIFx0fSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IHJlc3VsdC5tZXNzYWdlO1xyXG4gICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgcm9vbSBjaGFuZ2UgICAgICAgXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ2pvaW5SZXN1bHQnLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICBcdCRzY29wZS5yb29tID0gcmVzdWx0LnJvb207XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaCgnWW91IGFyZSBub3cgaW4gdGhlIHJvb20gJyArIHJlc3VsdC5yb29tKTtcclxuICAgICAgfSk7ICAgIFxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgcmVjZWl2ZWQgbWVzc2FnZXNcclxuICAgICAgU29ja2V0U2VydmljZS5vbignbWVzc2FnZScsIGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UudGV4dCk7XHJcbiAgICAgIH0pOyAgICBcdFx0XHRcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IGxpc3Qgb2Ygcm9vbXMgYXZhaWxhYmxlXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ3Jvb21zJywgZnVuY3Rpb24gKHJvb21zKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yb29tTGlzdCA9IFtdO1xyXG4gICAgICAgICAgXHRmb3IgKHZhciByb29tIGluIHJvb21zKSB7XHJcbiAgICAgICAgICAgICAgICByb29tID0gcm9vbS5zdWJzdHJpbmcoMSwgcm9vbS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvb20gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJvb21MaXN0LnB1c2gocm9vbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICBcdH1cclxuXHJcbiAgICAgIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIFJlcXVlc3QgbGlzdCBvZiByb29tcyBhdmFpbGFibGUgaW50ZXJtaXR0ZW50bHlcclxuICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ3Jvb21zJyk7XHJcbiAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIEFsbG93IHN1Ym1pdHRpbmcgdGhlIGZvcm0gdG8gc2VuZCBhIGNoYXQgbWVzc2FnZVxyXG4gICAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICBcdHByb2Nlc3NVc2VySW5wdXQobWVzc2FnZSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBBbGxvdyBjbGljayBhIHJvb20gbmFtZSB0byBjaGFuZ2UgdG8gdGhhdCBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuZm9jdXNDaGF0cm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcblx0XHRwcm9jZXNzQ29tbWFuZCgnL2pvaW4gJyArIHJvb20pO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goJ1Jvb20gY2hhbmdlZC4nKTtcclxuXHR9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuY3JlYXRlTmV3Q2hhdHJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICBpZiAoIXJvb20pIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IHRydWU7XHJcblx0ICAgICAgfSBlbHNlIHtcclxuICAgICAgXHRcdCBwcm9jZXNzVXNlcklucHV0KFwiL2pvaW4gXCIgKyByb29tKTtcclxuICAgICAgXHQgIFx0ICQoJyNteU1vZGFsJykubW9kYWwoJ2hpZGUnKTtcclxuICAgICAgXHRcdCAkc2NvcGUubmV3Um9vbUVycm9yID0gZmFsc2U7XHJcbiAgICAgIFx0fVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gU2FuaXppdGUgSHRtbFxyXG4gICAgICAkc2NvcGUuc2FuaXRpemVIdG1sID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh2YWx1ZSk7XHJcbiAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBQcml2YXRlIGhlbHBlcnNcclxuICAgICAgICovXHJcbiAgICAgIFxyXG4gICAgICAvLyBQcm9jZXNzIHRoZSBpbnB1dCBcclxuICAgICAgZnVuY3Rpb24gcHJvY2Vzc1VzZXJJbnB1dChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHZhciBzeXN0ZW1NZXNzYWdlO1xyXG4gICAgICAgICAgXHRcclxuICAgICAgICAgICAgLy8gSWYgdXNlciBpbnB1dCBiZWdpbnMgd2l0aCBzbGFzaCwgdHJlYXQgaXQgYXMgY29tbWFuZFxyXG4gICAgICAgICAgICBpZiAobWVzc2FnZS5jaGFyQXQoMCkgPT0gJy8nKSB7XHJcbiAgICAgICAgICAgICAgICAgIHN5c3RlbU1lc3NhZ2UgPSBwcm9jZXNzQ29tbWFuZChtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKHN5c3RlbU1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goc3lzdGVtTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgLy8gQnJvYWRjYXN0IG5vbmNvbW1hbmQgaW5wdXQgdG8gb3RoZXIgdXNlcnNcclxuICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2UoJHNjb3BlLnJvb20sIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChcIk1lOiBcIiArIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaW5wdXRNZXNzYWdlID0gJyc7XHJcbiAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAvLyBTZW5kIGNoYXQgbWVzc2FnZXNcclxuICAgICAgZnVuY3Rpb24gc2VuZE1lc3NhZ2Uocm9vbSwgdGV4dCkge1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgcm9vbTogcm9vbSxcclxuICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ21lc3NhZ2UnLCBtZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgICBcdFxyXG4gICAgICAvLyBDaGFuZ2Ugcm9vbXNcclxuICAgICAgZnVuY3Rpb24gY2hhbmdlUm9vbShyb29tKSB7XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnam9pbicsIHtcclxuICAgICAgICAgICAgICAgICAgbmV3Um9vbTogcm9vbVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBcdFxyXG4gICAgICAvLyBQcm9jZXNzaW5nIGNoYXQgY29tbWFuZHNcclxuICAgICAgZnVuY3Rpb24gcHJvY2Vzc0NvbW1hbmQoY29tbWFuZCkge1xyXG4gICAgICAgICAgICB2YXIgd29yZHMgPSBjb21tYW5kLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgIC8vIFBhcnNlIGNvbW1hbmQgZnJvbSBmaXJzdCB3b3JkXHJcbiAgICAgICAgICAgIGNvbW1hbmQgPSB3b3Jkc1swXVxyXG4gICAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKDEsIHdvcmRzWzBdLmxlbmd0aClcclxuICAgICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gZmFsc2U7XHJcbiAgXHJcbiAgICAgICAgICAgIHN3aXRjaCAoY29tbWFuZCkge1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICdqb2luJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvb20gPSB3b3Jkcy5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSByb29tIGNoYW5naW5nIC8gY3JlYXRpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlUm9vbShyb29tKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ25pY2snOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3Jkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHdvcmRzLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIG5hbWUtY2hhbmdlIGF0dGVtcHRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnbmFtZUF0dGVtcHQnLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBtZXNzYWdlIGlmIGNvbW1hbmQgaXNuJ3QgcmVjb2duaXplZCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdVbnJlY29nbml6ZWQgY29tbWFuZC4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICAgIH1cclxuXHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0NoYXRIaXN0b3J5Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsICdDaGF0SGlzdG9yeVNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCBDaGF0SGlzdG9yeVNlcnZpY2UpIHtcclxuICAgIFxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICAgXHJcbiAgICAvLyBJbml0aWFsaXplIHRoZSBjaGF0cm9vbSBuYW1lICAgXHJcbiAgICAkc2NvcGUuY2hhdFJvb21OYW1lID0gJ0xvYmJ5JztcclxuICAgIFxyXG4gICAgLy8gSW5pdGlhbGl6ZSB0aGUgZXJyb3IgbWVzc2FnZVxyXG4gICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG4gICBcclxuICAgIENoYXRIaXN0b3J5U2VydmljZS5nZXRDaGF0Um9vbXMoKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmNoYXRSb29tcyA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgfSxmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnQW4gZXJyb3Igb2N1cnJlZCByZXRyaWV2aW5nIHRoZSBoaXN0b3J5LiBQbGVhc2UgcmVsb2FkIGRlIHBhZ2UuJztcclxuICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgZ2V0SGlzdG9yeSgnTG9iYnknKTtcclxuICAgIFxyXG4gICAgJHNjb3BlLnJlbG9hZEhpc3RvcnkgPSBmdW5jdGlvbiAoY2hhdFJvb20pIHtcclxuICAgICAgICByZXR1cm4gZ2V0SGlzdG9yeShjaGF0Um9vbSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBnZXRIaXN0b3J5KGNoYXRSb29tKSB7XHJcbiAgICAgICAgQ2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tSGlzdG9yeShjaGF0Um9vbSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9IGNoYXRSb29tO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXRMaW5lcyA9IHJlc3BvbnNlLmRhdGE7ICAgICAgIFxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ0FuIGVycm9yIG9jdXJyZWQgcmV0cmlldmluZyB0aGUgaGlzdG9yeS4gUGxlYXNlIHJlbG9hZCBkZSBwYWdlLic7ICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdSZWdpc3RlckNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCAnVXNlclNlcnZpY2UnLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCBVc2VyU2VydmljZSwgQXV0aFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgdGhlIFVzZXJcclxuICAgICAgJHNjb3BlLnVzZXIgPSB7XHJcbiAgICAgICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICAgICAgdXNlcm5hbWU6ICcnLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogJydcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgcmVnaXN0cmF0aW9uIGVycm9yIG1lc3NhZ2VcclxuICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgLy8gUmVnaXN0ZXIgYSBuZXcgdXNlclxyXG4gICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVHJ5IHRvIHJlZ2lzdGVyIFxyXG4gICAgICAgICAgICBVc2VyU2VydmljZS5yZWdpc3Rlcih1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBBdXRoU2VydmljZS5wYXJzZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIocGFyYW1zLnVzZXIuX2lkLCBwYXJhbXMudXNlci5lbWFpbCwgcGFyYW1zLnVzZXIudXNlcm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NoYXQnKTsgXHJcbiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTsgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG59XSk7IiwiLy8gSW5qZWN0IHRoZSAkaW50ZXJjZXB0b3IgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jaWVzXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgWyckcScsICckaW5qZWN0b3InLCBmdW5jdGlvbiAoJHEsICRpbmplY3Rvcikge1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEF1dG9tYXRpY2FsbHkgYXR0YWNoIEF1dGhvcml6YXRpb24gaGVhZGVyXHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uIChjb25maWcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgIHZhciBBdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ0F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ3gtYWNjZXNzLXRva2VuJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgnO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgIFxyXG4gICAgICAgICAgICAvLyBJZiBhIHRva2VuIHdhcyBzZW50IGJhY2ssIHRoZW4gc2F2ZSBpdFxyXG4gICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gcmVzLmRhdGEudG9rZW47XHJcbiAgICAgICAgICAgICAgICAgIHZhciBBdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ0F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2F2ZVRva2VuKHRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgICAgICAgfVxyXG4gIH07XHJcblxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCAnJHdpbmRvdycsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRodHRwLCAkd2luZG93LCBBcGlCYXNlVXJsKSB7XHJcblxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcclxuIFxyXG4gICAgICAvLyBTYXZlIHRoZSB0b2tlbiBpbiB0aGUgbG9jYWwgc3RvcmFnZVxyXG4gICAgICBhdXRoU2VydmljZS5zYXZlVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbiA9IHRva2VuO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUmV0cmlldmUgdGhlIHRva2VuIGluIHRoZSBsb2NhbCBzdG9yYWdlXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmdldFRva2VuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcclxuICAgICAgfTtcclxuICAgICAgICAgICBcclxuICAgICAgLy8gTG9naW4gLSBNYWtlIGEgcmVxdWVzdCB0byB0aGUgYXBpIGZvciBhdXRoZW50aWNhdGluZyAgICAgIFxyXG4gICAgICBhdXRoU2VydmljZS5sb2dpbiA9IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChBcGlCYXNlVXJsICsgJy9hdXRoZW50aWNhdGUnLCBjcmVkZW50aWFscyk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb2dvdXRcclxuICAgICAgYXV0aFNlcnZpY2UubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoYXV0aFNlcnZpY2UuZ2V0VG9rZW4oKSkge1xyXG4gICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdqd3RUb2tlbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiB0aGUgdXNlciBpcyBhdXRoZW50aWNhdGVkXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmlzQXV0aGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gYXV0aFNlcnZpY2UuZ2V0VG9rZW4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGF1dGhTZXJ2aWNlLnBhcnNlVG9rZW4odG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgZGF0ZU5vdyA9IE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSB0b2tlbiBoYXMgbm90IGV4cGlyZWRcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVOb3cgPD0gcGFyYW1zLmV4cDtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBQYXJzZSB0aGUgSlNPTiBXZWIgVG9rZW5cclxuICAgICAgYXV0aFNlcnZpY2UucGFyc2VUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgICAgICB2YXIgYmFzZTY0VXJsID0gdG9rZW4uc3BsaXQoJy4nKVsxXTtcclxuICAgICAgICAgICAgdmFyIGJhc2U2NCA9IGJhc2U2NFVybC5yZXBsYWNlKCctJywnKycpLnJlcGxhY2UoJ18nLCcvJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cuYXRvYihiYXNlNjQpKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBhdXRoU2VydmljZTtcclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQ2hhdEhpc3RvcnlTZXJ2aWNlJywgWyckaHR0cCcsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRodHRwLCBBcGlCYXNlVXJsKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICB2YXIgY2hhdEhpc3RvcnlTZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIGNoYXQgaGlzdG9yeSBvZiBhIGdpdmVuIGNoYXRyb29tIFxyXG4gICAgICBjaGF0SGlzdG9yeVNlcnZpY2UuZ2V0Q2hhdFJvb21IaXN0b3J5ID0gZnVuY3Rpb24gKGNoYXRSb29tKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvaGlzdG9yeS8nICsgY2hhdFJvb20pO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gR2V0IGFsbCB0aGUgY2hhdHJvb21zIHRoYXQgaGF2ZSBoaXN0b3J5XHJcbiAgICAgIGNoYXRIaXN0b3J5U2VydmljZS5nZXRDaGF0Um9vbXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvY2hhdHJvb20nKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBjaGF0SGlzdG9yeVNlcnZpY2U7XHJcbn1dKTsiLCIvLyBDcmVhdGUgYSBuZXcgc2VydmljZSBmb3IgbWFuYWdpbmcgd2Vic29ja2V0cyB3aXRoIHNvY2tldElvLiBcclxuYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdTb2NrZXRTZXJ2aWNlJywgWyckcm9vdFNjb3BlJywgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIHZhciBzb2NrZXRTZXJ2aWNlID0ge307XHJcblxyXG4gICAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCgpO1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5vbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5lbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0LmVtaXQoZXZlbnROYW1lLCBkYXRhLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBzb2NrZXRTZXJ2aWNlO1xyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdVc2VyU2VydmljZScsIFsnJGh0dHAnLCAnQXBpQmFzZVVybCcsIGZ1bmN0aW9uICgkaHR0cCwgQXBpQmFzZVVybCkge1xyXG5cclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgICAgdmFyIHVzZXJTZXJ2aWNlID0ge307XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAvLyBSZWdpc3RlciBhIG5ldyB1c2VyICAgICAgXHJcbiAgICAgIHVzZXJTZXJ2aWNlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KEFwaUJhc2VVcmwgKyAnL3VzZXJzJywgeyAndXNlcic6IHVzZXIgfSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gdXNlclNlcnZpY2U7XHJcbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=