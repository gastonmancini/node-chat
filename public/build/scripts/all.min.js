!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.constant("ApiBaseUrl","http://localhost:3000/api"),t.config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,r){r.interceptors.push("AuthInterceptor"),t.when("/login",{templateUrl:"/views/login.html",controller:"AuthController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$window","$location","AuthService",function(e,t,r,n){"use strict";e.setCurrentUser=function(e,r,n){var o={_id:e,username:n,email:r};t.localStorage.setItem("currentUser",JSON.stringify(o))},e.getCurrentUser=function(){return JSON.parse(t.localStorage.getItem("currentUser"))},e.isAuthed=function(){return null!==n.isAuthed()&&n.isAuthed()!==!1},e.logout=function(){n.logout(),t.localStorage.removeItem("currentUser"),r.path("/login")}}]);
angular.module("chatApp").controller("AuthController",["$scope","$location","AuthService",function(e,r,t){"use strict";e.credentials={email:"",password:""},e.formregister={error:!1},e.authenticate=function(n){t.login(n).then(function(n){var o=t.parseToken(n.data.token);e.setCurrentUser(o.user._id,o.user.email,o.user.username),r.path("/chat")},function(){e.formregister.error=!0})}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","$http","$location","ApiBaseUrl",function(o,t,c,s){"use strict";function e(c){t.get(s+"/history/"+c).success(function(t){o.chatRoomName=c,o.chatLines=t})}o.chatRoomName="Lobby",t.get(s+"/chatroom").success(function(t){o.chatRooms=t}),t.get(s+"/history/Lobby").success(function(t){o.chatRoomName="Lobby",o.chatLines=t}),o.reloadHistory=function(o){e(o)}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location","ApiBaseUrl",function(r,e,o,s){"use strict";r.user={email:"",username:"",password:""},r.formregister={error:!1},r.register=function(t){e.post(s+"/users",{user:t}).success(function(){o.path("/")}).error(function(){r.formregister.error=!0})}}]);
angular.module("chatApp").factory("AuthInterceptor",["$q","$injector",function(e,t){return{request:function(e){var n=t.get("AuthService"),r=n.getToken();return r&&(e.headers["x-access-token"]=r),e.headers["Content-Type"]="application/json; charset=UTF-8",e},response:function(e){var n=e.data.token,r=t.get("AuthService");return n&&r.saveToken(n),e}}}]);
angular.module("chatApp").factory("AuthService",["$http","$window","ApiBaseUrl",function(e,t,n){"use strict";var o={};return o.saveToken=function(e){t.localStorage.jwtToken=e},o.getToken=function(){return t.localStorage.jwtToken},o.login=function(t){return e.post(n+"/authenticate",t)},o.logout=function(){o.getToken()&&t.localStorage.removeItem("jwtToken")},o.isAuthed=function(){var e=o.getToken();if(e){var t=o.parseToken(e),n=Math.round((new Date).getTime()/1e3);return n<=t.exp}return!1},o.parseToken=function(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))},o}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYXV0aENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2NoYXRIaXN0b3J5Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3JlZ2lzdGVyQ29udHJvbGxlci5qcyIsImludGVyY2VwdG9ycy9hdXRoSW50ZXJjZXB0b3IuanMiLCJzZXJ2aWNlcy9hdXRoU2VydmljZS5qcyIsInNlcnZpY2VzL3NvY2tldFNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImF1dGgiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwiJHNjb3BlIiwiJHdpbmRvdyIsIiRsb2NhdGlvbiIsIkF1dGhTZXJ2aWNlIiwic2V0Q3VycmVudFVzZXIiLCJfaWQiLCJlbWFpbCIsInVzZXJuYW1lIiwibWUiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldEN1cnJlbnRVc2VyIiwicGFyc2UiLCJnZXRJdGVtIiwiaXNBdXRoZWQiLCJsb2dvdXQiLCJyZW1vdmVJdGVtIiwicGF0aCIsImNyZWRlbnRpYWxzIiwicGFzc3dvcmQiLCJmb3JtcmVnaXN0ZXIiLCJlcnJvciIsImF1dGhlbnRpY2F0ZSIsImxvZ2luIiwidGhlbiIsInJlcyIsInBhcmFtcyIsInBhcnNlVG9rZW4iLCJkYXRhIiwidG9rZW4iLCJ1c2VyIiwiJHNjZSIsIlNvY2tldFNlcnZpY2UiLCJwcm9jZXNzVXNlcklucHV0IiwibWVzc2FnZSIsInN5c3RlbU1lc3NhZ2UiLCJjaGFyQXQiLCJwcm9jZXNzQ29tbWFuZCIsIm1lc3NhZ2VzIiwic2VuZE1lc3NhZ2UiLCJyb29tIiwiaW5wdXRNZXNzYWdlIiwidGV4dCIsImVtaXQiLCJjaGFuZ2VSb29tIiwibmV3Um9vbSIsImNvbW1hbmQiLCJ3b3JkcyIsInNwbGl0Iiwic3Vic3RyaW5nIiwibGVuZ3RoIiwidG9Mb3dlckNhc2UiLCJzaGlmdCIsImpvaW4iLCJuYW1lIiwicm9vbUxpc3QiLCJuZXdSb29tRXJyb3IiLCJvbiIsInJlc3VsdCIsInN1Y2Nlc3MiLCJyb29tcyIsInNldEludGVydmFsIiwic3VibWl0IiwiZm9jdXNDaGF0cm9vbSIsImNyZWF0ZU5ld0NoYXRyb29tIiwiJCIsIm1vZGFsIiwic2FuaXRpemVIdG1sIiwidmFsdWUiLCJ0cnVzdEFzSHRtbCIsIiRodHRwIiwiQXBpQmFzZVVybCIsImdldEhpc3RvcnkiLCJjaGF0Um9vbSIsImdldCIsImNoYXRSb29tTmFtZSIsImNoYXRMaW5lcyIsImNoYXRSb29tcyIsInJlbG9hZEhpc3RvcnkiLCJyZWdpc3RlciIsInBvc3QiLCJmYWN0b3J5IiwiJHEiLCIkaW5qZWN0b3IiLCJyZXF1ZXN0IiwiZ2V0VG9rZW4iLCJoZWFkZXJzIiwicmVzcG9uc2UiLCJzYXZlVG9rZW4iLCJhdXRoU2VydmljZSIsImp3dFRva2VuIiwiZGF0ZU5vdyIsIk1hdGgiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwiYmFzZTY0VXJsIiwiYmFzZTY0IiwicmVwbGFjZSIsImF0b2IiLCIkcm9vdFNjb3BlIiwic29ja2V0U2VydmljZSIsInNvY2tldCIsImlvIiwiY29ubmVjdCIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5Il0sIm1hcHBpbmdzIjoiQ0FBQSxXQUVBLFlBSUEsSUFBSUEsR0FBTUMsUUFBUUMsT0FBTyxXQUFZLFVBQVcsY0FHaERGLEdBQUlHLFNBQVMsYUFBYyw2QkFHM0JILEVBQUlJLFFBQVEs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ZixHQUFJRSxHQUFPQyxTQUNYUixHQUFXUyxPQUFPLFdBQ1pILEVBQVNJLE1BQU1SLEVBQVFLLFFBS3pDTixFQUFjM0QsS0FBTyxTQUFVK0QsRUFBVzlFLEVBQU0rRSxHQUMxQ0osRUFBTzVELEtBQUsrRCxFQUFXOUUsRUFBTSxXQUN2QixHQUFJZ0YsR0FBT0MsU0FDWFIsR0FBV1MsT0FBTyxXQUNSSCxHQUNEQSxFQUFTSSxNQUFNUixFQUFRSyxRQU1yQ04iLCJmaWxlIjoiYWxsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe1xyXG4gICAgXHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBcclxuLy8gRGVjbGFyZSBhcHAgbGV2ZWwgbW9kdWxlXHJcbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcsIFsnbmdSb3V0ZScsICduZ1Nhbml0aXplJ10pO1xyXG5cclxuLy8gRGVmaW5lIGEgY29uc3RhbnQgd2l0aCB0aGUgQVBJIGJhc2UgdXJsXHJcbmFwcC5jb25zdGFudCgnQXBpQmFzZVVybCcsICdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpJyk7XHJcblxyXG4vLyBDb25maWd1cmUgdGhlIGFwcGxpY2F0aW9uIHJvdXRlc1xyXG5hcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCAnJGh0dHBQcm92aWRlcicsIGZ1bmN0aW9uICgkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIsICRodHRwUHJvdmlkZXIpIHtcclxuICAgICAgXHJcbiAgICAgIC8vIFJlbW92ZSB0aGUgaGFzaCBmcm9tIHVybFxyXG4gICAgICAvLyAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBdXRoSW50ZXJjZXB0b3InKTtcclxuICAgICAgXHJcbiAgICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC53aGVuKCcvbG9naW4nLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2xvZ2luLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQXV0aENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiBmYWxzZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL2NoYXQnLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NoYXQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDaGF0Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IHRydWVcclxuICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9oaXN0b3J5Jywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jaGF0SGlzdG9yeS5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NoYXRIaXN0b3J5Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IHRydWVcclxuICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9yZWdpc3RlcicsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVnaXN0ZXIuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZWdpc3RlckNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiBmYWxzZVxyXG4gICAgICB9KVxyXG5cclxuICAgICAgLm90aGVyd2lzZSh7IHJlZGlyZWN0VG86ICcvbG9naW4nIH0pO1xyXG59XSk7XHJcblxyXG59KSgpO1xyXG4iLCIvLyBDb250YWluZXIgZm9yIHRoZSBnbG9iYWwgYXBwbGljYXRpb24gbG9naWMgLyBBbHRlcm5hdGl2ZSB0byB0aGUgQW5ndWxhcidzIHJ1biBmdW5jdGlvblxyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgLy8gU3RvcmUgY3VycmVudCB1c2VyIGluZm9cclxuICAgICAgJHNjb3BlLnNldEN1cnJlbnRVc2VyID0gZnVuY3Rpb24oX2lkLCBlbWFpbCwgdXNlcm5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIG1lID0ge1xyXG4gICAgICAgICAgICAgICAgICBfaWQ6IF9pZCxcclxuICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgICBlbWFpbDogZW1haWxcclxuICAgICAgICAgICAgfTsgXHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjdXJyZW50VXNlclwiLCBKU09OLnN0cmluZ2lmeShtZSkpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUmV0cmlldmUgY3VycmVudCB1c2VyIGluZm9cclxuICAgICAgJHNjb3BlLmdldEN1cnJlbnRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjdXJyZW50VXNlclwiKSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiB0aGUgdXNlciBpcyBhdXRoZW50aWNhdGVkXHJcbiAgICAgICRzY29wZS5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmlzQXV0aGVkKCkgIT09IG51bGwgJiYgQXV0aFNlcnZpY2UuaXNBdXRoZWQoKSAhPT0gZmFsc2U7ICAgICBcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIExvZ291dCBmcm9tIHRoZSBjaGF0XHJcbiAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ291dCgpO1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdjdXJyZW50VXNlcicpO1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XHJcbiAgICAgIH07XHJcbn1dKTsgICIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQXV0aENvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIGNyZWRlbnRpYWxzXHJcbiAgICAgICRzY29wZS5jcmVkZW50aWFscyA9IHtcclxuICAgICAgICAgICAgZW1haWw6ICcnLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogJydcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgbG9naW4gZXJyb3IgbWVzc2FnZSB2aXNpYmlsaXR5XHJcbiAgICAgICRzY29wZS5mb3JtcmVnaXN0ZXIgPSB7XHJcbiAgICAgICAgICAgIGVycm9yOiBmYWxzZVxyXG4gICAgICB9OyBcclxuXHJcbiAgICAgIC8vIEF1dGhlbnRpY2F0ZVxyXG4gICAgICAkc2NvcGUuYXV0aGVudGljYXRlID0gZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgICAgIC8vIFRyeSB0byBsb2dpbiBcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UubG9naW4oY3JlZGVudGlhbHMpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjdXJyZW50IHVzZXIgYW5kIHJlZGlyZWN0IHRvIHRoZSBjaGF0XHJcbiAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBBdXRoU2VydmljZS5wYXJzZVRva2VuKHJlcy5kYXRhLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLnNldEN1cnJlbnRVc2VyKHBhcmFtcy51c2VyLl9pZCwgcGFyYW1zLnVzZXIuZW1haWwsIHBhcmFtcy51c2VyLnVzZXJuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY2hhdCcpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vIFNob3cgdGhlIGVycm9yXHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5mb3JtcmVnaXN0ZXIuZXJyb3IgPSB0cnVlOyAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbn1dKTsgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdDaGF0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnJHNjZScsICdTb2NrZXRTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgJHNjZSwgU29ja2V0U2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICRzY29wZS5yb29tTGlzdCA9IFtdO1xyXG4gICAgICAkc2NvcGUucm9vbSA9ICdMb2JieSc7XHJcbiAgICAgICRzY29wZS5pbnB1dE1lc3NhZ2UgPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb20gPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgbmFtZS1jaGFuZ2UgYXR0ZW1wdFxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCduYW1lUmVzdWx0JywgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgXHR2YXIgbWVzc2FnZTtcclxuICAgICAgICAgIFx0XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ1lvdSBhcmUgbm93IGtub3duIGFzICcgKyByZXN1bHQubmFtZSArICcuJztcclxuICAgICAgICAgIFx0fSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IHJlc3VsdC5tZXNzYWdlO1xyXG4gICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgcm9vbSBjaGFuZ2UgICAgICAgXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ2pvaW5SZXN1bHQnLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICBcdCRzY29wZS5yb29tID0gcmVzdWx0LnJvb207XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaCgnWW91IGFyZSBub3cgaW4gdGhlIHJvb20gJyArIHJlc3VsdC5yb29tKTtcclxuICAgICAgfSk7ICAgIFxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgcmVjZWl2ZWQgbWVzc2FnZXNcclxuICAgICAgU29ja2V0U2VydmljZS5vbignbWVzc2FnZScsIGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UudGV4dCk7XHJcbiAgICAgIH0pOyAgICBcdFx0XHRcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IGxpc3Qgb2Ygcm9vbXMgYXZhaWxhYmxlXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ3Jvb21zJywgZnVuY3Rpb24gKHJvb21zKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yb29tTGlzdCA9IFtdO1xyXG4gICAgICAgICAgXHRmb3IgKHZhciByb29tIGluIHJvb21zKSB7XHJcbiAgICAgICAgICAgICAgICByb29tID0gcm9vbS5zdWJzdHJpbmcoMSwgcm9vbS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvb20gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJvb21MaXN0LnB1c2gocm9vbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICBcdH1cclxuXHJcbiAgICAgIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIFJlcXVlc3QgbGlzdCBvZiByb29tcyBhdmFpbGFibGUgaW50ZXJtaXR0ZW50bHlcclxuICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ3Jvb21zJyk7XHJcbiAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIEFsbG93IHN1Ym1pdHRpbmcgdGhlIGZvcm0gdG8gc2VuZCBhIGNoYXQgbWVzc2FnZVxyXG4gICAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICBcdHByb2Nlc3NVc2VySW5wdXQobWVzc2FnZSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBBbGxvdyBjbGljayBhIHJvb20gbmFtZSB0byBjaGFuZ2UgdG8gdGhhdCBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuZm9jdXNDaGF0cm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcblx0XHRwcm9jZXNzQ29tbWFuZCgnL2pvaW4gJyArIHJvb20pO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goJ1Jvb20gY2hhbmdlZC4nKTtcclxuXHR9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuY3JlYXRlTmV3Q2hhdHJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICBpZiAoIXJvb20pIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IHRydWU7XHJcblx0ICAgICAgfSBlbHNlIHtcclxuICAgICAgXHRcdCBwcm9jZXNzVXNlcklucHV0KFwiL2pvaW4gXCIgKyByb29tKTtcclxuICAgICAgXHQgIFx0ICQoJyNteU1vZGFsJykubW9kYWwoJ2hpZGUnKTtcclxuICAgICAgXHRcdCAkc2NvcGUubmV3Um9vbUVycm9yID0gZmFsc2U7XHJcbiAgICAgIFx0fVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gU2FuaXppdGUgSHRtbFxyXG4gICAgICAkc2NvcGUuc2FuaXRpemVIdG1sID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh2YWx1ZSk7XHJcbiAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBQcml2YXRlIGhlbHBlcnNcclxuICAgICAgICovXHJcbiAgICAgIFxyXG4gICAgICAvLyBQcm9jZXNzIHRoZSBpbnB1dCBcclxuICAgICAgZnVuY3Rpb24gcHJvY2Vzc1VzZXJJbnB1dChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHZhciBzeXN0ZW1NZXNzYWdlO1xyXG4gICAgICAgICAgXHRcclxuICAgICAgICAgICAgLy8gSWYgdXNlciBpbnB1dCBiZWdpbnMgd2l0aCBzbGFzaCwgdHJlYXQgaXQgYXMgY29tbWFuZFxyXG4gICAgICAgICAgICBpZiAobWVzc2FnZS5jaGFyQXQoMCkgPT0gJy8nKSB7XHJcbiAgICAgICAgICAgICAgICAgIHN5c3RlbU1lc3NhZ2UgPSBwcm9jZXNzQ29tbWFuZChtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKHN5c3RlbU1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goc3lzdGVtTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgLy8gQnJvYWRjYXN0IG5vbmNvbW1hbmQgaW5wdXQgdG8gb3RoZXIgdXNlcnNcclxuICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2UoJHNjb3BlLnJvb20sIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAvLyBUT0RPOiBlc2NhcGFyIGVsIHNpZ3VpZW50ZSBtZW5zYWplXHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKFwiTWU6IFwiICsgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5pbnB1dE1lc3NhZ2UgPSAnJztcclxuICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIFNlbmQgY2hhdCBtZXNzYWdlc1xyXG4gICAgICBmdW5jdGlvbiBzZW5kTWVzc2FnZShyb29tLCB0ZXh0KSB7XHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICByb29tOiByb29tLFxyXG4gICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnbWVzc2FnZScsIG1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICAgIFx0XHJcbiAgICAgIC8vIENoYW5nZSByb29tc1xyXG4gICAgICBmdW5jdGlvbiBjaGFuZ2VSb29tKHJvb20pIHtcclxuICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCdqb2luJywge1xyXG4gICAgICAgICAgICAgICAgICBuZXdSb29tOiByb29tXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFx0XHJcbiAgICAgIC8vIFByb2Nlc3NpbmcgY2hhdCBjb21tYW5kc1xyXG4gICAgICBmdW5jdGlvbiBwcm9jZXNzQ29tbWFuZChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgIHZhciB3b3JkcyA9IGNvbW1hbmQuc3BsaXQoJyAnKTtcclxuICAgICAgICAgICAgLy8gUGFyc2UgY29tbWFuZCBmcm9tIGZpcnN0IHdvcmRcclxuICAgICAgICAgICAgY29tbWFuZCA9IHdvcmRzWzBdXHJcbiAgICAgICAgICAgICAgICAgIC5zdWJzdHJpbmcoMSwgd29yZHNbMF0ubGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBmYWxzZTtcclxuICBcclxuICAgICAgICAgICAgc3dpdGNoIChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ2pvaW4nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3Jkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm9vbSA9IHdvcmRzLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHJvb20gY2hhbmdpbmcgLyBjcmVhdGluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VSb29tKHJvb20pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgY2FzZSAnbmljayc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gd29yZHMuam9pbignICcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgbmFtZS1jaGFuZ2UgYXR0ZW1wdHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCduYW1lQXR0ZW1wdCcsIG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIG1lc3NhZ2UgaWYgY29tbWFuZCBpc24ndCByZWNvZ25pemVkIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ1VucmVjb2duaXplZCBjb21tYW5kLic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcclxuICAgICAgfVxyXG5cclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQ2hhdEhpc3RvcnlDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgJ0FwaUJhc2VVcmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCBBcGlCYXNlVXJsKSB7XHJcbiAgICBcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgIFxyXG4gICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9IFwiTG9iYnlcIjtcclxuICAgXHJcbiAgICAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvY2hhdHJvb20nKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsgICAgICAgIFxyXG4gICAgICAgICRzY29wZS5jaGF0Um9vbXMgPSBkYXRhO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgICRodHRwLmdldChBcGlCYXNlVXJsICsgJy9oaXN0b3J5L0xvYmJ5Jykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9IFwiTG9iYnlcIjtcclxuICAgICAgICAkc2NvcGUuY2hhdExpbmVzID0gZGF0YTsgICAgICAgXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgJHNjb3BlLnJlbG9hZEhpc3RvcnkgPSBmdW5jdGlvbiAoY2hhdFJvb20pIHtcclxuICAgICAgICBnZXRIaXN0b3J5KGNoYXRSb29tKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGdldEhpc3RvcnkoY2hhdFJvb20pIHtcclxuICAgICAgICAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvaGlzdG9yeS8nICsgY2hhdFJvb20pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuY2hhdFJvb21OYW1lID0gY2hhdFJvb207XHJcbiAgICAgICAgICAgICRzY29wZS5jaGF0TGluZXMgPSBkYXRhO1xyXG4gICAgICAgIH0pOyAgICBcclxuICAgIH1cclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignUmVnaXN0ZXJDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgJ0FwaUJhc2VVcmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCBBcGlCYXNlVXJsKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHRoZSBVc2VyXHJcbiAgICAgICRzY29wZS51c2VyID0ge1xyXG4gICAgICAgICAgICBlbWFpbDogJycsXHJcbiAgICAgICAgICAgIHVzZXJuYW1lOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6ICcnXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHJlZ2lzdHJhdGlvbiBlcnJvciBtZXNzYWdlIHZpc2liaWxpdHlcclxuICAgICAgJHNjb3BlLmZvcm1yZWdpc3RlciA9IHtcclxuICAgICAgICAgICAgZXJyb3I6IGZhbHNlXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBSZWdpc3RlciBhIG5ldyB1c2VyXHJcbiAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KEFwaUJhc2VVcmwgKyAnL3VzZXJzJywgeyAndXNlcic6IHVzZXIgfSlcclxuICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWRpcmVjdCB0byB0aGUgY2hhdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xyXG4gICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTaG93IHRoZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZm9ybXJlZ2lzdGVyLmVycm9yID0gdHJ1ZTsgICBcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG59XSk7IiwiLy8gSW5qZWN0IHRoZSAkaW50ZXJjZXB0b3IgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jaWVzXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgWyckcScsICckaW5qZWN0b3InLCBmdW5jdGlvbiAoJHEsICRpbmplY3Rvcikge1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEF1dG9tYXRpY2FsbHkgYXR0YWNoIEF1dGhvcml6YXRpb24gaGVhZGVyXHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uIChjb25maWcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgIHZhciBBdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ0F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ3gtYWNjZXNzLXRva2VuJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgnO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgIFxyXG4gICAgICAgICAgICAvLyBJZiBhIHRva2VuIHdhcyBzZW50IGJhY2ssIHRoZW4gc2F2ZSBpdFxyXG4gICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gcmVzLmRhdGEudG9rZW47XHJcbiAgICAgICAgICAgICAgICAgIHZhciBBdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ0F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2F2ZVRva2VuKHRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgICAgICAgfVxyXG4gIH07XHJcblxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCAnJHdpbmRvdycsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRodHRwLCAkd2luZG93LCBBcGlCYXNlVXJsKSB7XHJcblxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcclxuIFxyXG4gICAgICAvLyBTYXZlIHRoZSB0b2tlbiBpbiB0aGUgbG9jYWwgc3RvcmFnZVxyXG4gICAgICBhdXRoU2VydmljZS5zYXZlVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbiA9IHRva2VuO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUmV0cmlldmUgdGhlIHRva2VuIGluIHRoZSBsb2NhbCBzdG9yYWdlXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmdldFRva2VuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcclxuICAgICAgfTtcclxuICAgICAgICAgICBcclxuICAgICAgLy8gTG9naW4gLSBNYWtlIGEgcmVxdWVzdCB0byB0aGUgYXBpIGZvciBhdXRoZW50aWNhdGluZyAgICAgIFxyXG4gICAgICBhdXRoU2VydmljZS5sb2dpbiA9IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChBcGlCYXNlVXJsICsgJy9hdXRoZW50aWNhdGUnLCBjcmVkZW50aWFscyk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb2dvdXRcclxuICAgICAgYXV0aFNlcnZpY2UubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoYXV0aFNlcnZpY2UuZ2V0VG9rZW4oKSkge1xyXG4gICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdqd3RUb2tlbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiB0aGUgdXNlciBpcyBhdXRoZW50aWNhdGVkXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmlzQXV0aGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gYXV0aFNlcnZpY2UuZ2V0VG9rZW4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGF1dGhTZXJ2aWNlLnBhcnNlVG9rZW4odG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgZGF0ZU5vdyA9IE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSB0b2tlbiBoYXMgbm90IGV4cGlyZWRcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVOb3cgPD0gcGFyYW1zLmV4cDtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBQYXJzZSB0aGUgSlNPTiBXZWIgVG9rZW5cclxuICAgICAgYXV0aFNlcnZpY2UucGFyc2VUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgICAgICB2YXIgYmFzZTY0VXJsID0gdG9rZW4uc3BsaXQoJy4nKVsxXTtcclxuICAgICAgICAgICAgdmFyIGJhc2U2NCA9IGJhc2U2NFVybC5yZXBsYWNlKCctJywnKycpLnJlcGxhY2UoJ18nLCcvJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cuYXRvYihiYXNlNjQpKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBhdXRoU2VydmljZTtcclxufV0pOyIsIi8vIENyZWF0ZSBhIG5ldyBzZXJ2aWNlIGZvciBtYW5hZ2luZyB3ZWJzb2NrZXRzIHdpdGggc29ja2V0SW8uIFxyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ1NvY2tldFNlcnZpY2UnLCBbJyRyb290U2NvcGUnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgdmFyIHNvY2tldFNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KCk7XHJcblxyXG4gICAgICBzb2NrZXRTZXJ2aWNlLm9uID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIHNvY2tldFNlcnZpY2U7XHJcbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=