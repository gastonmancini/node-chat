!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.constant("ApiBaseUrl","http://localhost:3000/api"),t.config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,o){o.interceptors.push("AuthInterceptor"),t.when("/login",{templateUrl:"/views/login.html",controller:"AuthController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}]),t.run(["$route","$rootScope","$location","AuthService",function(t,e,o,r){e.$on("$locationChangeStart",function(e,l,n){var i=o.path(),h=t.routes[i];h&&h.auth&&!r.isAuthed()&&o.path("/login")})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$window","$location","AuthService",function(e,t,r,n){"use strict";e.setCurrentUser=function(e,r,n){var o={_id:e,username:n,email:r};t.localStorage.setItem("currentUser",JSON.stringify(o))},e.getCurrentUser=function(){return JSON.parse(t.localStorage.getItem("currentUser"))},e.isAuthed=function(){return null!==n.isAuthed()&&n.isAuthed()!==!1},e.logout=function(){n.logout(),t.localStorage.removeItem("currentUser"),r.path("/login")}}]);
angular.module("chatApp").controller("AuthController",["$scope","$location","AuthService",function(e,r,t){"use strict";e.credentials={email:"",password:""},e.formregister={error:!1},e.authenticate=function(n){t.login(n).then(function(n){var o=t.parseToken(n.data.token);e.setCurrentUser(o.user._id,o.user.email,o.user.username),r.path("/chat")},function(){e.formregister.error=!0})}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","$http","$location","ApiBaseUrl",function(o,t,c,s){"use strict";function e(c){t.get(s+"/history/"+c).success(function(t){o.chatRoomName=c,o.chatLines=t})}o.chatRoomName="Lobby",t.get(s+"/chatroom").success(function(t){o.chatRooms=t}),t.get(s+"/history/Lobby").success(function(t){o.chatRoomName="Lobby",o.chatLines=t}),o.reloadHistory=function(o){e(o)}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location","ApiBaseUrl",function(r,e,o,s){"use strict";r.user={email:"",username:"",password:""},r.formregister={error:!1},r.register=function(t){e.post(s+"/users",{user:t}).success(function(){o.path("/")}).error(function(){r.formregister.error=!0})}}]);
angular.module("chatApp").factory("AuthInterceptor",["$q","$injector",function(e,t){return{request:function(e){var n=t.get("AuthService"),r=n.getToken();return r&&(e.headers["x-access-token"]=r),e.headers["Content-Type"]="application/json; charset=UTF-8",e},response:function(e){var n=e.data.token,r=t.get("AuthService");return n&&r.saveToken(n),e}}}]);
angular.module("chatApp").factory("AuthService",["$http","$window","ApiBaseUrl",function(e,t,n){"use strict";var o={};return o.saveToken=function(e){t.localStorage.jwtToken=e},o.getToken=function(){return t.localStorage.jwtToken},o.login=function(t){return e.post(n+"/authenticate",t)},o.logout=function(){o.getToken()&&t.localStorage.removeItem("jwtToken")},o.isAuthed=function(){var e=o.getToken();if(e){var t=o.parseToken(e),n=Math.round((new Date).getTime()/1e3);return n<=t.exp}return!1},o.parseToken=function(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))},o}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYXV0aENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2NoYXRIaXN0b3J5Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3JlZ2lzdGVyQ29udHJvbGxlci5qcyIsImludGVyY2VwdG9ycy9hdXRoSW50ZXJjZXB0b3IuanMiLCJzZXJ2aWNlcy9hdXRoU2VydmljZS5qcyIsInNlcnZpY2VzL3NvY2tldFNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImF1dGgiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwicnVuIiwiJHJvdXRlIiwiJHJvb3RTY29wZSIsIiRsb2NhdGlvbiIsIkF1dGhTZXJ2aWNlIiwiJG9uIiwiZXYiLCJuZXh0IiwiY3VycmVudCIsIm5leHRQYXRoIiwicGF0aCIsIm5leHRSb3V0ZSIsInJvdXRlcyIsImlzQXV0aGVkIiwiJHNjb3BlIiwiJHdpbmRvdyIsInNldEN1cnJlbnRVc2VyIiwiX2lkIiwiZW1haWwiLCJ1c2VybmFtZSIsIm1lIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRDdXJyZW50VXNlciIsInBhcnNlIiwiZ2V0SXRlbSIsImxvZ291dCIsInJlbW92ZUl0ZW0iLCJjcmVkZW50aWFscyIsInBhc3N3b3JkIiwiZm9ybXJlZ2lzdGVyIiwiZXJyb3IiLCJhdXRoZW50aWNhdGUiLCJsb2dpbiIsInRoZW4iLCJyZXMiLCJwYXJhbXMiLCJwYXJzZVRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlciIsIiRzY2UiLCJTb2NrZXRTZXJ2aWNlIiwicHJvY2Vzc1VzZXJJbnB1dCIsIm1lc3NhZ2UiLCJzeXN0ZW1NZXNzYWdlIiwiY2hhckF0IiwicHJvY2Vzc0NvbW1hbmQiLCJtZXNzYWdlcyIsInNlbmRNZXNzYWdlIiwicm9vbSIsImlucHV0TWVzc2FnZSIsInRleHQiLCJlbWl0IiwiY2hhbmdlUm9vbSIsIm5ld1Jvb20iLCJjb21tYW5kIiwid29yZHMiLCJzcGxpdCIsInN1YnN0cmluZyIsImxlbmd0aCIsInRvTG93ZXJDYXNlIiwic2hpZnQiLCJqb2luIiwibmFtZSIsInJvb21MaXN0IiwibmV3Um9vbUVycm9yIiwib24iLCJyZXN1bHQiLCJzdWNjZXNzIiwicm9vbXMiLCJzZXRJbnRlcnZhbCIsInN1Ym1pdCIsImZvY3VzQ2hhdHJvb20iLCJjcmVhdGVOZXdDaGF0cm9vbSIsIiQiLCJtb2RhbCIsInNhbml0aXplSHRtbCIsInZhbHVlIiwidHJ1c3RBc0h0bWwiLCIkaHR0cCIsIkFwaUJhc2VVcmwiLCJnZXRIaXN0b3J5IiwiY2hhdFJvb20iLCJnZXQiLCJjaGF0Um9vbU5hbWUiLCJjaGF0TGluZXMiLCJjaGF0Um9vbXMiLCJyZWxvYWRIaXN0b3J5IiwicmVnaXN0ZXIiLCJwb3N0IiwiZmFjdG9yeSIsIiRxIiwiJGluamVjdG9yIiwicmVxdWVzdCIsImdldFRva2VuIiwiaGVhZGVycyIsInJlc3BvbnNlIiwic2F2ZVRva2VuIiwiYXV0aFNlcnZpY2UiLCJqd3RUb2tlbiIsImRhdGVOb3ciLCJNYXRoIiwicm91bmQiLCJEYXRlIiwiZ2V0VGltZSIsImV4cCIsImJhc2U2NFVybCIsImJhc2U2NCIsInJlcGxhY2UiLCJhdG9iIiwic29ja2V0U2VydmljZSIsInNvY2tldCIsImlvIiwiY29ubmVjdCIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5Il0sIm1hcHBpbmdzIjoiQ0FBQSxXQUVBLFlBSUEs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VUUsR0FDN0IsR0FBSW9FLEdBQVlwRSxFQUFNbUIsTUFBTSxLQUFLLEdBQzdCa0QsRUFBU0QsRUFBVUUsUUFBUSxJQUFJLEtBQUtBLFFBQVEsSUFBSSxJQUNwRCxPQUFPeEYsTUFBS0csTUFBTVgsRUFBUWlHLEtBQUtGLEtBRzlCVDtBQ3REYnBILFFBQVFDLE9BQU8sV0FBVzJHLFFBQVEsaUJBQWtCLGFBQWMsU0FBVTNGLEdBRXRFLFlBRUEsSUFBSStHLE1BRUFDLEVBQVNDLEdBQUdDLFNBc0JoQixPQXBCQUgsR0FBYzVDLEdBQUssU0FBVWdELEVBQVdDLEdBQ2xDSixFQUFPN0MsR0FBR2dELEVBQVcsV0FDZixHQUFJRSxHQUFPQyxTQUNYdEgsR0FBV3VILE9BQU8sV0FDWkgsRUFBU0ksTUFBTVIsRUFBUUssUUFLekNOLEVBQWMxRCxLQUFPLFNBQVU4RCxFQUFXN0UsRUFBTThFLEdBQzFDSixFQUFPM0QsS0FBSzhELEVBQVc3RSxFQUFNLFdBQ3ZCLEdBQUkrRSxHQUFPQyxTQUNYdEgsR0FBV3VILE9BQU8sV0FDUkgsR0FDREEsRUFBU0ksTUFBTVIsRUFBUUssUUFNckNOIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtcclxuICAgIFxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG4gICAgXHJcbi8vIERlY2xhcmUgYXBwIGxldmVsIG1vZHVsZVxyXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnLCBbJ25nUm91dGUnLCAnbmdTYW5pdGl6ZSddKTtcclxuXHJcbi8vIERlZmluZSBhIGNvbnN0YW50IHdpdGggdGhlIEFQSSBiYXNlIHVybFxyXG5hcHAuY29uc3RhbnQoJ0FwaUJhc2VVcmwnLCAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaScpO1xyXG5cclxuLy8gQ29uZmlndXJlIHRoZSBhcHBsaWNhdGlvbiByb3V0ZXNcclxuYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZW1vdmUgdGhlIGhhc2ggZnJvbSB1cmxcclxuICAgICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG4gICAgICBcclxuICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXV0aEludGVyY2VwdG9yJyk7XHJcbiAgICAgIFxyXG4gICAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0F1dGhDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogZmFsc2VcclxuICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9jaGF0Jywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jaGF0Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ2hhdENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiB0cnVlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvaGlzdG9yeScsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY2hhdEhpc3RvcnkuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDaGF0SGlzdG9yeUNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiB0cnVlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvcmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlZ2lzdGVyLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnUmVnaXN0ZXJDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogZmFsc2VcclxuICAgICAgfSlcclxuXHJcbiAgICAgIC5vdGhlcndpc2UoeyByZWRpcmVjdFRvOiAnL2xvZ2luJyB9KTtcclxufV0pO1xyXG5cclxuLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZCwgYW5kIGlmIG5vdCByZWRpcmVjdCB0byB0aGUgbG9naW4gcGFnZVxyXG5hcHAucnVuKFsnJHJvdXRlJywgJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRyb3V0ZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICBcclxuICAgICAkcm9vdFNjb3BlLiRvbignJGxvY2F0aW9uQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldiwgbmV4dCwgY3VycmVudCkge1xyXG4gICAgICAgICAgdmFyIG5leHRQYXRoID0gJGxvY2F0aW9uLnBhdGgoKTtcclxuICAgICAgICAgIHZhciBuZXh0Um91dGUgPSAkcm91dGUucm91dGVzW25leHRQYXRoXTsgXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGlmIChuZXh0Um91dGUgJiYgbmV4dFJvdXRlLmF1dGggJiYgIUF1dGhTZXJ2aWNlLmlzQXV0aGVkKCkpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpOyAgICAgICAgICBcclxuICAgICAgICAgIH1cclxuICAgICAgXHJcbiAgICAgfSk7XHJcbiAgICBcclxufV0pO1xyXG5cclxufSkoKTtcclxuIiwiLy8gQ29udGFpbmVyIGZvciB0aGUgZ2xvYmFsIGFwcGxpY2F0aW9uIGxvZ2ljIC8gQWx0ZXJuYXRpdmUgdG8gdGhlIEFuZ3VsYXIncyBydW4gZnVuY3Rpb25cclxuYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdBcHBsaWNhdGlvbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICckd2luZG93JywgJyRsb2NhdGlvbicsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsICR3aW5kb3csICRsb2NhdGlvbiwgQXV0aFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIC8vIFN0b3JlIGN1cnJlbnQgdXNlciBpbmZvXHJcbiAgICAgICRzY29wZS5zZXRDdXJyZW50VXNlciA9IGZ1bmN0aW9uKF9pZCwgZW1haWwsIHVzZXJuYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciBtZSA9IHtcclxuICAgICAgICAgICAgICAgICAgX2lkOiBfaWQsXHJcbiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsXHJcbiAgICAgICAgICAgIH07IFxyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY3VycmVudFVzZXJcIiwgSlNPTi5zdHJpbmdpZnkobWUpKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHJpZXZlIGN1cnJlbnQgdXNlciBpbmZvXHJcbiAgICAgICRzY29wZS5nZXRDdXJyZW50VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VycmVudFVzZXJcIikpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZFxyXG4gICAgICAkc2NvcGUuaXNBdXRoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5pc0F1dGhlZCgpICE9PSBudWxsICYmIEF1dGhTZXJ2aWNlLmlzQXV0aGVkKCkgIT09IGZhbHNlOyAgICAgXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb2dvdXQgZnJvbSB0aGUgY2hhdFxyXG4gICAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5sb2dvdXQoKTtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY3VycmVudFVzZXInKTtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICB9O1xyXG59XSk7ICAiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0F1dGhDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSBjcmVkZW50aWFsc1xyXG4gICAgICAkc2NvcGUuY3JlZGVudGlhbHMgPSB7XHJcbiAgICAgICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6ICcnXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIGxvZ2luIGVycm9yIG1lc3NhZ2UgdmlzaWJpbGl0eVxyXG4gICAgICAkc2NvcGUuZm9ybXJlZ2lzdGVyID0ge1xyXG4gICAgICAgICAgICBlcnJvcjogZmFsc2VcclxuICAgICAgfTsgXHJcblxyXG4gICAgICAvLyBBdXRoZW50aWNhdGVcclxuICAgICAgJHNjb3BlLmF1dGhlbnRpY2F0ZSA9IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xyXG4gICAgICAgICAgICAvLyBUcnkgdG8gbG9naW4gXHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ2luKGNyZWRlbnRpYWxzKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgY3VycmVudCB1c2VyIGFuZCByZWRpcmVjdCB0byB0aGUgY2hhdFxyXG4gICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gQXV0aFNlcnZpY2UucGFyc2VUb2tlbihyZXMuZGF0YS50b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRDdXJyZW50VXNlcihwYXJhbXMudXNlci5faWQsIHBhcmFtcy51c2VyLmVtYWlsLCBwYXJhbXMudXNlci51c2VybmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NoYXQnKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAvLyBTaG93IHRoZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZm9ybXJlZ2lzdGVyLmVycm9yID0gdHJ1ZTsgICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG59XSk7ICIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQ2hhdENvbnRyb2xsZXInLCBbJyRzY29wZScsICckd2luZG93JywgJyRzY2UnLCAnU29ja2V0U2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsICR3aW5kb3csICRzY2UsIFNvY2tldFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgICRzY29wZS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAkc2NvcGUucm9vbUxpc3QgPSBbXTtcclxuICAgICAgJHNjb3BlLnJvb20gPSAnTG9iYnknO1xyXG4gICAgICAkc2NvcGUuaW5wdXRNZXNzYWdlID0gJyc7XHJcbiAgICAgICRzY29wZS5uZXdSb29tID0gJyc7XHJcbiAgICAgICRzY29wZS5uZXdSb29tRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgcmVzdWx0cyBvZiBhIG5hbWUtY2hhbmdlIGF0dGVtcHRcclxuICAgICAgU29ja2V0U2VydmljZS5vbignbmFtZVJlc3VsdCcsIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgIFx0dmFyIG1lc3NhZ2U7XHJcbiAgICAgICAgICBcdFxyXG4gICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdZb3UgYXJlIG5vdyBrbm93biBhcyAnICsgcmVzdWx0Lm5hbWUgKyAnLic7XHJcbiAgICAgICAgICBcdH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSByZXN1bHQubWVzc2FnZTtcclxuICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChtZXNzYWdlKTtcclxuICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgcmVzdWx0cyBvZiBhIHJvb20gY2hhbmdlICAgICAgIFxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCdqb2luUmVzdWx0JywgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgXHQkc2NvcGUucm9vbSA9IHJlc3VsdC5yb29tO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goJ1lvdSBhcmUgbm93IGluIHRoZSByb29tICcgKyByZXN1bHQucm9vbSk7XHJcbiAgICAgIH0pOyAgICBcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IHJlY2VpdmVkIG1lc3NhZ2VzXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ21lc3NhZ2UnLCBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChtZXNzYWdlLnRleHQpO1xyXG4gICAgICB9KTsgICAgXHRcdFx0XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSBsaXN0IG9mIHJvb21zIGF2YWlsYWJsZVxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCdyb29tcycsIGZ1bmN0aW9uIChyb29tcykge1xyXG4gICAgICAgICAgICAkc2NvcGUucm9vbUxpc3QgPSBbXTtcclxuICAgICAgICAgIFx0Zm9yICh2YXIgcm9vbSBpbiByb29tcykge1xyXG4gICAgICAgICAgICAgICAgcm9vbSA9IHJvb20uc3Vic3RyaW5nKDEsIHJvb20ubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIGlmIChyb29tICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yb29tTGlzdC5wdXNoKHJvb20pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgXHR9XHJcblxyXG4gICAgICB9KTtcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBSZXF1ZXN0IGxpc3Qgb2Ygcm9vbXMgYXZhaWxhYmxlIGludGVybWl0dGVudGx5XHJcbiAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCdyb29tcycpO1xyXG4gICAgICB9LCAxMDAwKTtcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBBbGxvdyBzdWJtaXR0aW5nIHRoZSBmb3JtIHRvIHNlbmQgYSBjaGF0IG1lc3NhZ2VcclxuICAgICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgXHRwcm9jZXNzVXNlcklucHV0KG1lc3NhZ2UpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQWxsb3cgY2xpY2sgYSByb29tIG5hbWUgdG8gY2hhbmdlIHRvIHRoYXQgY2hhdHJvb21cclxuICAgICAgJHNjb3BlLmZvY3VzQ2hhdHJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG5cdFx0cHJvY2Vzc0NvbW1hbmQoJy9qb2luICcgKyByb29tKTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKCdSb29tIGNoYW5nZWQuJyk7XHJcblx0fTtcclxuICAgICAgXHJcbiAgICAgIC8vIENyZWF0ZSBuZXcgY2hhdHJvb21cclxuICAgICAgJHNjb3BlLmNyZWF0ZU5ld0NoYXRyb29tID0gZnVuY3Rpb24gKHJvb20pIHtcclxuICAgICAgICAgICAgaWYgKCFyb29tKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5uZXdSb29tRXJyb3IgPSB0cnVlO1xyXG5cdCAgICAgIH0gZWxzZSB7XHJcbiAgICAgIFx0XHQgcHJvY2Vzc1VzZXJJbnB1dChcIi9qb2luIFwiICsgcm9vbSk7XHJcbiAgICAgIFx0ICBcdCAkKCcjbXlNb2RhbCcpLm1vZGFsKCdoaWRlJyk7XHJcbiAgICAgIFx0XHQgJHNjb3BlLm5ld1Jvb21FcnJvciA9IGZhbHNlO1xyXG4gICAgICBcdH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFNhbml6aXRlIEh0bWxcclxuICAgICAgJHNjb3BlLnNhbml0aXplSHRtbCA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwodmFsdWUpO1xyXG4gICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAvKipcclxuICAgICAgICogUHJpdmF0ZSBoZWxwZXJzXHJcbiAgICAgICAqL1xyXG4gICAgICBcclxuICAgICAgLy8gUHJvY2VzcyB0aGUgaW5wdXQgXHJcbiAgICAgIGZ1bmN0aW9uIHByb2Nlc3NVc2VySW5wdXQobWVzc2FnZSkge1xyXG4gICAgICAgICAgICB2YXIgc3lzdGVtTWVzc2FnZTtcclxuICAgICAgICAgIFx0XHJcbiAgICAgICAgICAgIC8vIElmIHVzZXIgaW5wdXQgYmVnaW5zIHdpdGggc2xhc2gsIHRyZWF0IGl0IGFzIGNvbW1hbmRcclxuICAgICAgICAgICAgaWYgKG1lc3NhZ2UuY2hhckF0KDApID09ICcvJykge1xyXG4gICAgICAgICAgICAgICAgICBzeXN0ZW1NZXNzYWdlID0gcHJvY2Vzc0NvbW1hbmQobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChzeXN0ZW1NZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKHN5c3RlbU1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vIEJyb2FkY2FzdCBub25jb21tYW5kIGlucHV0IHRvIG90aGVyIHVzZXJzXHJcbiAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlKCRzY29wZS5yb29tLCBtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgLy8gVE9ETzogZXNjYXBhciBlbCBzaWd1aWVudGUgbWVuc2FqZVxyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChcIk1lOiBcIiArIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaW5wdXRNZXNzYWdlID0gJyc7XHJcbiAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAvLyBTZW5kIGNoYXQgbWVzc2FnZXNcclxuICAgICAgZnVuY3Rpb24gc2VuZE1lc3NhZ2Uocm9vbSwgdGV4dCkge1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgcm9vbTogcm9vbSxcclxuICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ21lc3NhZ2UnLCBtZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgICBcdFxyXG4gICAgICAvLyBDaGFuZ2Ugcm9vbXNcclxuICAgICAgZnVuY3Rpb24gY2hhbmdlUm9vbShyb29tKSB7XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnam9pbicsIHtcclxuICAgICAgICAgICAgICAgICAgbmV3Um9vbTogcm9vbVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBcdFxyXG4gICAgICAvLyBQcm9jZXNzaW5nIGNoYXQgY29tbWFuZHNcclxuICAgICAgZnVuY3Rpb24gcHJvY2Vzc0NvbW1hbmQoY29tbWFuZCkge1xyXG4gICAgICAgICAgICB2YXIgd29yZHMgPSBjb21tYW5kLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgIC8vIFBhcnNlIGNvbW1hbmQgZnJvbSBmaXJzdCB3b3JkXHJcbiAgICAgICAgICAgIGNvbW1hbmQgPSB3b3Jkc1swXVxyXG4gICAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKDEsIHdvcmRzWzBdLmxlbmd0aClcclxuICAgICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gZmFsc2U7XHJcbiAgXHJcbiAgICAgICAgICAgIHN3aXRjaCAoY29tbWFuZCkge1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICdqb2luJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvb20gPSB3b3Jkcy5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSByb29tIGNoYW5naW5nIC8gY3JlYXRpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlUm9vbShyb29tKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ25pY2snOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3Jkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHdvcmRzLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIG5hbWUtY2hhbmdlIGF0dGVtcHRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnbmFtZUF0dGVtcHQnLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBtZXNzYWdlIGlmIGNvbW1hbmQgaXNuJ3QgcmVjb2duaXplZCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdVbnJlY29nbml6ZWQgY29tbWFuZC4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICAgIH1cclxuXHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0NoYXRIaXN0b3J5Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwgQXBpQmFzZVVybCkge1xyXG4gICAgXHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgICBcclxuICAgICRzY29wZS5jaGF0Um9vbU5hbWUgPSBcIkxvYmJ5XCI7XHJcbiAgIFxyXG4gICAgJGh0dHAuZ2V0KEFwaUJhc2VVcmwgKyAnL2NoYXRyb29tJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7ICAgICAgICBcclxuICAgICAgICAkc2NvcGUuY2hhdFJvb21zID0gZGF0YTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvaGlzdG9yeS9Mb2JieScpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICRzY29wZS5jaGF0Um9vbU5hbWUgPSBcIkxvYmJ5XCI7XHJcbiAgICAgICAgJHNjb3BlLmNoYXRMaW5lcyA9IGRhdGE7ICAgICAgIFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgICRzY29wZS5yZWxvYWRIaXN0b3J5ID0gZnVuY3Rpb24gKGNoYXRSb29tKSB7XHJcbiAgICAgICAgZ2V0SGlzdG9yeShjaGF0Um9vbSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBnZXRIaXN0b3J5KGNoYXRSb29tKSB7XHJcbiAgICAgICAgJGh0dHAuZ2V0KEFwaUJhc2VVcmwgKyAnL2hpc3RvcnkvJyArIGNoYXRSb29tKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9IGNoYXRSb29tO1xyXG4gICAgICAgICAgICAkc2NvcGUuY2hhdExpbmVzID0gZGF0YTtcclxuICAgICAgICB9KTsgICAgXHJcbiAgICB9XHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwgQXBpQmFzZVVybCkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgVXNlclxyXG4gICAgICAkc2NvcGUudXNlciA9IHtcclxuICAgICAgICAgICAgZW1haWw6ICcnLFxyXG4gICAgICAgICAgICB1c2VybmFtZTogJycsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiAnJ1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSByZWdpc3RyYXRpb24gZXJyb3IgbWVzc2FnZSB2aXNpYmlsaXR5XHJcbiAgICAgICRzY29wZS5mb3JtcmVnaXN0ZXIgPSB7XHJcbiAgICAgICAgICAgIGVycm9yOiBmYWxzZVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gUmVnaXN0ZXIgYSBuZXcgdXNlclxyXG4gICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgJGh0dHAucG9zdChBcGlCYXNlVXJsICsgJy91c2VycycsIHsgJ3VzZXInOiB1c2VyIH0pXHJcbiAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVkaXJlY3QgdG8gdGhlIGNoYXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyB0aGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZvcm1yZWdpc3Rlci5lcnJvciA9IHRydWU7ICAgXHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxufV0pOyIsIi8vIEluamVjdCB0aGUgJGludGVyY2VwdG9yIHRvIGF2b2lkIGNpcmN1bGFyIGRlcGVuZGVuY2llc1xyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGluamVjdG9yJywgZnVuY3Rpb24gKCRxLCAkaW5qZWN0b3IpIHtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBBdXRvbWF0aWNhbGx5IGF0dGFjaCBBdXRob3JpemF0aW9uIGhlYWRlclxyXG4gICAgICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbiAoY29uZmlnKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICB2YXIgQXV0aFNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KCdBdXRoU2VydmljZScpO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoU2VydmljZS5nZXRUb2tlbigpO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWyd4LWFjY2Vzcy10b2tlbiddID0gdG9rZW47XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PVVURi04JztcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XHJcblxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICBcclxuICAgICAgICAgICAgLy8gSWYgYSB0b2tlbiB3YXMgc2VudCBiYWNrLCB0aGVuIHNhdmUgaXRcclxuICAgICAgICAgICAgcmVzcG9uc2U6IGZ1bmN0aW9uIChyZXMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IHJlcy5kYXRhLnRva2VuO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgQXV0aFNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KCdBdXRoU2VydmljZScpO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnNhdmVUb2tlbih0b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgICAgIH1cclxuICB9O1xyXG5cclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQXV0aFNlcnZpY2UnLCBbJyRodHRwJywgJyR3aW5kb3cnLCAnQXBpQmFzZVVybCcsIGZ1bmN0aW9uICgkaHR0cCwgJHdpbmRvdywgQXBpQmFzZVVybCkge1xyXG5cclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgICAgdmFyIGF1dGhTZXJ2aWNlID0ge307XHJcbiBcclxuICAgICAgLy8gU2F2ZSB0aGUgdG9rZW4gaW4gdGhlIGxvY2FsIHN0b3JhZ2VcclxuICAgICAgYXV0aFNlcnZpY2Uuc2F2ZVRva2VuID0gZnVuY3Rpb24odG9rZW4pIHtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW4gPSB0b2tlbjtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHJpZXZlIHRoZSB0b2tlbiBpbiB0aGUgbG9jYWwgc3RvcmFnZVxyXG4gICAgICBhdXRoU2VydmljZS5nZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW47XHJcbiAgICAgIH07XHJcbiAgICAgICAgICAgXHJcbiAgICAgIC8vIExvZ2luIC0gTWFrZSBhIHJlcXVlc3QgdG8gdGhlIGFwaSBmb3IgYXV0aGVudGljYXRpbmcgICAgICBcclxuICAgICAgYXV0aFNlcnZpY2UubG9naW4gPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoQXBpQmFzZVVybCArICcvYXV0aGVudGljYXRlJywgY3JlZGVudGlhbHMpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gTG9nb3V0XHJcbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKGF1dGhTZXJ2aWNlLmdldFRva2VuKCkpIHtcclxuICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnand0VG9rZW4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZFxyXG4gICAgICBhdXRoU2VydmljZS5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBhdXRoU2VydmljZS5wYXJzZVRva2VuKHRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgdmFyIGRhdGVOb3cgPSBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgdG9rZW4gaGFzIG5vdCBleHBpcmVkXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlTm93IDw9IHBhcmFtcy5leHA7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUGFyc2UgdGhlIEpTT04gV2ViIFRva2VuXHJcbiAgICAgIGF1dGhTZXJ2aWNlLnBhcnNlVG9rZW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XHJcbiAgICAgICAgICAgIHZhciBiYXNlNjQgPSBiYXNlNjRVcmwucmVwbGFjZSgnLScsJysnKS5yZXBsYWNlKCdfJywnLycpO1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LmF0b2IoYmFzZTY0KSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXR1cm4gYXV0aFNlcnZpY2U7XHJcbn1dKTsiLCIvLyBDcmVhdGUgYSBuZXcgc2VydmljZSBmb3IgbWFuYWdpbmcgd2Vic29ja2V0cyB3aXRoIHNvY2tldElvLiBcclxuYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdTb2NrZXRTZXJ2aWNlJywgWyckcm9vdFNjb3BlJywgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIHZhciBzb2NrZXRTZXJ2aWNlID0ge307XHJcblxyXG4gICAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCgpO1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5vbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5lbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0LmVtaXQoZXZlbnROYW1lLCBkYXRhLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBzb2NrZXRTZXJ2aWNlO1xyXG59XSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9