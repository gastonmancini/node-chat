!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.constant("ApiBaseUrl","/api"),t.config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,r){r.interceptors.push("AuthInterceptor"),t.when("/login",{templateUrl:"/views/login.html",controller:"AuthController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}]),t.run(["$route","$rootScope","$location","AuthService",function(t,e,r,o){e.$on("$locationChangeStart",function(e,n,l){var i=r.path(),a=t.routes[i];a&&a.auth&&!o.isAuthed()&&r.path("/login")})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$window","$location","AuthService",function(e,t,r,n){"use strict";e.setCurrentUser=function(e,r,n){var o={_id:e,username:n,email:r};t.localStorage.setItem("currentUser",JSON.stringify(o))},e.getCurrentUser=function(){return JSON.parse(t.localStorage.getItem("currentUser"))},e.isAuthed=function(){return null!==n.isAuthed()&&n.isAuthed()!==!1},e.logout=function(){n.logout(),t.localStorage.removeItem("currentUser"),r.path("/login")}}]);
angular.module("chatApp").controller("AuthController",["$scope","$location","AuthService",function(e,r,t){"use strict";e.credentials={email:"",password:""},e.errorMessage="",e.authenticate=function(a){t.login(a).then(function(a,n,s,o){var u=t.parseToken(a.data.token);e.setCurrentUser(u.user._id,u.user.email,u.user.username),r.path("/chat")},function(r,t,a,n){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","$http","$location","ChatHistoryService",function(e,o,r,t){"use strict";function a(o){t.getChatRoomHistory(o).then(function(r,t,a,n){e.chatRoomName=o,e.chatLines=r.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."})}e.chatRoomName="Lobby",e.errorMessage="",t.getChatRooms().then(function(o,r,t,a){e.chatRooms=o.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."}),a("Lobby"),e.reloadHistory=function(e){return a(e)}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location","UserService","AuthService",function(e,r,s,t,a){"use strict";e.user={email:"",username:"",password:""},e.errorMessage="",e.register=function(r){t.register(r).then(function(r,t,n,o){var u=a.parseToken(r.data.token);e.setCurrentUser(u.user._id,u.user.email,u.user.username),s.path("/chat")},function(r,s,t,a){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").factory("AuthInterceptor",["$q","$injector",function(e,t){return{request:function(e){var n=t.get("AuthService"),r=n.getToken();return r&&(e.headers["x-access-token"]=r),e.headers["Content-Type"]="application/json; charset=UTF-8",e},response:function(e){var n=e.data.token,r=t.get("AuthService");return n&&r.saveToken(n),e}}}]);
angular.module("chatApp").factory("AuthService",["$http","$window","ApiBaseUrl",function(e,t,n){"use strict";var o={};return o.saveToken=function(e){t.localStorage.jwtToken=e},o.getToken=function(){return t.localStorage.jwtToken},o.login=function(t){return e.post(n+"/authenticate",t)},o.logout=function(){o.getToken()&&t.localStorage.removeItem("jwtToken")},o.isAuthed=function(){var e=o.getToken();if(e){var t=o.parseToken(e),n=Math.round((new Date).getTime()/1e3);return n<=t.exp}return!1},o.parseToken=function(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))},o}]);
angular.module("chatApp").factory("ChatHistoryService",["$http","ApiBaseUrl",function(t,r){"use strict";var o={};return o.getChatRoomHistory=function(o){return t.get(r+"/history/"+o)},o.getChatRooms=function(){return t.get(r+"/chatroom")},o}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
angular.module("chatApp").factory("UserService",["$http","ApiBaseUrl",function(r,e){"use strict";var t={};return t.register=function(t){return r.post(e+"/users",{user:t})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYXV0aENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2NoYXRIaXN0b3J5Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3JlZ2lzdGVyQ29udHJvbGxlci5qcyIsImludGVyY2VwdG9ycy9hdXRoSW50ZXJjZXB0b3IuanMiLCJzZXJ2aWNlcy9hdXRoU2VydmljZS5qcyIsInNlcnZpY2VzL2NoYXRIaXN0b3J5U2VydmljZS5qcyIsInNlcnZpY2VzL3NvY2tldFNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiYXV0aCIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCJydW4iLCIkcm91dGUiLCIkcm9vdFNjb3BlIiwiJGxvY2F0aW9uIiwiQXV0aFNlcnZpY2UiLCIkb24iLCJldiIsIm5leHQiLCJjdXJyZW50IiwibmV4dFBhdGgiLCJwYXRoIiwibmV4dFJvdXRlIiwicm91dGVzIiwiaXNBdXRoZWQiLCIkc2NvcGUiLCIkd2luZG93Iiwic2V0Q3VycmVudFVzZXIiLCJfaWQiLCJlbWFpbCIsInVzZXJuYW1lIiwibWUiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldEN1cnJlbnRVc2VyIiwicGFyc2UiLCJnZXRJdGVtIiwibG9nb3V0IiwicmVtb3ZlSXRlbSIsImNyZWRlbnRpYWxzIiwicGFzc3dvcmQiLCJlcnJvck1lc3NhZ2UiLCJhdXRoZW50aWNhdGUiLCJsb2dpbiIsInRoZW4iLCJyZXNwb25zZSIsInN0YXR1cyIsImhlYWRlcnMiLCJwYXJhbXMiLCJwYXJzZVRva2VuIiwiZGF0YSIsInRva2VuIiwidXNlciIsIm1lc3NhZ2UiLCIkc2NlIiwiU29ja2V0U2VydmljZSIsInByb2Nlc3NVc2VySW5wdXQiLCJzeXN0ZW1NZXNzYWdlIiwiY2hhckF0IiwicHJvY2Vzc0NvbW1hbmQiLCJtZXNzYWdlcyIsInNlbmRNZXNzYWdlIiwicm9vbSIsImlucHV0TWVzc2FnZSIsInRleHQiLCJlbWl0IiwiY2hhbmdlUm9vbSIsIm5ld1Jvb20iLCJjb21tYW5kIiwid29yZHMiLCJzcGxpdCIsInN1YnN0cmluZyIsImxlbmd0aCIsInRvTG93ZXJDYXNlIiwic2hpZnQiLCJqb2luIiwibmFtZSIsInJvb21MaXN0IiwibmV3Um9vbUVycm9yIiwib24iLCJyZXN1bHQiLCJzdWNjZXNzIiwicm9vbXMiLCJzZXRJbnRlcnZhbCIsInN1Ym1pdCIsImZvY3VzQ2hhdHJvb20iLCJjcmVhdGVOZXdDaGF0cm9vbSIsIiQiLCJtb2RhbCIsInNhbml0aXplSHRtbCIsInZhbHVlIiwidHJ1c3RBc0h0bWwiLCIkaHR0cCIsIkNoYXRIaXN0b3J5U2VydmljZSIsImdldEhpc3RvcnkiLCJjaGF0Um9vbSIsImdldENoYXRSb29tSGlzdG9yeSIsImNoYXRSb29tTmFtZSIsImNoYXRMaW5lcyIsImdldENoYXRSb29tcyIsImNoYXRSb29tcyIsInJlbG9hZEhpc3RvcnkiLCJVc2VyU2VydmljZSIsInJlZ2lzdGVyIiwiZmFjdG9yeSIsIiRxIiwiJGluamVjdG9yIiwicmVxdWVzdCIsImdldCIsImdldFRva2VuIiwicmVzIiwic2F2ZVRva2VuIiwiQXBpQmFzZVVybCIsImF1dGhTZXJ2aWNlIiwiand0VG9rZW4iLCJwb3N0IiwiZGF0ZU5vdyIsIk1hdGgiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwiYmFzZTY0VXJsIiwiYmFzZTY0IiwicmVwbGFjZSIsImF0b2IiLCJjaGF0SGlzdG9yeVNlcnZpY2UiLCJzb2NrZXRTZXJ2aWNlIiwic29ja2V0IiwiaW8iLCJjb25uZWN0IiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiLCJ1c2VyU2VydmljZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FFQSxZQUlBLElBQUlBLEdBQU1DLFFBQVFDLE9BQU8sV0FBWSxVQUFXLGNBR2hERixHQUFJRyxTQUFTLGFBQWMsUUFHM0JILEVBQUlJLFFBQVEsaUJBQWtCLG9CQUFxQixnQkFBaUIsU0FBVUMsRUFBZ0JDLEVBQW1CQyxHQUszR0EsRUFBY0MsYUFBYUMsS0FBSyxtQkFFaENKLEVBQ09LLEtBQUssVUFDTkMsWUFBYSxvQkFDYkMsV0FBWSxpQkFDWkMsTUFBTSxJQUVMSCxLQUFLLFNBQ05DLFlBQWEsbUJBQ2JDLFdBQVksaUJBQ1pDLE1BQU0sSUFFTEgsS0FBSyxZQUNOQyxZQUFhLDBCQUNiQyxXQUFZLHdCQUNaQyxNQUFNLElBRUxILEtBQUssYUFDTkMsWUFBYSx1QkFDYkMsV0FBWSxxQkFDWkMsTUFBTSxJQUdYQyxXQUFZQyxXQUFZLGNBSS9CZixFQUFJZ0IsS0FBSyxTQUFVLGFBQWMsWUFBYSxjQUFlLFNBQVVDLEVBQVFDLEVBQVlDLEVBQVdDLEdBRWpHRixFQUFXRyxJQUFJLHVCQUF3QixTQUFTQyxFQUFJQyxFQUFNQyxHQUNyRCxHQUFJQyxHQUFXTixFQUFVTyxPQUNyQkMsRUFBWVYsRUFBT1csT0FBT0gsRUFFMUJFLElBQWFBLEVBQVVkLE9BQVNPLEVBQVlTLFlBQzlDVixFQUFVTyxLQUFLO0FDbkQzQnpCLFFBQVFDLE9BQU8sV0FBV1UsV0FBVyx5QkFBMEIsU0FBVSxVQUFXLFlBQWEsY0FBZSxTQUFVa0IsRUFBUUMsRUFBU1osRUFBV0MsR0FFaEosWUFHQVUsR0FBT0UsZUFBaUIsU0FBU0MsRUFBS0MsRUFBT0MsR0FDdkMsR0FBSUMsSUFDRUgsSUFBS0EsRUFDTEUsU0FBVUEsRUFDVkQsTUFBT0EsRUFFYkgsR0FB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SCxHQUFjaEQsR0FBSyxTQUFVb0QsRUFBV0MsR0FDbENKLEVBQU9qRCxHQUFHb0QsRUFBVyxXQUNmLEdBQUlFLEdBQU9DLFNBQ1gzSCxHQUFXNEgsT0FBTyxXQUNaSCxFQUFTSSxNQUFNUixFQUFRSyxRQUt6Q04sRUFBYzlELEtBQU8sU0FBVWtFLEVBQVdqRixFQUFNa0YsR0FDMUNKLEVBQU8vRCxLQUFLa0UsRUFBV2pGLEVBQU0sV0FDdkIsR0FBSW1GLEdBQU9DLFNBQ1gzSCxHQUFXNEgsT0FBTyxXQUNSSCxHQUNEQSxFQUFTSSxNQUFNUixFQUFRSyxRQU1yQ047QUM3QmJySSxRQUFRQyxPQUFPLFdBQVc2RyxRQUFRLGVBQWdCLFFBQVMsYUFBYyxTQUFVWixFQUFPb0IsR0FFcEYsWUFFQSxJQUFJeUIsS0FPSixPQUpBQSxHQUFZbEMsU0FBVyxTQUFVbkQsR0FDN0IsTUFBT3dDLEdBQU11QixLQUFLSCxFQUFhLFVBQVk1RCxLQUFRQSxLQUdoRHFGIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtcclxuICAgIFxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG4gICAgXHJcbi8vIERlY2xhcmUgYXBwIGxldmVsIG1vZHVsZVxyXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnLCBbJ25nUm91dGUnLCAnbmdTYW5pdGl6ZSddKTtcclxuXHJcbi8vIERlZmluZSBhIGNvbnN0YW50IHdpdGggdGhlIEFQSSBiYXNlIHVybFxyXG5hcHAuY29uc3RhbnQoJ0FwaUJhc2VVcmwnLCAnL2FwaScpO1xyXG5cclxuLy8gQ29uZmlndXJlIHRoZSBhcHBsaWNhdGlvbiByb3V0ZXNcclxuYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZW1vdmUgdGhlIGhhc2ggZnJvbSB1cmxcclxuICAgICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG4gICAgICBcclxuICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXV0aEludGVyY2VwdG9yJyk7XHJcbiAgICAgIFxyXG4gICAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0F1dGhDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogZmFsc2VcclxuICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9jaGF0Jywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jaGF0Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ2hhdENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiB0cnVlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvaGlzdG9yeScsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY2hhdEhpc3RvcnkuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDaGF0SGlzdG9yeUNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiB0cnVlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvcmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlZ2lzdGVyLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnUmVnaXN0ZXJDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogZmFsc2VcclxuICAgICAgfSlcclxuXHJcbiAgICAgIC5vdGhlcndpc2UoeyByZWRpcmVjdFRvOiAnL2xvZ2luJyB9KTtcclxufV0pO1xyXG5cclxuLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZCwgYW5kIGlmIG5vdCByZWRpcmVjdCB0byB0aGUgbG9naW4gcGFnZVxyXG5hcHAucnVuKFsnJHJvdXRlJywgJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRyb3V0ZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICBcclxuICAgICAkcm9vdFNjb3BlLiRvbignJGxvY2F0aW9uQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldiwgbmV4dCwgY3VycmVudCkge1xyXG4gICAgICAgICAgdmFyIG5leHRQYXRoID0gJGxvY2F0aW9uLnBhdGgoKTtcclxuICAgICAgICAgIHZhciBuZXh0Um91dGUgPSAkcm91dGUucm91dGVzW25leHRQYXRoXTsgXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGlmIChuZXh0Um91dGUgJiYgbmV4dFJvdXRlLmF1dGggJiYgIUF1dGhTZXJ2aWNlLmlzQXV0aGVkKCkpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpOyAgICAgICAgICBcclxuICAgICAgICAgIH1cclxuICAgICAgXHJcbiAgICAgfSk7XHJcbiAgICBcclxufV0pO1xyXG5cclxufSkoKTtcclxuIiwiLy8gQ29udGFpbmVyIGZvciB0aGUgZ2xvYmFsIGFwcGxpY2F0aW9uIGxvZ2ljIC8gQWx0ZXJuYXRpdmUgdG8gdGhlIEFuZ3VsYXIncyBydW4gZnVuY3Rpb25cclxuYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdBcHBsaWNhdGlvbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICckd2luZG93JywgJyRsb2NhdGlvbicsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsICR3aW5kb3csICRsb2NhdGlvbiwgQXV0aFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIC8vIFN0b3JlIGN1cnJlbnQgdXNlciBpbmZvXHJcbiAgICAgICRzY29wZS5zZXRDdXJyZW50VXNlciA9IGZ1bmN0aW9uKF9pZCwgZW1haWwsIHVzZXJuYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciBtZSA9IHtcclxuICAgICAgICAgICAgICAgICAgX2lkOiBfaWQsXHJcbiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsXHJcbiAgICAgICAgICAgIH07IFxyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY3VycmVudFVzZXJcIiwgSlNPTi5zdHJpbmdpZnkobWUpKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHJpZXZlIGN1cnJlbnQgdXNlciBpbmZvXHJcbiAgICAgICRzY29wZS5nZXRDdXJyZW50VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VycmVudFVzZXJcIikpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZFxyXG4gICAgICAkc2NvcGUuaXNBdXRoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5pc0F1dGhlZCgpICE9PSBudWxsICYmIEF1dGhTZXJ2aWNlLmlzQXV0aGVkKCkgIT09IGZhbHNlOyAgICAgXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb2dvdXQgZnJvbSB0aGUgY2hhdFxyXG4gICAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5sb2dvdXQoKTtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY3VycmVudFVzZXInKTtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICB9O1xyXG59XSk7ICAiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0F1dGhDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSBjcmVkZW50aWFsc1xyXG4gICAgICAkc2NvcGUuY3JlZGVudGlhbHMgPSB7XHJcbiAgICAgICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6ICcnXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHRoZSBlcnJvciBtZXNzYWdlXHJcbiAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnJztcclxuXHJcbiAgICAgIC8vIEF1dGhlbnRpY2F0ZSBcclxuICAgICAgJHNjb3BlLmF1dGhlbnRpY2F0ZSA9IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVHJ5IHRvIGxvZ2luIFxyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5sb2dpbihjcmVkZW50aWFscylcclxuICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gQXV0aFNlcnZpY2UucGFyc2VUb2tlbihyZXNwb25zZS5kYXRhLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNldEN1cnJlbnRVc2VyKHBhcmFtcy51c2VyLl9pZCwgcGFyYW1zLnVzZXIuZW1haWwsIHBhcmFtcy51c2VyLnVzZXJuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9jaGF0Jyk7IFxyXG4gICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7ICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxufV0pOyAiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0NoYXRDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHdpbmRvdycsICckc2NlJywgJ1NvY2tldFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkd2luZG93LCAkc2NlLCBTb2NrZXRTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgJHNjb3BlLnJvb21MaXN0ID0gW107XHJcbiAgICAgICRzY29wZS5yb29tID0gJ0xvYmJ5JztcclxuICAgICAgJHNjb3BlLmlucHV0TWVzc2FnZSA9ICcnO1xyXG4gICAgICAkc2NvcGUubmV3Um9vbSA9ICcnO1xyXG4gICAgICAkc2NvcGUubmV3Um9vbUVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IHJlc3VsdHMgb2YgYSBuYW1lLWNoYW5nZSBhdHRlbXB0XHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ25hbWVSZXN1bHQnLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICBcdHZhciBtZXNzYWdlO1xyXG4gICAgICAgICAgXHRcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnWW91IGFyZSBub3cga25vd24gYXMgJyArIHJlc3VsdC5uYW1lICsgJy4nO1xyXG4gICAgICAgICAgXHR9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlID0gcmVzdWx0Lm1lc3NhZ2U7XHJcbiAgICAgICAgICBcdH1cclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IHJlc3VsdHMgb2YgYSByb29tIGNoYW5nZSAgICAgICBcclxuICAgICAgU29ja2V0U2VydmljZS5vbignam9pblJlc3VsdCcsIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgIFx0JHNjb3BlLnJvb20gPSByZXN1bHQucm9vbTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKCdZb3UgYXJlIG5vdyBpbiB0aGUgcm9vbSAnICsgcmVzdWx0LnJvb20pO1xyXG4gICAgICB9KTsgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZWNlaXZlZCBtZXNzYWdlc1xyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCdtZXNzYWdlJywgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2gobWVzc2FnZS50ZXh0KTtcclxuICAgICAgfSk7ICAgIFx0XHRcdFxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgbGlzdCBvZiByb29tcyBhdmFpbGFibGVcclxuICAgICAgU29ja2V0U2VydmljZS5vbigncm9vbXMnLCBmdW5jdGlvbiAocm9vbXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnJvb21MaXN0ID0gW107XHJcbiAgICAgICAgICBcdGZvciAodmFyIHJvb20gaW4gcm9vbXMpIHtcclxuICAgICAgICAgICAgICAgIHJvb20gPSByb29tLnN1YnN0cmluZygxLCByb29tLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocm9vbSAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucm9vbUxpc3QucHVzaChyb29tKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgIFx0fVxyXG5cclxuICAgICAgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gUmVxdWVzdCBsaXN0IG9mIHJvb21zIGF2YWlsYWJsZSBpbnRlcm1pdHRlbnRseVxyXG4gICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgncm9vbXMnKTtcclxuICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gQWxsb3cgc3VibWl0dGluZyB0aGUgZm9ybSB0byBzZW5kIGEgY2hhdCBtZXNzYWdlXHJcbiAgICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgIFx0cHJvY2Vzc1VzZXJJbnB1dChtZXNzYWdlKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEFsbG93IGNsaWNrIGEgcm9vbSBuYW1lIHRvIGNoYW5nZSB0byB0aGF0IGNoYXRyb29tXHJcbiAgICAgICRzY29wZS5mb2N1c0NoYXRyb29tID0gZnVuY3Rpb24gKHJvb20pIHtcclxuXHRcdHByb2Nlc3NDb21tYW5kKCcvam9pbiAnICsgcm9vbSk7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaCgnUm9vbSBjaGFuZ2VkLicpO1xyXG5cdH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBDcmVhdGUgbmV3IGNoYXRyb29tXHJcbiAgICAgICRzY29wZS5jcmVhdGVOZXdDaGF0cm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcbiAgICAgICAgICAgIGlmICghcm9vbSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubmV3Um9vbUVycm9yID0gdHJ1ZTtcclxuXHQgICAgICB9IGVsc2Uge1xyXG4gICAgICBcdFx0IHByb2Nlc3NVc2VySW5wdXQoXCIvam9pbiBcIiArIHJvb20pO1xyXG4gICAgICBcdCAgXHQgJCgnI215TW9kYWwnKS5tb2RhbCgnaGlkZScpO1xyXG4gICAgICBcdFx0ICRzY29wZS5uZXdSb29tRXJyb3IgPSBmYWxzZTtcclxuICAgICAgXHR9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBTYW5peml0ZSBIdG1sXHJcbiAgICAgICRzY29wZS5zYW5pdGl6ZUh0bWwgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHZhbHVlKTtcclxuICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgLyoqXHJcbiAgICAgICAqIFByaXZhdGUgaGVscGVyc1xyXG4gICAgICAgKi9cclxuICAgICAgXHJcbiAgICAgIC8vIFByb2Nlc3MgdGhlIGlucHV0IFxyXG4gICAgICBmdW5jdGlvbiBwcm9jZXNzVXNlcklucHV0KG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdmFyIHN5c3RlbU1lc3NhZ2U7XHJcbiAgICAgICAgICBcdFxyXG4gICAgICAgICAgICAvLyBJZiB1c2VyIGlucHV0IGJlZ2lucyB3aXRoIHNsYXNoLCB0cmVhdCBpdCBhcyBjb21tYW5kXHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLmNoYXJBdCgwKSA9PSAnLycpIHtcclxuICAgICAgICAgICAgICAgICAgc3lzdGVtTWVzc2FnZSA9IHByb2Nlc3NDb21tYW5kKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAoc3lzdGVtTWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChzeXN0ZW1NZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAvLyBCcm9hZGNhc3Qgbm9uY29tbWFuZCBpbnB1dCB0byBvdGhlciB1c2Vyc1xyXG4gICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZSgkc2NvcGUucm9vbSwgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKFwiTWU6IFwiICsgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5pbnB1dE1lc3NhZ2UgPSAnJztcclxuICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIFNlbmQgY2hhdCBtZXNzYWdlc1xyXG4gICAgICBmdW5jdGlvbiBzZW5kTWVzc2FnZShyb29tLCB0ZXh0KSB7XHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICByb29tOiByb29tLFxyXG4gICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnbWVzc2FnZScsIG1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICAgIFx0XHJcbiAgICAgIC8vIENoYW5nZSByb29tc1xyXG4gICAgICBmdW5jdGlvbiBjaGFuZ2VSb29tKHJvb20pIHtcclxuICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCdqb2luJywge1xyXG4gICAgICAgICAgICAgICAgICBuZXdSb29tOiByb29tXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFx0XHJcbiAgICAgIC8vIFByb2Nlc3NpbmcgY2hhdCBjb21tYW5kc1xyXG4gICAgICBmdW5jdGlvbiBwcm9jZXNzQ29tbWFuZChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgIHZhciB3b3JkcyA9IGNvbW1hbmQuc3BsaXQoJyAnKTtcclxuICAgICAgICAgICAgLy8gUGFyc2UgY29tbWFuZCBmcm9tIGZpcnN0IHdvcmRcclxuICAgICAgICAgICAgY29tbWFuZCA9IHdvcmRzWzBdXHJcbiAgICAgICAgICAgICAgICAgIC5zdWJzdHJpbmcoMSwgd29yZHNbMF0ubGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBmYWxzZTtcclxuICBcclxuICAgICAgICAgICAgc3dpdGNoIChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ2pvaW4nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3Jkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm9vbSA9IHdvcmRzLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHJvb20gY2hhbmdpbmcgLyBjcmVhdGluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VSb29tKHJvb20pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgY2FzZSAnbmljayc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gd29yZHMuam9pbignICcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgbmFtZS1jaGFuZ2UgYXR0ZW1wdHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCduYW1lQXR0ZW1wdCcsIG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIG1lc3NhZ2UgaWYgY29tbWFuZCBpc24ndCByZWNvZ25pemVkIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ1VucmVjb2duaXplZCBjb21tYW5kLic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbWVzc2FnZTtcclxuICAgICAgfVxyXG5cclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQ2hhdEhpc3RvcnlDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgJ0NoYXRIaXN0b3J5U2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sIENoYXRIaXN0b3J5U2VydmljZSkge1xyXG4gICAgXHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgICBcclxuICAgIC8vIEluaXRpYWxpemUgdGhlIGNoYXRyb29tIG5hbWUgICBcclxuICAgICRzY29wZS5jaGF0Um9vbU5hbWUgPSAnTG9iYnknO1xyXG4gICAgXHJcbiAgICAvLyBJbml0aWFsaXplIHRoZSBlcnJvciBtZXNzYWdlXHJcbiAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJyc7XHJcbiAgIFxyXG4gICAgQ2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tcygpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAkc2NvcGUuY2hhdFJvb21zID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9LGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICdBbiBlcnJvciBvY3VycmVkIHJldHJpZXZpbmcgdGhlIGhpc3RvcnkuIFBsZWFzZSByZWxvYWQgZGUgcGFnZS4nO1xyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICBnZXRIaXN0b3J5KCdMb2JieScpO1xyXG4gICAgXHJcbiAgICAkc2NvcGUucmVsb2FkSGlzdG9yeSA9IGZ1bmN0aW9uIChjaGF0Um9vbSkge1xyXG4gICAgICAgIHJldHVybiBnZXRIaXN0b3J5KGNoYXRSb29tKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGdldEhpc3RvcnkoY2hhdFJvb20pIHtcclxuICAgICAgICBDaGF0SGlzdG9yeVNlcnZpY2UuZ2V0Q2hhdFJvb21IaXN0b3J5KGNoYXRSb29tKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2hhdFJvb21OYW1lID0gY2hhdFJvb207XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2hhdExpbmVzID0gcmVzcG9uc2UuZGF0YTsgICAgICAgXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnQW4gZXJyb3Igb2N1cnJlZCByZXRyaWV2aW5nIHRoZSBoaXN0b3J5LiBQbGVhc2UgcmVsb2FkIGRlIHBhZ2UuJzsgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsICdVc2VyU2VydmljZScsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sIFVzZXJTZXJ2aWNlLCBBdXRoU2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgVXNlclxyXG4gICAgICAkc2NvcGUudXNlciA9IHtcclxuICAgICAgICAgICAgZW1haWw6ICcnLFxyXG4gICAgICAgICAgICB1c2VybmFtZTogJycsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiAnJ1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSByZWdpc3RyYXRpb24gZXJyb3IgbWVzc2FnZVxyXG4gICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJyc7XHJcblxyXG4gICAgICAvLyBSZWdpc3RlciBhIG5ldyB1c2VyXHJcbiAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBUcnkgdG8gcmVnaXN0ZXIgXHJcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLnJlZ2lzdGVyKHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IEF1dGhTZXJ2aWNlLnBhcnNlVG9rZW4ocmVzcG9uc2UuZGF0YS50b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRDdXJyZW50VXNlcihwYXJhbXMudXNlci5faWQsIHBhcmFtcy51c2VyLmVtYWlsLCBwYXJhbXMudXNlci51c2VybmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY2hhdCcpOyBcclxuICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlOyAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbn1dKTsiLCIvLyBJbmplY3QgdGhlICRpbnRlcmNlcHRvciB0byBhdm9pZCBjaXJjdWxhciBkZXBlbmRlbmNpZXNcclxuYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdBdXRoSW50ZXJjZXB0b3InLCBbJyRxJywgJyRpbmplY3RvcicsIGZ1bmN0aW9uICgkcSwgJGluamVjdG9yKSB7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQXV0b21hdGljYWxseSBhdHRhY2ggQXV0aG9yaXphdGlvbiBoZWFkZXJcclxuICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIEF1dGhTZXJ2aWNlID0gJGluamVjdG9yLmdldCgnQXV0aFNlcnZpY2UnKTtcclxuICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFNlcnZpY2UuZ2V0VG9rZW4oKTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1sneC1hY2Nlc3MtdG9rZW4nXSA9IHRva2VuO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCc7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgXHJcbiAgICAgICAgICAgIC8vIElmIGEgdG9rZW4gd2FzIHNlbnQgYmFjaywgdGhlbiBzYXZlIGl0XHJcbiAgICAgICAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbiAocmVzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSByZXMuZGF0YS50b2tlbjtcclxuICAgICAgICAgICAgICAgICAgdmFyIEF1dGhTZXJ2aWNlID0gJGluamVjdG9yLmdldCgnQXV0aFNlcnZpY2UnKTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBdXRoU2VydmljZS5zYXZlVG9rZW4odG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgICAgICB9XHJcbiAgfTtcclxuXHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgWyckaHR0cCcsICckd2luZG93JywgJ0FwaUJhc2VVcmwnLCBmdW5jdGlvbiAoJGh0dHAsICR3aW5kb3csIEFwaUJhc2VVcmwpIHtcclxuXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICAgIHZhciBhdXRoU2VydmljZSA9IHt9O1xyXG4gXHJcbiAgICAgIC8vIFNhdmUgdGhlIHRva2VuIGluIHRoZSBsb2NhbCBzdG9yYWdlXHJcbiAgICAgIGF1dGhTZXJ2aWNlLnNhdmVUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuID0gdG9rZW47XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZXRyaWV2ZSB0aGUgdG9rZW4gaW4gdGhlIGxvY2FsIHN0b3JhZ2VcclxuICAgICAgYXV0aFNlcnZpY2UuZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuO1xyXG4gICAgICB9O1xyXG4gICAgICAgICAgIFxyXG4gICAgICAvLyBMb2dpbiAtIE1ha2UgYSByZXF1ZXN0IHRvIHRoZSBhcGkgZm9yIGF1dGhlbnRpY2F0aW5nICAgICAgXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luID0gZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KEFwaUJhc2VVcmwgKyAnL2F1dGhlbnRpY2F0ZScsIGNyZWRlbnRpYWxzKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIExvZ291dFxyXG4gICAgICBhdXRoU2VydmljZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5nZXRUb2tlbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2p3dFRva2VuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcclxuICAgICAgYXV0aFNlcnZpY2UuaXNBdXRoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBhdXRoU2VydmljZS5nZXRUb2tlbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gYXV0aFNlcnZpY2UucGFyc2VUb2tlbih0b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBkYXRlTm93ID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHRva2VuIGhhcyBub3QgZXhwaXJlZFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZU5vdyA8PSBwYXJhbXMuZXhwO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFBhcnNlIHRoZSBKU09OIFdlYiBUb2tlblxyXG4gICAgICBhdXRoU2VydmljZS5wYXJzZVRva2VuID0gZnVuY3Rpb24gKHRva2VuKSB7XHJcbiAgICAgICAgICAgIHZhciBiYXNlNjRVcmwgPSB0b2tlbi5zcGxpdCgnLicpWzFdO1xyXG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCcrJykucmVwbGFjZSgnXycsJy8nKTtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdDaGF0SGlzdG9yeVNlcnZpY2UnLCBbJyRodHRwJywgJ0FwaUJhc2VVcmwnLCBmdW5jdGlvbiAoJGh0dHAsIEFwaUJhc2VVcmwpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIHZhciBjaGF0SGlzdG9yeVNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgY2hhdCBoaXN0b3J5IG9mIGEgZ2l2ZW4gY2hhdHJvb20gXHJcbiAgICAgIGNoYXRIaXN0b3J5U2VydmljZS5nZXRDaGF0Um9vbUhpc3RvcnkgPSBmdW5jdGlvbiAoY2hhdFJvb20pIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChBcGlCYXNlVXJsICsgJy9oaXN0b3J5LycgKyBjaGF0Um9vbSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBHZXQgYWxsIHRoZSBjaGF0cm9vbXMgdGhhdCBoYXZlIGhpc3RvcnlcclxuICAgICAgY2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChBcGlCYXNlVXJsICsgJy9jaGF0cm9vbScpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIGNoYXRIaXN0b3J5U2VydmljZTtcclxufV0pOyIsIi8vIENyZWF0ZSBhIG5ldyBzZXJ2aWNlIGZvciBtYW5hZ2luZyB3ZWJzb2NrZXRzIHdpdGggc29ja2V0SW8uIFxyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ1NvY2tldFNlcnZpY2UnLCBbJyRyb290U2NvcGUnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgdmFyIHNvY2tldFNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KCk7XHJcblxyXG4gICAgICBzb2NrZXRTZXJ2aWNlLm9uID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIHNvY2tldFNlcnZpY2U7XHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgWyckaHR0cCcsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRodHRwLCBBcGlCYXNlVXJsKSB7XHJcblxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICB2YXIgdXNlclNlcnZpY2UgPSB7fTtcclxuICAgICAgICAgICAgXHJcbiAgICAgIC8vIFJlZ2lzdGVyIGEgbmV3IHVzZXIgICAgICBcclxuICAgICAgdXNlclNlcnZpY2UucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoQXBpQmFzZVVybCArICcvdXNlcnMnLCB7ICd1c2VyJzogdXNlciB9KTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB1c2VyU2VydmljZTtcclxufV0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==