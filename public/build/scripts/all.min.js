!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.constant("ApiBaseUrl","/api"),t.config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,r){r.interceptors.push("AuthInterceptor"),t.when("/login",{templateUrl:"/views/login.html",controller:"LoginController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}]),t.run(["$route","$rootScope","$location","AuthService",function(t,e,r,o){e.$on("$locationChangeStart",function(e,n,l){var i=r.path(),a=t.routes[i];a&&a.auth&&!o.isAuthed()&&r.path("/login")})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$window","$location","AuthService",function(e,t,r,n){"use strict";e.setCurrentUser=function(e,r,n){var o={_id:e,username:n,email:r};t.localStorage.setItem("currentUser",JSON.stringify(o))},e.getCurrentUser=function(){return JSON.parse(t.localStorage.getItem("currentUser"))},e.isAuthed=function(){return null!==n.isAuthed()&&n.isAuthed()!==!1},e.logout=function(){n.logout(),t.localStorage.removeItem("currentUser"),r.path("/login")}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","ChatHistoryService",function(e,o){"use strict";function r(){o.getChatRooms().then(function(o,r,t,a){e.chatRooms=o.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."}),t("Lobby")}function t(r){o.getChatRoomHistory(r).then(function(o,t,a,n){e.chatRoomName=r,e.chatLines=o.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."})}e.chatRoomName="Lobby",e.errorMessage="",r(),e.reloadHistory=function(e){return t(e)}}]);
angular.module("chatApp").controller("LoginController",["$scope","$location","AuthService",function(e,r,t){"use strict";e.credentials={email:"",password:""},e.errorMessage="",e.authenticate=function(a){t.login(a).then(function(a,n,o,s){var i=t.parseToken(a.data.token);e.setCurrentUser(i.user._id,i.user.email,i.user.username),r.path("/chat")},function(r,t,a,n){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location","UserService","AuthService",function(e,r,s,t,a){"use strict";e.user={email:"",username:"",password:""},e.errorMessage="",e.register=function(r){t.register(r).then(function(r,t,n,o){var u=a.parseToken(r.data.token);e.setCurrentUser(u.user._id,u.user.email,u.user.username),s.path("/chat")},function(r,s,t,a){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").factory("AuthInterceptor",["$q","$injector",function(e,t){return{request:function(e){var n=t.get("AuthService"),r=n.getToken();return r&&(e.headers["x-access-token"]=r),e.headers["Content-Type"]="application/json; charset=UTF-8",e},response:function(e){var n=e.data.token,r=t.get("AuthService");return n&&r.saveToken(n),e}}}]);
angular.module("chatApp").factory("AuthService",["$http","$window","ApiBaseUrl",function(e,t,n){"use strict";var o={};return o.saveToken=function(e){t.localStorage.setItem("jwtToken",e)},o.getToken=function(){return t.localStorage.getItem("jwtToken")},o.login=function(t){return e.post(n+"/authenticate",t)},o.logout=function(){o.getToken()&&t.localStorage.removeItem("jwtToken")},o.isAuthed=function(){var e=o.getToken();if(e){var t=o.parseToken(e),n=Math.round((new Date).getTime()/1e3);return n<=t.exp}return!1},o.parseToken=function(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))},o}]);
angular.module("chatApp").factory("ChatHistoryService",["$http","ApiBaseUrl",function(t,r){"use strict";var o={};return o.getChatRoomHistory=function(o){return t.get(r+"/history/"+o)},o.getChatRooms=function(){return t.get(r+"/chatroom")},o}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
angular.module("chatApp").factory("UserService",["$http","ApiBaseUrl",function(r,e){"use strict";var t={};return t.register=function(t){return r.post(e+"/users",{user:t})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvY2hhdENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0SGlzdG9yeUNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9yZWdpc3RlckNvbnRyb2xsZXIuanMiLCJpbnRlcmNlcHRvcnMvYXV0aEludGVyY2VwdG9yLmpzIiwic2VydmljZXMvYXV0aFNlcnZpY2UuanMiLCJzZXJ2aWNlcy9jaGF0SGlzdG9yeVNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlclNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImF1dGgiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwicnVuIiwiJHJvdXRlIiwiJHJvb3RTY29wZSIsIiRsb2NhdGlvbiIsIkF1dGhTZXJ2aWNlIiwiJG9uIiwiZXYiLCJuZXh0IiwiY3VycmVudCIsIm5leHRQYXRoIiwicGF0aCIsIm5leHRSb3V0ZSIsInJvdXRlcyIsImlzQXV0aGVkIiwiJHNjb3BlIiwiJHdpbmRvdyIsInNldEN1cnJlbnRVc2VyIiwiX2lkIiwiZW1haWwiLCJ1c2VybmFtZSIsIm1lIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRDdXJyZW50VXNlciIsInBhcnNlIiwiZ2V0SXRlbSIsImxvZ291dCIsInJlbW92ZUl0ZW0iLCIkc2NlIiwiU29ja2V0U2VydmljZSIsInByb2Nlc3NVc2VySW5wdXQiLCJtZXNzYWdlIiwic3lzdGVtTWVzc2FnZSIsImNoYXJBdCIsInByb2Nlc3NDb21tYW5kIiwibWVzc2FnZXMiLCJzZW5kTWVzc2FnZSIsInJvb20iLCJpbnB1dE1lc3NhZ2UiLCJ0ZXh0IiwiZW1pdCIsImNoYW5nZVJvb20iLCJuZXdSb29tIiwiY29tbWFuZCIsIndvcmRzIiwic3BsaXQiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsInNoaWZ0Iiwiam9pbiIsIm5hbWUiLCJyb29tTGlzdCIsIm5ld1Jvb21FcnJvciIsIm9uIiwicmVzdWx0Iiwic3VjY2VzcyIsInJvb21zIiwic2V0SW50ZXJ2YWwiLCJzdWJtaXQiLCJmb2N1c0NoYXRyb29tIiwiY3JlYXRlTmV3Q2hhdHJvb20iLCIkIiwibW9kYWwiLCJzYW5pdGl6ZUh0bWwiLCJ2YWx1ZSIsInRydXN0QXNIdG1sIiwiQ2hhdEhpc3RvcnlTZXJ2aWNlIiwibG9hZERlZmF1bHREYXRhIiwiZ2V0Q2hhdFJvb21zIiwidGhlbiIsInJlc3BvbnNlIiwic3RhdHVzIiwiaGVhZGVycyIsImNoYXRSb29tcyIsImRhdGEiLCJlcnJvck1lc3NhZ2UiLCJnZXRIaXN0b3J5IiwiY2hhdFJvb20iLCJnZXRDaGF0Um9vbUhpc3RvcnkiLCJjaGF0Um9vbU5hbWUiLCJjaGF0TGluZXMiLCJyZWxvYWRIaXN0b3J5IiwiY3JlZGVudGlhbHMiLCJwYXNzd29yZCIsImF1dGhlbnRpY2F0ZSIsImxvZ2luIiwicGFyYW1zIiwicGFyc2VUb2tlbiIsInRva2VuIiwidXNlciIsIiRodHRwIiwiVXNlclNlcnZpY2UiLCJyZWdpc3RlciIsImZhY3RvcnkiLCIkcSIsIiRpbmplY3RvciIsInJlcXVlc3QiLCJnZXQiLCJnZXRUb2tlbiIsInJlcyIsInNhdmVUb2tlbiIsIkFwaUJhc2VVcmwiLCJhdXRoU2VydmljZSIsInBvc3QiLCJkYXRlTm93IiwiTWF0aCIsInJvdW5kIiwiRGF0ZSIsImdldFRpbWUiLCJleHAiLCJiYXNlNjRVcmwiLCJiYXNlNjQiLCJyZXBsYWNlIiwiYXRvYiIsImNoYXRIaXN0b3J5U2VydmljZSIsInNvY2tldFNlcnZpY2UiLCJzb2NrZXQiLCJpbyIsImNvbm5lY3QiLCJldmVudE5hbWUiLCJjYWxsYmFjayIsImFyZ3MiLCJhcmd1bWVudHMiLCIkYXBwbHkiLCJhcHBseSIsInVzZXJTZXJ2aWNlIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUVBLFlBSUEsSUFBSUEsR0FBTUMsUUFBUUMsT0FBTyxXQUFZLFVBQVcsY0FHaERGLEdBQUlHLFNBQVMsYUFBYyxRQUczQkgsRUFBSUksUUFBUSxpQkFBa0Isb0JBQXFCLGdCQUFpQixTQUFVQyxFQUFnQkMsRUFBbUJDLEdBSzNHQSxFQUFjQyxhQUFhQyxLQUFLLG1CQUVoQ0osRUFDT0ssS0FBSyxVQUNOQyxZQUFhLG9CQUNiQyxXQUFZLGtCQUNaQyxNQUFNLElBRUxILEtBQUssU0FDTkMsWUFBYSxtQkFDYkMsV0FBWSxpQkFDWkMsTUFBTSxJQUVMSCxLQUFLLFlBQ05DLFlBQWEsMEJBQ2JDLFdBQVksd0JBQ1pDLE1BQU0sSUFFTEgsS0FBSyxhQUNOQyxZQUFhLHVCQUNiQyxXQUFZLHFCQUNaQyxNQUFNLElBR1hDLFdBQVlDLFdBQVksY0FJL0JmLEVBQUlnQixLQUFLLFNBQVUsYUFBYyxZQUFhLGNBQWUsU0FBVUMsRUFBUUMsRUFBWUMsRUFBV0MsR0FFakdGLEVBQVdHLElBQUksdUJBQXdCLFNBQVNDLEVBQUlDLEVBQU1DLEdBQ3JELEdBQUlDLEdBQVdOLEVBQVVPLE9BQ3JCQyxFQUFZVixFQUFPVyxPQUFPSCxFQUUxQkUsSUFBYUEsRUFBVWQsT0FBU08sRUFBWVMsWUFDOUNWLEVBQVVPLEtBQUs7QUNuRDNCekIsUUFBUUMsT0FBTyxXQUFXVSxXQUFXLHlCQUEwQixTQUFVLFVBQVcsWUFBYSxjQUFlLFNBQVVrQixFQUFRQyxFQUFTWixFQUFXQyxHQUVoSixZQUdBVSxHQUFPRSxlQUFpQixTQUFTQyxFQUFLQyxFQUFPQyxHQUN2QyxHQUFJQyxJQUNFSCxJQUFLQSxFQUNMRSxTQUFVQSxFQUNWRCxNQUFPQSxF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QUFLLFNBQVVrRSxFQUFXQyxHQUNsQ0osRUFBTy9ELEdBQUdrRSxFQUFXLFdBQ2YsR0FBSUUsR0FBT0MsU0FDWDNILEdBQVc0SCxPQUFPLFdBQ1pILEVBQVNJLE1BQU1SLEVBQVFLLFFBS3pDTixFQUFjNUUsS0FBTyxTQUFVZ0YsRUFBVzdDLEVBQU04QyxHQUMxQ0osRUFBTzdFLEtBQUtnRixFQUFXN0MsRUFBTSxXQUN2QixHQUFJK0MsR0FBT0MsU0FDWDNILEdBQVc0SCxPQUFPLFdBQ1JILEdBQ0RBLEVBQVNJLE1BQU1SLEVBQVFLLFFBTXJDTjtBQzdCYnJJLFFBQVFDLE9BQU8sV0FBVzhHLFFBQVEsZUFBZ0IsUUFBUyxhQUFjLFNBQVVILEVBQU9XLEdBRXBGLFlBRUEsSUFBSXdCLEtBT0osT0FKQUEsR0FBWWpDLFNBQVcsU0FBVUgsR0FDN0IsTUFBT0MsR0FBTWEsS0FBS0YsRUFBYSxVQUFZWixLQUFRQSxLQUdoRG9DIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtcclxuICAgIFxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG4gICAgXHJcbi8vIERlY2xhcmUgYXBwIGxldmVsIG1vZHVsZVxyXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnLCBbJ25nUm91dGUnLCAnbmdTYW5pdGl6ZSddKTtcclxuXHJcbi8vIERlZmluZSBhIGNvbnN0YW50IHdpdGggdGhlIEFQSSBiYXNlIHVybFxyXG5hcHAuY29uc3RhbnQoJ0FwaUJhc2VVcmwnLCAnL2FwaScpO1xyXG5cclxuLy8gQ29uZmlndXJlIHRoZSBhcHBsaWNhdGlvbiByb3V0ZXNcclxuYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZW1vdmUgdGhlIGhhc2ggZnJvbSB1cmxcclxuICAgICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG4gICAgICBcclxuICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXV0aEludGVyY2VwdG9yJyk7XHJcbiAgICAgIFxyXG4gICAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IGZhbHNlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvY2hhdCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY2hhdC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NoYXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogdHJ1ZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL2hpc3RvcnknLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NoYXRIaXN0b3J5Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ2hhdEhpc3RvcnlDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogdHJ1ZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWdpc3Rlci5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IGZhbHNlXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICAub3RoZXJ3aXNlKHsgcmVkaXJlY3RUbzogJy9sb2dpbicgfSk7XHJcbn1dKTtcclxuXHJcbi8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWQsIGFuZCBpZiBub3QgcmVkaXJlY3QgdG8gdGhlIGxvZ2luIHBhZ2VcclxuYXBwLnJ1bihbJyRyb3V0ZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkcm91dGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgQXV0aFNlcnZpY2UpIHtcclxuICAgXHJcbiAgICAgJHJvb3RTY29wZS4kb24oJyRsb2NhdGlvbkNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oZXYsIG5leHQsIGN1cnJlbnQpIHtcclxuICAgICAgICAgIHZhciBuZXh0UGF0aCA9ICRsb2NhdGlvbi5wYXRoKCk7XHJcbiAgICAgICAgICB2YXIgbmV4dFJvdXRlID0gJHJvdXRlLnJvdXRlc1tuZXh0UGF0aF07IFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAobmV4dFJvdXRlICYmIG5leHRSb3V0ZS5hdXRoICYmICFBdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTsgICAgICAgICAgXHJcbiAgICAgICAgICB9XHJcbiAgICAgIFxyXG4gICAgIH0pO1xyXG4gICAgXHJcbn1dKTtcclxuXHJcbn0pKCk7XHJcbiIsIi8vIENvbnRhaW5lciBmb3IgdGhlIGdsb2JhbCBhcHBsaWNhdGlvbiBsb2dpYyAvIEFsdGVybmF0aXZlIHRvIHRoZSBBbmd1bGFyJ3MgcnVuIGZ1bmN0aW9uXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQXBwbGljYXRpb25Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJHdpbmRvdycsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkd2luZG93LCAkbG9jYXRpb24sIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBTdG9yZSBjdXJyZW50IHVzZXIgaW5mb1xyXG4gICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbihfaWQsIGVtYWlsLCB1c2VybmFtZSkge1xyXG4gICAgICAgICAgICB2YXIgbWUgPSB7XHJcbiAgICAgICAgICAgICAgICAgIF9pZDogX2lkLFxyXG4gICAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbFxyXG4gICAgICAgICAgICB9OyBcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImN1cnJlbnRVc2VyXCIsIEpTT04uc3RyaW5naWZ5KG1lKSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZXRyaWV2ZSBjdXJyZW50IHVzZXIgaW5mb1xyXG4gICAgICAkc2NvcGUuZ2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImN1cnJlbnRVc2VyXCIpKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcclxuICAgICAgJHNjb3BlLmlzQXV0aGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gQXV0aFNlcnZpY2UuaXNBdXRoZWQoKSAhPT0gbnVsbCAmJiBBdXRoU2VydmljZS5pc0F1dGhlZCgpICE9PSBmYWxzZTsgICAgIFxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gTG9nb3V0IGZyb20gdGhlIGNoYXRcclxuICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UubG9nb3V0KCk7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2N1cnJlbnRVc2VyJyk7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgfTtcclxufV0pOyAgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdDaGF0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnJHNjZScsICdTb2NrZXRTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgJHNjZSwgU29ja2V0U2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICRzY29wZS5yb29tTGlzdCA9IFtdO1xyXG4gICAgICAkc2NvcGUucm9vbSA9ICdMb2JieSc7XHJcbiAgICAgICRzY29wZS5pbnB1dE1lc3NhZ2UgPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb20gPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgbmFtZS1jaGFuZ2UgYXR0ZW1wdFxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCduYW1lUmVzdWx0JywgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgXHR2YXIgbWVzc2FnZTtcclxuICAgICAgICAgIFx0XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ1lvdSBhcmUgbm93IGtub3duIGFzICcgKyByZXN1bHQubmFtZSArICcuJztcclxuICAgICAgICAgIFx0fSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IHJlc3VsdC5tZXNzYWdlO1xyXG4gICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgcm9vbSBjaGFuZ2UgICAgICAgXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ2pvaW5SZXN1bHQnLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICBcdCRzY29wZS5yb29tID0gcmVzdWx0LnJvb207XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaCgnWW91IGFyZSBub3cgaW4gdGhlIHJvb20gJyArIHJlc3VsdC5yb29tKTtcclxuICAgICAgfSk7ICAgIFxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgcmVjZWl2ZWQgbWVzc2FnZXNcclxuICAgICAgU29ja2V0U2VydmljZS5vbignbWVzc2FnZScsIGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UudGV4dCk7XHJcbiAgICAgIH0pOyAgICBcdFx0XHRcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IGxpc3Qgb2Ygcm9vbXMgYXZhaWxhYmxlXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ3Jvb21zJywgZnVuY3Rpb24gKHJvb21zKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yb29tTGlzdCA9IFtdO1xyXG4gICAgICAgICAgXHRmb3IgKHZhciByb29tIGluIHJvb21zKSB7XHJcbiAgICAgICAgICAgICAgICByb29tID0gcm9vbS5zdWJzdHJpbmcoMSwgcm9vbS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvb20gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJvb21MaXN0LnB1c2gocm9vbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICBcdH1cclxuXHJcbiAgICAgIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIFJlcXVlc3QgbGlzdCBvZiByb29tcyBhdmFpbGFibGUgaW50ZXJtaXR0ZW50bHlcclxuICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ3Jvb21zJyk7XHJcbiAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIEFsbG93IHN1Ym1pdHRpbmcgdGhlIGZvcm0gdG8gc2VuZCBhIGNoYXQgbWVzc2FnZVxyXG4gICAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICBcdHByb2Nlc3NVc2VySW5wdXQobWVzc2FnZSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBBbGxvdyBjbGljayBhIHJvb20gbmFtZSB0byBjaGFuZ2UgdG8gdGhhdCBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuZm9jdXNDaGF0cm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcblx0XHRwcm9jZXNzQ29tbWFuZCgnL2pvaW4gJyArIHJvb20pO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goJ1Jvb20gY2hhbmdlZC4nKTtcclxuXHR9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuY3JlYXRlTmV3Q2hhdHJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICBpZiAoIXJvb20pIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IHRydWU7XHJcblx0ICAgICAgfSBlbHNlIHtcclxuICAgICAgXHRcdCBwcm9jZXNzVXNlcklucHV0KFwiL2pvaW4gXCIgKyByb29tKTtcclxuICAgICAgXHQgIFx0ICQoJyNteU1vZGFsJykubW9kYWwoJ2hpZGUnKTtcclxuICAgICAgXHRcdCAkc2NvcGUubmV3Um9vbUVycm9yID0gZmFsc2U7XHJcbiAgICAgIFx0fVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gU2FuaXppdGUgSHRtbFxyXG4gICAgICAkc2NvcGUuc2FuaXRpemVIdG1sID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh2YWx1ZSk7XHJcbiAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBQcml2YXRlIGhlbHBlcnNcclxuICAgICAgICovXHJcbiAgICAgIFxyXG4gICAgICAvLyBQcm9jZXNzIHRoZSBpbnB1dCBcclxuICAgICAgZnVuY3Rpb24gcHJvY2Vzc1VzZXJJbnB1dChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHZhciBzeXN0ZW1NZXNzYWdlO1xyXG4gICAgICAgICAgXHRcclxuICAgICAgICAgICAgLy8gSWYgdXNlciBpbnB1dCBiZWdpbnMgd2l0aCBzbGFzaCwgdHJlYXQgaXQgYXMgY29tbWFuZFxyXG4gICAgICAgICAgICBpZiAobWVzc2FnZS5jaGFyQXQoMCkgPT0gJy8nKSB7XHJcbiAgICAgICAgICAgICAgICAgIHN5c3RlbU1lc3NhZ2UgPSBwcm9jZXNzQ29tbWFuZChtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKHN5c3RlbU1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goc3lzdGVtTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgLy8gQnJvYWRjYXN0IG5vbmNvbW1hbmQgaW5wdXQgdG8gb3RoZXIgdXNlcnNcclxuICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2UoJHNjb3BlLnJvb20sIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChcIk1lOiBcIiArIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaW5wdXRNZXNzYWdlID0gJyc7XHJcbiAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAvLyBTZW5kIGNoYXQgbWVzc2FnZXNcclxuICAgICAgZnVuY3Rpb24gc2VuZE1lc3NhZ2Uocm9vbSwgdGV4dCkge1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgcm9vbTogcm9vbSxcclxuICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ21lc3NhZ2UnLCBtZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgICBcdFxyXG4gICAgICAvLyBDaGFuZ2Ugcm9vbXNcclxuICAgICAgZnVuY3Rpb24gY2hhbmdlUm9vbShyb29tKSB7XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnam9pbicsIHtcclxuICAgICAgICAgICAgICAgICAgbmV3Um9vbTogcm9vbVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBcdFxyXG4gICAgICAvLyBQcm9jZXNzaW5nIGNoYXQgY29tbWFuZHNcclxuICAgICAgZnVuY3Rpb24gcHJvY2Vzc0NvbW1hbmQoY29tbWFuZCkge1xyXG4gICAgICAgICAgICB2YXIgd29yZHMgPSBjb21tYW5kLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgIC8vIFBhcnNlIGNvbW1hbmQgZnJvbSBmaXJzdCB3b3JkXHJcbiAgICAgICAgICAgIGNvbW1hbmQgPSB3b3Jkc1swXVxyXG4gICAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKDEsIHdvcmRzWzBdLmxlbmd0aClcclxuICAgICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gZmFsc2U7XHJcbiAgXHJcbiAgICAgICAgICAgIHN3aXRjaCAoY29tbWFuZCkge1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICdqb2luJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvb20gPSB3b3Jkcy5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSByb29tIGNoYW5naW5nIC8gY3JlYXRpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlUm9vbShyb29tKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ25pY2snOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3Jkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHdvcmRzLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIG5hbWUtY2hhbmdlIGF0dGVtcHRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnbmFtZUF0dGVtcHQnLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBtZXNzYWdlIGlmIGNvbW1hbmQgaXNuJ3QgcmVjb2duaXplZCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdVbnJlY29nbml6ZWQgY29tbWFuZC4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICAgIH1cclxuXHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0NoYXRIaXN0b3J5Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ0NoYXRIaXN0b3J5U2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsIENoYXRIaXN0b3J5U2VydmljZSkge1xyXG4gICAgXHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9ICdMb2JieSc7ICAgICAgICBcclxuICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnJztcclxuXHJcbiAgICBsb2FkRGVmYXVsdERhdGEoKTtcclxuICAgIFxyXG4gICAgJHNjb3BlLnJlbG9hZEhpc3RvcnkgPSBmdW5jdGlvbiAoY2hhdFJvb20pIHtcclxuICAgICAgICByZXR1cm4gZ2V0SGlzdG9yeShjaGF0Um9vbSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBsb2FkRGVmYXVsdERhdGEoKSB7XHJcbiAgICAgICAgQ2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tcygpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jaGF0Um9vbXMgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICB9LGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnQW4gZXJyb3Igb2N1cnJlZCByZXRyaWV2aW5nIHRoZSBoaXN0b3J5LiBQbGVhc2UgcmVsb2FkIGRlIHBhZ2UuJztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZ2V0SGlzdG9yeSgnTG9iYnknKTsgICAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBnZXRIaXN0b3J5KGNoYXRSb29tKSB7XHJcbiAgICAgICAgQ2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tSGlzdG9yeShjaGF0Um9vbSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9IGNoYXRSb29tO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXRMaW5lcyA9IHJlc3BvbnNlLmRhdGE7ICAgICAgIFxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ0FuIGVycm9yIG9jdXJyZWQgcmV0cmlldmluZyB0aGUgaGlzdG9yeS4gUGxlYXNlIHJlbG9hZCBkZSBwYWdlLic7ICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIGNyZWRlbnRpYWxzXHJcbiAgICAgICRzY29wZS5jcmVkZW50aWFscyA9IHtcclxuICAgICAgICAgICAgZW1haWw6ICcnLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogJydcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgdGhlIGVycm9yIG1lc3NhZ2VcclxuICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgLy8gQXV0aGVudGljYXRlIFxyXG4gICAgICAkc2NvcGUuYXV0aGVudGljYXRlID0gZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBUcnkgdG8gbG9naW4gXHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ2luKGNyZWRlbnRpYWxzKVxyXG4gICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBBdXRoU2VydmljZS5wYXJzZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIocGFyYW1zLnVzZXIuX2lkLCBwYXJhbXMudXNlci5lbWFpbCwgcGFyYW1zLnVzZXIudXNlcm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NoYXQnKTtcclxuICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlOyAgICAgIFxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbn1dKTsgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdSZWdpc3RlckNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCAnVXNlclNlcnZpY2UnLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCBVc2VyU2VydmljZSwgQXV0aFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgdGhlIFVzZXJcclxuICAgICAgJHNjb3BlLnVzZXIgPSB7XHJcbiAgICAgICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICAgICAgdXNlcm5hbWU6ICcnLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogJydcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgcmVnaXN0cmF0aW9uIGVycm9yIG1lc3NhZ2VcclxuICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgLy8gUmVnaXN0ZXIgYSBuZXcgdXNlclxyXG4gICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVHJ5IHRvIHJlZ2lzdGVyIFxyXG4gICAgICAgICAgICBVc2VyU2VydmljZS5yZWdpc3Rlcih1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBBdXRoU2VydmljZS5wYXJzZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIocGFyYW1zLnVzZXIuX2lkLCBwYXJhbXMudXNlci5lbWFpbCwgcGFyYW1zLnVzZXIudXNlcm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NoYXQnKTsgXHJcbiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTsgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG59XSk7IiwiLy8gSW5qZWN0IHRoZSAkaW50ZXJjZXB0b3IgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jaWVzXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgWyckcScsICckaW5qZWN0b3InLCBmdW5jdGlvbiAoJHEsICRpbmplY3Rvcikge1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEF1dG9tYXRpY2FsbHkgYXR0YWNoIEF1dGhvcml6YXRpb24gaGVhZGVyXHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uIChjb25maWcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgIHZhciBBdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ0F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ3gtYWNjZXNzLXRva2VuJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgnO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgIFxyXG4gICAgICAgICAgICAvLyBJZiBhIHRva2VuIHdhcyBzZW50IGJhY2ssIHRoZW4gc2F2ZSBpdFxyXG4gICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gcmVzLmRhdGEudG9rZW47XHJcbiAgICAgICAgICAgICAgICAgIHZhciBBdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ0F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2F2ZVRva2VuKHRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgICAgICAgfVxyXG4gIH07XHJcblxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCAnJHdpbmRvdycsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRodHRwLCAkd2luZG93LCBBcGlCYXNlVXJsKSB7XHJcblxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcclxuIFxyXG4gICAgICAvLyBTYXZlIHRoZSB0b2tlbiBpbiB0aGUgbG9jYWwgc3RvcmFnZVxyXG4gICAgICBhdXRoU2VydmljZS5zYXZlVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdqd3RUb2tlbicsIHRva2VuKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHJpZXZlIHRoZSB0b2tlbiBpbiB0aGUgbG9jYWwgc3RvcmFnZVxyXG4gICAgICBhdXRoU2VydmljZS5nZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnand0VG9rZW4nKTtcclxuICAgICAgfTtcclxuICAgICAgICAgICBcclxuICAgICAgLy8gTG9naW4gLSBNYWtlIGEgcmVxdWVzdCB0byB0aGUgYXBpIGZvciBhdXRoZW50aWNhdGluZyAgICAgIFxyXG4gICAgICBhdXRoU2VydmljZS5sb2dpbiA9IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChBcGlCYXNlVXJsICsgJy9hdXRoZW50aWNhdGUnLCBjcmVkZW50aWFscyk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb2dvdXRcclxuICAgICAgYXV0aFNlcnZpY2UubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoYXV0aFNlcnZpY2UuZ2V0VG9rZW4oKSkge1xyXG4gICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdqd3RUb2tlbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiB0aGUgdXNlciBpcyBhdXRoZW50aWNhdGVkXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmlzQXV0aGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gYXV0aFNlcnZpY2UuZ2V0VG9rZW4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGF1dGhTZXJ2aWNlLnBhcnNlVG9rZW4odG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgZGF0ZU5vdyA9IE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSB0b2tlbiBoYXMgbm90IGV4cGlyZWRcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVOb3cgPD0gcGFyYW1zLmV4cDtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBQYXJzZSB0aGUgSlNPTiBXZWIgVG9rZW5cclxuICAgICAgYXV0aFNlcnZpY2UucGFyc2VUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgICAgICB2YXIgYmFzZTY0VXJsID0gdG9rZW4uc3BsaXQoJy4nKVsxXTtcclxuICAgICAgICAgICAgdmFyIGJhc2U2NCA9IGJhc2U2NFVybC5yZXBsYWNlKCctJywnKycpLnJlcGxhY2UoJ18nLCcvJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cuYXRvYihiYXNlNjQpKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBhdXRoU2VydmljZTtcclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQ2hhdEhpc3RvcnlTZXJ2aWNlJywgWyckaHR0cCcsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRodHRwLCBBcGlCYXNlVXJsKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICB2YXIgY2hhdEhpc3RvcnlTZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIGNoYXQgaGlzdG9yeSBvZiBhIGdpdmVuIGNoYXRyb29tIFxyXG4gICAgICBjaGF0SGlzdG9yeVNlcnZpY2UuZ2V0Q2hhdFJvb21IaXN0b3J5ID0gZnVuY3Rpb24gKGNoYXRSb29tKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvaGlzdG9yeS8nICsgY2hhdFJvb20pO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gR2V0IGFsbCB0aGUgY2hhdHJvb21zIHRoYXQgaGF2ZSBoaXN0b3J5XHJcbiAgICAgIGNoYXRIaXN0b3J5U2VydmljZS5nZXRDaGF0Um9vbXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvY2hhdHJvb20nKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBjaGF0SGlzdG9yeVNlcnZpY2U7XHJcbn1dKTsiLCIvLyBDcmVhdGUgYSBuZXcgc2VydmljZSBmb3IgbWFuYWdpbmcgd2Vic29ja2V0cyB3aXRoIHNvY2tldElvLiBcclxuYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdTb2NrZXRTZXJ2aWNlJywgWyckcm9vdFNjb3BlJywgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIHZhciBzb2NrZXRTZXJ2aWNlID0ge307XHJcblxyXG4gICAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCgpO1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5vbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5lbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0LmVtaXQoZXZlbnROYW1lLCBkYXRhLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBzb2NrZXRTZXJ2aWNlO1xyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdVc2VyU2VydmljZScsIFsnJGh0dHAnLCAnQXBpQmFzZVVybCcsIGZ1bmN0aW9uICgkaHR0cCwgQXBpQmFzZVVybCkge1xyXG5cclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgICAgdmFyIHVzZXJTZXJ2aWNlID0ge307XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAvLyBSZWdpc3RlciBhIG5ldyB1c2VyICAgICAgXHJcbiAgICAgIHVzZXJTZXJ2aWNlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KEFwaUJhc2VVcmwgKyAnL3VzZXJzJywgeyAndXNlcic6IHVzZXIgfSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gdXNlclNlcnZpY2U7XHJcbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=