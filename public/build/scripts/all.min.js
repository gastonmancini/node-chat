!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.constant("ApiBaseUrl","http://localhost:3000/api"),t.config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,o){o.interceptors.push("AuthInterceptor"),t.when("/login",{templateUrl:"/views/login.html",controller:"AuthController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}]),t.run(["$location","$rootScope","AuthService",function(t,e,o){e.$on("$locationChangeStart",function(e,r,l){var n=r.auth;n&&!o.isAuthed&&t.path("/login")})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$location","AuthService",function(o,t,l){"use strict";o.logout=function(){l.logout(),t.path("/login")}}]);
angular.module("chatApp").controller("AuthController",["$scope","$location","AuthService",function(o,r,e){"use strict";o.credentials={email:"",password:""},o.formregister={error:!1},o.authenticate=function(t){e.login(t).then(function(){console.log("Login success."),r.path("/chat")},function(){console.log("Login error."),o.formregister.error=!0})}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","$http","$location","ApiBaseUrl",function(o,t,c,s){"use strict";function n(c){t.get(s+"/history/"+c).success(function(t){o.chatRoomName=c,o.chatLines=t})}o.chatRoomName="Lobby",t.get(s+"/chatroom").success(function(t){o.chatRooms=t}),t.get(s+"/history/Lobby").success(function(o){n("Lobby")}),o.reloadHistory=function(o){n(o)}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location","ApiBaseUrl",function(r,e,o,s){"use strict";r.user={email:"",username:"",password:""},r.formregister={error:!1},r.register=function(t){e.post(s+"/users",{user:t}).success(function(){o.path("/")}).error(function(){r.formregister.error=!0})}}]);
angular.module("chatApp").factory("AuthInterceptor",["$q","$injector",function(e,t){return{request:function(e){var n=t.get("AuthService"),r=n.getToken();return r&&(e.headers["x-access-token"]=r),e.headers["Content-Type"]="application/json; charset=UTF-8",e},response:function(e){var n=e.data.token,r=t.get("AuthService");return n&&r.saveToken(n),console.log(n),e}}}]);
angular.module("chatApp").factory("AuthService",["$http","$window","ApiBaseUrl",function(t,e,n){"use strict";function o(t){var n=t.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(e.atob(o))}var r={};return r.saveToken=function(t){e.localStorage.jwtToken=JSON.stringify(t)},r.getToken=function(){return e.localStorage.jwtToken},r.login=function(e){return t.post(n+"/authenticate",e)},r.logout=function(){this.getToken()&&this.saveToken(null)},r.isAuthed=function(){var t=this.getToken();if(console.log(t),t){var e=o(t);return Math.round((new Date).getTime()/1e3)<=e.exp}return!1},r}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvYXV0aENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL2NoYXRIaXN0b3J5Q29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3JlZ2lzdGVyQ29udHJvbGxlci5qcyIsImludGVyY2VwdG9ycy9hdXRoSW50ZXJjZXB0b3IuanMiLCJzZXJ2aWNlcy9hdXRoU2VydmljZS5qcyIsInNlcnZpY2VzL3NvY2tldFNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImF1dGgiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwicnVuIiwiJGxvY2F0aW9uIiwiJHJvb3RTY29wZSIsIkF1dGhTZXJ2aWNlIiwiJG9uIiwiZXZlbnQiLCJuZXh0IiwiY3VycmVudCIsInJlcXVpcmVMb2dpbiIsImlzQXV0aGVkIiwicGF0aCIsIiRzY29wZSIsImxvZ291dCIsImNyZWRlbnRpYWxzIiwiZW1haWwiLCJwYXNzd29yZCIsImZvcm1yZWdpc3RlciIsImVycm9yIiwiYXV0aGVudGljYXRlIiwibG9naW4iLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsIiR3aW5kb3ciLCIkc2NlIiwiU29ja2V0U2VydmljZSIsInByb2Nlc3NVc2VySW5wdXQiLCJtZXNzYWdlIiwic3lzdGVtTWVzc2FnZSIsImNoYXJBdCIsInByb2Nlc3NDb21tYW5kIiwibWVzc2FnZXMiLCJzZW5kTWVzc2FnZSIsInJvb20iLCJpbnB1dE1lc3NhZ2UiLCJ0ZXh0IiwiZW1pdCIsImNoYW5nZVJvb20iLCJuZXdSb29tIiwiY29tbWFuZCIsIndvcmRzIiwic3BsaXQiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsInNoaWZ0Iiwiam9pbiIsIm5hbWUiLCJyb29tTGlzdCIsIm5ld1Jvb21FcnJvciIsIm9uIiwicmVzdWx0Iiwic3VjY2VzcyIsInJvb21zIiwic2V0SW50ZXJ2YWwiLCJzdWJtaXQiLCJmb2N1c0NoYXRyb29tIiwiY3JlYXRlTmV3Q2hhdHJvb20iLCIkIiwibW9kYWwiLCJzYW5pdGl6ZUh0bWwiLCJ2YWx1ZSIsInRydXN0QXNIdG1sIiwiJGh0dHAiLCJBcGlCYXNlVXJsIiwiZ2V0SGlzdG9yeSIsImNoYXRSb29tIiwiZ2V0IiwiZGF0YSIsImNoYXRSb29tTmFtZSIsImNoYXRMaW5lcyIsImNoYXRSb29tcyIsInJlbG9hZEhpc3RvcnkiLCJ1c2VyIiwidXNlcm5hbWUiLCJyZWdpc3RlciIsInBvc3QiLCJmYWN0b3J5IiwiJHEiLCIkaW5qZWN0b3IiLCJyZXF1ZXN0IiwidG9rZW4iLCJnZXRUb2tlbiIsImhlYWRlcnMiLCJyZXNwb25zZSIsInJlcyIsInNhdmVUb2tlbiIsInBhcnNlSnd0VG9rZW4iLCJiYXNlNjRVcmwiLCJiYXNlNjQiLCJyZXBsYWNlIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsImF1dGhTZXJ2aWNlIiwibG9jYWxTdG9yYWdlIiwiand0VG9rZW4iLCJzdHJpbmdpZnkiLCJ0aGlzIiwicGFyYW1zIiwiTWF0aCIsInJvdW5kIiwiRGF0ZSIsImdldFRpbWUiLCJleHAiLCJzb2NrZXRTZXJ2aWNlIiwic29ja2V0IiwiaW8iLCJjb25uZWN0IiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiXSwibWFwcGluZ3MiOiJDQUFBLFdBRUEsWUFJQSxJQUFJQSxHQUFNQyxRQUFRQyxPQUFPLFdBQVksVUFBVyxjQUdoREYsR0FBSUcsU0FBUyxhQUFjLDZCQUczQkgsRUFBSUksUUFBUSxpQkFBa0Isb0JB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XG4ndXNlIHN0cmljdCc7XHJcblxyXG4gICAgXHJcbi8vIERlY2xhcmUgYXBwIGxldmVsIG1vZHVsZVxyXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnLCBbJ25nUm91dGUnLCAnbmdTYW5pdGl6ZSddKTtcclxuXHJcbi8vIERlZmluZSBhIGNvbnN0YW50IHdpdGggdGhlIEFQSSBiYXNlIHVybFxyXG5hcHAuY29uc3RhbnQoJ0FwaUJhc2VVcmwnLCAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaScpO1xyXG5cclxuLy8gQ29uZmlndXJlIHRoZSBhcHBsaWNhdGlvbiByb3V0ZXNcclxuYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZW1vdmUgdGhlIGhhc2ggZnJvbSB1cmxcclxuICAgICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG4gICAgICBcclxuICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXV0aEludGVyY2VwdG9yJyk7XHJcbiAgICAgIFxyXG4gICAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0F1dGhDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogZmFsc2VcclxuICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9jaGF0Jywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jaGF0Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ2hhdENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiB0cnVlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvaGlzdG9yeScsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY2hhdEhpc3RvcnkuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDaGF0SGlzdG9yeUNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiB0cnVlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvcmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlZ2lzdGVyLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnUmVnaXN0ZXJDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogZmFsc2VcclxuICAgICAgfSlcclxuXHJcbiAgICAgIC5vdGhlcndpc2UoeyByZWRpcmVjdFRvOiAnL2xvZ2luJyB9KTtcclxufV0pO1xyXG5cclxuLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZCwgYW5kIGlmIG5vdCBzaG93IHRoZSBsb2dpbiBwYWdlXHJcbmFwcC5ydW4oWyckbG9jYXRpb24nLCAnJHJvb3RTY29wZScsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkbG9jYXRpb24sICRyb290U2NvcGUsIEF1dGhTZXJ2aWNlKSB7XHJcbiBcclxuICAgICAgLy8gV2F0Y2ggdGhlIGN1cnJlbnRVc2VyIHZhcmlhYmxlICAgXHJcbiAgICAgIC8qJHJvb3RTY29wZS4kd2F0Y2goJ2N1cnJlbnRVc2VyJywgZnVuY3Rpb24gKGN1cnJlbnRVc2VyKSB7XHJcbiAgICAgICBcclxuICAgICAgICAgICAgLy8gSWYgdGhlIHVzZXIgaXMgbm90IGluIHRoZSByb290U2NvcGUgYWRuIHRoZSBwYWdlIHJlcXVpcmVzIGF1dGgsIHRyeSB0byBnZXQgaXRcclxuICAgICAgICAgICAgaWYgKCEkcm9vdFNjb3BlLmN1cnJlbnRVc2VyICYmICRsb2NhdGlvbi5wYXRoKCkgIT0gXCIvbG9naW5cIiAmJiAkbG9jYXRpb24ucGF0aCgpICE9IFwiL3JlZ2lzdGVyXCIpIHtcclxuICAgICAgICAgICAgICAgICAgQXV0aFNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICB9KTsqL1xyXG5cclxuICAgICAgICRyb290U2NvcGUuJG9uKCckbG9jYXRpb25DaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCwgbmV4dCwgY3VycmVudCkge1xyXG4gICAgICAgICAgICB2YXIgcmVxdWlyZUxvZ2luID0gbmV4dC5hdXRoO1xyXG4gICAgICAgICAgICBpZiAocmVxdWlyZUxvZ2luICYmICFBdXRoU2VydmljZS5pc0F1dGhlZCkgeyBcclxuICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbn1dKTtcclxuXHJcbn0pKCk7XHJcbiIsIi8vIENvbnRhaW5lciBmb3IgdGhlIGdsb2JhbCBhcHBsaWNhdGlvbiBsb2dpYyAvIEFsdGVybmF0aXZlIHRvIHRoZSBBbmd1bGFyJ3MgcnVuIGZ1bmN0aW9uXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQXBwbGljYXRpb25Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnOyAgICAgICAgICAgIFxyXG4gICAgICBcclxuICAgICAgdmFyIHRva2VuID0gbnVsbDtcclxuICAgICAgdmFyIG1lc3NhZ2UgPSBudWxsO1xyXG4gICAgICBcclxuICAgICAgLy8gSGFuZGxlIGluY29taW5nIHJlc3BvbnNlICAgICBcclxuICAgICAgZnVuY3Rpb24gaGFuZGxlUmVxdWVzdChyZXMpIHtcclxuICAgICAgICAgICAgdG9rZW4gPSByZXMuZGF0YSA/IHJlcy5kYXRhLnRva2VuIDogbnVsbDtcclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7IGNvbnNvbGUubG9nKCdKV1Q6JywgdG9rZW4pOyB9XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPSByZXMuZGF0YS5tZXNzYWdlOyBcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gTG9nb3V0IGZyb20gdGhlIGNoYXRcclxuICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UubG9nb3V0KCk7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgfTtcclxufV0pOyAgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdBdXRoQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRsb2NhdGlvbicsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgQXV0aFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgY3JlZGVudGlhbHNcclxuICAgICAgJHNjb3BlLmNyZWRlbnRpYWxzID0ge1xyXG4gICAgICAgICAgICBlbWFpbDogJycsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiAnJ1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSBsb2dpbiBlcnJvciBtZXNzYWdlIHZpc2liaWxpdHlcclxuICAgICAgJHNjb3BlLmZvcm1yZWdpc3RlciA9IHtcclxuICAgICAgICAgICAgZXJyb3I6IGZhbHNlXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBBdXRoZW50aWNhdGVcclxuICAgICAgJHNjb3BlLmF1dGhlbnRpY2F0ZSA9IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xyXG4gICAgICAgICAgICAvLyBUcnkgdG8gbG9naW4gYW5kIHNlbmQgdGhlIGF1dGggZXZlbnRzIG9uIHN1Y2Nlc3MgYW5kIGZhaWx1cmVcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UubG9naW4oY3JlZGVudGlhbHMpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkxvZ2luIHN1Y2Nlc3MuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NoYXQnKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkxvZ2luIGVycm9yLlwiKTtcclxuICAgICAgICAgICAgICAgICAgLy8gU2hvdyB0aGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmZvcm1yZWdpc3Rlci5lcnJvciA9IHRydWU7ICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxufV0pOyAiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0NoYXRDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHdpbmRvdycsICckc2NlJywgJ1NvY2tldFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkd2luZG93LCAkc2NlLCBTb2NrZXRTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgJHNjb3BlLnJvb21MaXN0ID0gW107XHJcbiAgICAgICRzY29wZS5yb29tID0gJ0xvYmJ5JztcclxuICAgICAgJHNjb3BlLmlucHV0TWVzc2FnZSA9ICcnO1xyXG4gICAgICAkc2NvcGUubmV3Um9vbSA9ICcnO1xyXG4gICAgICAkc2NvcGUubmV3Um9vbUVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IHJlc3VsdHMgb2YgYSBuYW1lLWNoYW5nZSBhdHRlbXB0XHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ25hbWVSZXN1bHQnLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICBcdHZhciBtZXNzYWdlO1xyXG4gICAgICAgICAgXHRcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnWW91IGFyZSBub3cga25vd24gYXMgJyArIHJlc3VsdC5uYW1lICsgJy4nO1xyXG4gICAgICAgICAgXHR9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlID0gcmVzdWx0Lm1lc3NhZ2U7XHJcbiAgICAgICAgICBcdH1cclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IHJlc3VsdHMgb2YgYSByb29tIGNoYW5nZSAgICAgICBcclxuICAgICAgU29ja2V0U2VydmljZS5vbignam9pblJlc3VsdCcsIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgIFx0JHNjb3BlLnJvb20gPSByZXN1bHQucm9vbTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKCdZb3UgYXJlIG5vdyBpbiB0aGUgcm9vbSAnICsgcmVzdWx0LnJvb20pO1xyXG4gICAgICB9KTsgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZWNlaXZlZCBtZXNzYWdlc1xyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCdtZXNzYWdlJywgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2gobWVzc2FnZS50ZXh0KTtcclxuICAgICAgfSk7ICAgIFx0XHRcdFxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgbGlzdCBvZiByb29tcyBhdmFpbGFibGVcclxuICAgICAgU29ja2V0U2VydmljZS5vbigncm9vbXMnLCBmdW5jdGlvbiAocm9vbXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnJvb21MaXN0ID0gW107XHJcbiAgICAgICAgICBcdGZvciAodmFyIHJvb20gaW4gcm9vbXMpIHtcclxuICAgICAgICAgICAgICAgIHJvb20gPSByb29tLnN1YnN0cmluZygxLCByb29tLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocm9vbSAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucm9vbUxpc3QucHVzaChyb29tKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgIFx0fVxyXG5cclxuICAgICAgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gUmVxdWVzdCBsaXN0IG9mIHJvb21zIGF2YWlsYWJsZSBpbnRlcm1pdHRlbnRseVxyXG4gICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgncm9vbXMnKTtcclxuICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gQWxsb3cgc3VibWl0dGluZyB0aGUgZm9ybSB0byBzZW5kIGEgY2hhdCBtZXNzYWdlXHJcbiAgICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgIFx0cHJvY2Vzc1VzZXJJbnB1dChtZXNzYWdlKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEFsbG93IGNsaWNrIGEgcm9vbSBuYW1lIHRvIGNoYW5nZSB0byB0aGF0IGNoYXRyb29tXHJcbiAgICAgICRzY29wZS5mb2N1c0NoYXRyb29tID0gZnVuY3Rpb24gKHJvb20pIHtcclxuXHRcdHByb2Nlc3NDb21tYW5kKCcvam9pbiAnICsgcm9vbSk7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaCgnUm9vbSBjaGFuZ2VkLicpO1xyXG5cdH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBDcmVhdGUgbmV3IGNoYXRyb29tXHJcbiAgICAgICRzY29wZS5jcmVhdGVOZXdDaGF0cm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcbiAgICAgICAgICAgIGlmICghcm9vbSkge1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubmV3Um9vbUVycm9yID0gdHJ1ZTtcclxuXHQgICAgICB9IGVsc2Uge1xyXG4gICAgICBcdFx0IHByb2Nlc3NVc2VySW5wdXQoXCIvam9pbiBcIiArIHJvb20pO1xyXG4gICAgICBcdCAgXHQgJCgnI215TW9kYWwnKS5tb2RhbCgnaGlkZScpO1xyXG4gICAgICBcdFx0ICRzY29wZS5uZXdSb29tRXJyb3IgPSBmYWxzZTtcclxuICAgICAgXHR9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBTYW5peml0ZSBIdG1sXHJcbiAgICAgICRzY29wZS5zYW5pdGl6ZUh0bWwgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHZhbHVlKTtcclxuICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgLyoqXHJcbiAgICAgICAqIFByaXZhdGUgaGVscGVyc1xyXG4gICAgICAgKi9cclxuICAgICAgXHJcbiAgICAgIC8vIFByb2Nlc3MgdGhlIGlucHV0IFxyXG4gICAgICBmdW5jdGlvbiBwcm9jZXNzVXNlcklucHV0KG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdmFyIHN5c3RlbU1lc3NhZ2U7XHJcbiAgICAgICAgICBcdFxyXG4gICAgICAgICAgICAvLyBJZiB1c2VyIGlucHV0IGJlZ2lucyB3aXRoIHNsYXNoLCB0cmVhdCBpdCBhcyBjb21tYW5kXHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLmNoYXJBdCgwKSA9PSAnLycpIHtcclxuICAgICAgICAgICAgICAgICAgc3lzdGVtTWVzc2FnZSA9IHByb2Nlc3NDb21tYW5kKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAoc3lzdGVtTWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChzeXN0ZW1NZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAvLyBCcm9hZGNhc3Qgbm9uY29tbWFuZCBpbnB1dCB0byBvdGhlciB1c2Vyc1xyXG4gICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZSgkc2NvcGUucm9vbSwgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGVzY2FwYXIgZWwgc2lndWllbnRlIG1lbnNhamVcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goXCJNZTogXCIgKyBtZXNzYWdlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmlucHV0TWVzc2FnZSA9ICcnO1xyXG4gICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gU2VuZCBjaGF0IG1lc3NhZ2VzXHJcbiAgICAgIGZ1bmN0aW9uIHNlbmRNZXNzYWdlKHJvb20sIHRleHQpIHtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgIHJvb206IHJvb20sXHJcbiAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCdtZXNzYWdlJywgbWVzc2FnZSk7XHJcbiAgICAgIH1cclxuICAgICAgXHRcclxuICAgICAgLy8gQ2hhbmdlIHJvb21zXHJcbiAgICAgIGZ1bmN0aW9uIGNoYW5nZVJvb20ocm9vbSkge1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ2pvaW4nLCB7XHJcbiAgICAgICAgICAgICAgICAgIG5ld1Jvb206IHJvb21cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHRcclxuICAgICAgLy8gUHJvY2Vzc2luZyBjaGF0IGNvbW1hbmRzXHJcbiAgICAgIGZ1bmN0aW9uIHByb2Nlc3NDb21tYW5kKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgdmFyIHdvcmRzID0gY29tbWFuZC5zcGxpdCgnICcpO1xyXG4gICAgICAgICAgICAvLyBQYXJzZSBjb21tYW5kIGZyb20gZmlyc3Qgd29yZFxyXG4gICAgICAgICAgICBjb21tYW5kID0gd29yZHNbMF1cclxuICAgICAgICAgICAgICAgICAgLnN1YnN0cmluZygxLCB3b3Jkc1swXS5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGZhbHNlO1xyXG4gIFxyXG4gICAgICAgICAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgICAgICAgY2FzZSAnam9pbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb29tID0gd29yZHMuam9pbignICcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgcm9vbSBjaGFuZ2luZyAvIGNyZWF0aW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZVJvb20ocm9vbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICduaWNrJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB3b3Jkcy5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBuYW1lLWNoYW5nZSBhdHRlbXB0c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ25hbWVBdHRlbXB0JywgbmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgbWVzc2FnZSBpZiBjb21tYW5kIGlzbid0IHJlY29nbml6ZWQgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnVW5yZWNvZ25pemVkIGNvbW1hbmQuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xyXG4gICAgICB9XHJcblxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdDaGF0SGlzdG9yeUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCAnQXBpQmFzZVVybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sIEFwaUJhc2VVcmwpIHtcclxuICAgIFxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICAgXHJcbiAgICAkc2NvcGUuY2hhdFJvb21OYW1lID0gXCJMb2JieVwiO1xyXG4gICBcclxuICAgICRodHRwLmdldChBcGlCYXNlVXJsICsgJy9jaGF0cm9vbScpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgeyAgICAgICAgXHJcbiAgICAgICAgJHNjb3BlLmNoYXRSb29tcyA9IGRhdGE7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgJGh0dHAuZ2V0KEFwaUJhc2VVcmwgKyAnL2hpc3RvcnkvTG9iYnknKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICBnZXRIaXN0b3J5KFwiTG9iYnlcIik7ICAgICAgICBcclxuICAgIH0pOyAgICBcclxuICAgIFxyXG4gICAgJHNjb3BlLnJlbG9hZEhpc3RvcnkgPSBmdW5jdGlvbiAoY2hhdFJvb20pIHtcclxuICAgICAgICBnZXRIaXN0b3J5KGNoYXRSb29tKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGdldEhpc3RvcnkoY2hhdFJvb20pIHtcclxuICAgICAgICAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvaGlzdG9yeS8nICsgY2hhdFJvb20pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuY2hhdFJvb21OYW1lID0gY2hhdFJvb207XHJcbiAgICAgICAgICAgICRzY29wZS5jaGF0TGluZXMgPSBkYXRhO1xyXG4gICAgICAgIH0pOyAgICBcclxuICAgIH1cclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignUmVnaXN0ZXJDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgJ0FwaUJhc2VVcmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCBBcGlCYXNlVXJsKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHRoZSBVc2VyXHJcbiAgICAgICRzY29wZS51c2VyID0ge1xyXG4gICAgICAgICAgICBlbWFpbDogJycsXHJcbiAgICAgICAgICAgIHVzZXJuYW1lOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6ICcnXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHJlZ2lzdHJhdGlvbiBlcnJvciBtZXNzYWdlIHZpc2liaWxpdHlcclxuICAgICAgJHNjb3BlLmZvcm1yZWdpc3RlciA9IHtcclxuICAgICAgICAgICAgZXJyb3I6IGZhbHNlXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBSZWdpc3RlciBhIG5ldyB1c2VyXHJcbiAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KEFwaUJhc2VVcmwgKyAnL3VzZXJzJywgeyAndXNlcic6IHVzZXIgfSlcclxuICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWRpcmVjdCB0byB0aGUgY2hhdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xyXG4gICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTaG93IHRoZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZm9ybXJlZ2lzdGVyLmVycm9yID0gdHJ1ZTsgICBcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG59XSk7IiwiLy8gSW5qZWN0IHRoZSAkaW50ZXJjZXB0b3IgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jaWVzXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgWyckcScsICckaW5qZWN0b3InLCBmdW5jdGlvbiAoJHEsICRpbmplY3Rvcikge1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEF1dG9tYXRpY2FsbHkgYXR0YWNoIEF1dGhvcml6YXRpb24gaGVhZGVyXHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uIChjb25maWcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgIHZhciBBdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ0F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ3gtYWNjZXNzLXRva2VuJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgnO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgIFxyXG4gICAgICAgICAgICAvLyBJZiBhIHRva2VuIHdhcyBzZW50IGJhY2ssIHRoZW4gc2F2ZSBpdFxyXG4gICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gcmVzLmRhdGEudG9rZW47XHJcbiAgICAgICAgICAgICAgICAgIHZhciBBdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ0F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQXV0aFNlcnZpY2Uuc2F2ZVRva2VuKHRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgICAgICAgfVxyXG4gIH07XHJcblxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCAnJHdpbmRvdycsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRodHRwLCAkd2luZG93LCBBcGlCYXNlVXJsKSB7XHJcblxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcclxuIFxyXG4gICAgICAvLyBTYXZlIHRoZSB0b2tlbiBpbiB0aGUgbG9jYWwgc3RvcmFnZVxyXG4gICAgICBhdXRoU2VydmljZS5zYXZlVG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbiA9IEpTT04uc3RyaW5naWZ5KHRva2VuKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHJpZXZlIHRoZSB0b2tlbiBpbiB0aGUgbG9jYWwgc3RvcmFnZVxyXG4gICAgICBhdXRoU2VydmljZS5nZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW47XHJcbiAgICAgIH07XHJcbiAgICAgICAgICAgXHJcbiAgICAgIC8vIExvZ2luIC0gTWFrZSBhIHJlcXVlc3QgdG8gdGhlIGFwaSBmb3IgYXV0aGVudGljYXRpbmcgICAgICBcclxuICAgICAgYXV0aFNlcnZpY2UubG9naW4gPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoQXBpQmFzZVVybCArICcvYXV0aGVudGljYXRlJywgY3JlZGVudGlhbHMpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gTG9nb3V0XHJcbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZ2V0VG9rZW4oKSkge1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnNhdmVUb2tlbihudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZFxyXG4gICAgICBhdXRoU2VydmljZS5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRva2VuKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHBhcnNlSnd0VG9rZW4odG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSA8PSBwYXJhbXMuZXhwO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFBhcnNlIHRoZSBKU09OIFdlYiBUb2tlblxyXG4gICAgICBmdW5jdGlvbiBwYXJzZUp3dFRva2VuKHRva2VuKSB7XHJcbiAgICAgICAgICAgIHZhciBiYXNlNjRVcmwgPSB0b2tlbi5zcGxpdCgnLicpWzFdO1xyXG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCcrJykucmVwbGFjZSgnXycsJy8nKTtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gYXV0aFNlcnZpY2U7XHJcbn1dKTsiLCIvLyBDcmVhdGUgYSBuZXcgc2VydmljZSBmb3IgbWFuYWdpbmcgd2Vic29ja2V0cyB3aXRoIHNvY2tldElvLiBcclxuYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdTb2NrZXRTZXJ2aWNlJywgWyckcm9vdFNjb3BlJywgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIHZhciBzb2NrZXRTZXJ2aWNlID0ge307XHJcblxyXG4gICAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCgpO1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5vbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5lbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0LmVtaXQoZXZlbnROYW1lLCBkYXRhLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBzb2NrZXRTZXJ2aWNlO1xyXG59XSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9