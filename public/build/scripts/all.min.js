!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.constant("ApiBaseUrl","/api"),t.config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,r){r.interceptors.push("AuthInterceptor"),t.when("/login",{templateUrl:"/views/login.html",controller:"LoginController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}]),t.run(["$route","$rootScope","$location","AuthService",function(t,e,r,o){e.$on("$locationChangeStart",function(e,n,l){var i=r.path(),a=t.routes[i];a&&a.auth&&!o.isAuthed()&&r.path("/login")})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$window","$location","AuthService",function(e,t,r,n){"use strict";e.setCurrentUser=function(e,r,n){var o={_id:e,username:n,email:r};t.localStorage.setItem("currentUser",JSON.stringify(o))},e.getCurrentUser=function(){return JSON.parse(t.localStorage.getItem("currentUser"))},e.isAuthed=function(){return null!==n.isAuthed()&&n.isAuthed()!==!1},e.logout=function(){n.logout(),t.localStorage.removeItem("currentUser"),r.path("/login")}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","$http","$location","ChatHistoryService",function(e,o,r,t){"use strict";function a(o){t.getChatRoomHistory(o).then(function(r,t,a,n){e.chatRoomName=o,e.chatLines=r.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."})}e.chatRoomName="Lobby",e.errorMessage="",t.getChatRooms().then(function(o,r,t,a){e.chatRooms=o.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."}),a("Lobby"),e.reloadHistory=function(e){return a(e)}}]);
angular.module("chatApp").controller("LoginController",["$scope","$location","AuthService",function(e,r,t){"use strict";e.credentials={email:"",password:""},e.errorMessage="",e.authenticate=function(a){t.login(a).then(function(a,n,o,s){var i=t.parseToken(a.data.token);e.setCurrentUser(i.user._id,i.user.email,i.user.username),r.path("/chat")},function(r,t,a,n){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location","UserService","AuthService",function(e,r,s,t,a){"use strict";e.user={email:"",username:"",password:""},e.errorMessage="",e.register=function(r){t.register(r).then(function(r,t,n,o){var u=a.parseToken(r.data.token);e.setCurrentUser(u.user._id,u.user.email,u.user.username),s.path("/chat")},function(r,s,t,a){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").factory("AuthInterceptor",["$q","$injector",function(e,t){return{request:function(e){var n=t.get("AuthService"),r=n.getToken();return r&&(e.headers["x-access-token"]=r),e.headers["Content-Type"]="application/json; charset=UTF-8",e},response:function(e){var n=e.data.token,r=t.get("AuthService");return n&&r.saveToken(n),e}}}]);
angular.module("chatApp").factory("AuthService",["$http","$window","ApiBaseUrl",function(e,t,n){"use strict";var o={};return o.saveToken=function(e){t.localStorage.jwtToken=e},o.getToken=function(){return t.localStorage.jwtToken},o.login=function(t){return e.post(n+"/authenticate",t)},o.logout=function(){o.getToken()&&t.localStorage.removeItem("jwtToken")},o.isAuthed=function(){var e=o.getToken();if(e){var t=o.parseToken(e),n=Math.round((new Date).getTime()/1e3);return n<=t.exp}return!1},o.parseToken=function(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))},o}]);
angular.module("chatApp").factory("ChatHistoryService",["$http","ApiBaseUrl",function(t,r){"use strict";var o={};return o.getChatRoomHistory=function(o){return t.get(r+"/history/"+o)},o.getChatRooms=function(){return t.get(r+"/chatroom")},o}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
angular.module("chatApp").factory("UserService",["$http","ApiBaseUrl",function(r,e){"use strict";var t={};return t.register=function(t){return r.post(e+"/users",{user:t})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvY2hhdENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0SGlzdG9yeUNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9yZWdpc3RlckNvbnRyb2xsZXIuanMiLCJpbnRlcmNlcHRvcnMvYXV0aEludGVyY2VwdG9yLmpzIiwic2VydmljZXMvYXV0aFNlcnZpY2UuanMiLCJzZXJ2aWNlcy9jaGF0SGlzdG9yeVNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlclNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImF1dGgiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwicnVuIiwiJHJvdXRlIiwiJHJvb3RTY29wZSIsIiRsb2NhdGlvbiIsIkF1dGhTZXJ2aWNlIiwiJG9uIiwiZXYiLCJuZXh0IiwiY3VycmVudCIsIm5leHRQYXRoIiwicGF0aCIsIm5leHRSb3V0ZSIsInJvdXRlcyIsImlzQXV0aGVkIiwiJHNjb3BlIiwiJHdpbmRvdyIsInNldEN1cnJlbnRVc2VyIiwiX2lkIiwiZW1haWwiLCJ1c2VybmFtZSIsIm1lIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRDdXJyZW50VXNlciIsInBhcnNlIiwiZ2V0SXRlbSIsImxvZ291dCIsInJlbW92ZUl0ZW0iLCIkc2NlIiwiU29ja2V0U2VydmljZSIsInByb2Nlc3NVc2VySW5wdXQiLCJtZXNzYWdlIiwic3lzdGVtTWVzc2FnZSIsImNoYXJBdCIsInByb2Nlc3NDb21tYW5kIiwibWVzc2FnZXMiLCJzZW5kTWVzc2FnZSIsInJvb20iLCJpbnB1dE1lc3NhZ2UiLCJ0ZXh0IiwiZW1pdCIsImNoYW5nZVJvb20iLCJuZXdSb29tIiwiY29tbWFuZCIsIndvcmRzIiwic3BsaXQiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsInNoaWZ0Iiwiam9pbiIsIm5hbWUiLCJyb29tTGlzdCIsIm5ld1Jvb21FcnJvciIsIm9uIiwicmVzdWx0Iiwic3VjY2VzcyIsInJvb21zIiwic2V0SW50ZXJ2YWwiLCJzdWJtaXQiLCJmb2N1c0NoYXRyb29tIiwiY3JlYXRlTmV3Q2hhdHJvb20iLCIkIiwibW9kYWwiLCJzYW5pdGl6ZUh0bWwiLCJ2YWx1ZSIsInRydXN0QXNIdG1sIiwiJGh0dHAiLCJDaGF0SGlzdG9yeVNlcnZpY2UiLCJnZXRIaXN0b3J5IiwiY2hhdFJvb20iLCJnZXRDaGF0Um9vbUhpc3RvcnkiLCJ0aGVuIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJoZWFkZXJzIiwiY2hhdFJvb21OYW1lIiwiY2hhdExpbmVzIiwiZGF0YSIsImVycm9yTWVzc2FnZSIsImdldENoYXRSb29tcyIsImNoYXRSb29tcyIsInJlbG9hZEhpc3RvcnkiLCJjcmVkZW50aWFscyIsInBhc3N3b3JkIiwiYXV0aGVudGljYXRlIiwibG9naW4iLCJwYXJhbXMiLCJwYXJzZVRva2VuIiwidG9rZW4iLCJ1c2VyIiwiVXNlclNlcnZpY2UiLCJyZWdpc3RlciIsImZhY3RvcnkiLCIkcSIsIiRpbmplY3RvciIsInJlcXVlc3QiLCJnZXQiLCJnZXRUb2tlbiIsInJlcyIsInNhdmVUb2tlbiIsIkFwaUJhc2VVcmwiLCJhdXRoU2VydmljZSIsImp3dFRva2VuIiwicG9zdCIsImRhdGVOb3ciLCJNYXRoIiwicm91bmQiLCJEYXRlIiwiZ2V0VGltZSIsImV4cCIsImJhc2U2NFVybCIsImJhc2U2NCIsInJlcGxhY2UiLCJhdG9iIiwiY2hhdEhpc3RvcnlTZXJ2aWNlIiwic29ja2V0U2VydmljZSIsInNvY2tldCIsImlvIiwiY29ubmVjdCIsImV2ZW50TmFtZSIsImNhbGxiYWNrIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5IiwidXNlclNlcnZpY2UiXSwibWFwcGluZ3MiOiJDQUFBLFdBRUEsWUFJQSxJQUFJQSxHQUFNQyxRQUFRQyxPQUFPLFdBQVksVUFBVyxjQUdoREYsR0FBSUcsU0FBUyxhQUFjLFFBRzNCSCxFQUFJSSxRQUFRLGlCQUFrQixvQkFBcUIsZ0JBQWlCLFNBQVVDLEVBQWdCQyxFQUFtQkMsR0FLM0dBLEVBQWNDLGFBQWFDLEtBQUssbUJBRWhDSixFQUNPSyxLQUFLLFVBQ05DLFlBQWEsb0JBQ2JDLFdBQVksa0JBQ1pDLE1BQU0sSUFFTEgsS0FBSyxTQUNOQyxZQUFhLG1CQUNiQyxXQUFZLGlCQUNaQyxNQUFNLElBRUxILEtBQUssWUFDTkMsWUFBYSwwQkFDYkMsV0FBWSx3QkFDWkMsTUFBTSxJQUVMSCxLQUFLLGFBQ05DLFlBQWEsdUJBQ2JDLFdBQVkscUJBQ1pDLE1BQU0sSUFHWEMsV0FBWUMsV0FBWSxjQUkvQmYsRUFBSWdCLEtBQUssU0FBVSxhQUFjLFlBQWEsY0FBZSxTQUFVQyxFQUFRQyxFQUFZQyxFQUFXQyxHQUVqR0YsRUFBV0csSUFBSSx1QkFBd0IsU0FBU0MsRUFBSUMsRUFBTUMsR0FDckQsR0FBSUMsR0FBV04sRUFBVU8sT0FDckJDLEVBQVlWLEVBQU9XLE9BQU9ILEVBRTFCRSxJQUFhQSxFQUFVZCxPQUFTTyxFQUFZUyxZQUM5Q1YsRUFBVU8sS0FBSztBQ25EM0J6QixRQUFRQyxPQUFPLFdBQVdVLFdBQVcseUJBQTBCLFNBQVUsVUFBVyxZQUFhLGNBQWUsU0FBVWtCLEVBQVFDLEVBQVNaLEVBQVdDLEdBRWhKLFlBR0FVLEdBQU9FLGVBQWlCLFNBQVNDLEVBQUtDLEVBQU9DLEdBQ3ZDLEdBQUlDLElBQ0VILElBQUtBLEVBQ0xFLFNBQVVBLEVBQ1ZELE1BQU9BLEVBRWJILEdB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QVVrRSxFQUFXQyxHQUNsQ0osRUFBTy9ELEdBQUdrRSxFQUFXLFdBQ2YsR0FBSUUsR0FBT0MsU0FDWDNILEdBQVc0SCxPQUFPLFdBQ1pILEVBQVNJLE1BQU1SLEVBQVFLLFFBS3pDTixFQUFjNUUsS0FBTyxTQUFVZ0YsRUFBVzFDLEVBQU0yQyxHQUMxQ0osRUFBTzdFLEtBQUtnRixFQUFXMUMsRUFBTSxXQUN2QixHQUFJNEMsR0FBT0MsU0FDWDNILEdBQVc0SCxPQUFPLFdBQ1JILEdBQ0RBLEVBQVNJLE1BQU1SLEVBQVFLLFFBTXJDTjtBQzdCYnJJLFFBQVFDLE9BQU8sV0FBVzZHLFFBQVEsZUFBZ0IsUUFBUyxhQUFjLFNBQVUxQixFQUFPa0MsR0FFcEYsWUFFQSxJQUFJeUIsS0FPSixPQUpBQSxHQUFZbEMsU0FBVyxTQUFVRixHQUM3QixNQUFPdkIsR0FBTXFDLEtBQUtILEVBQWEsVUFBWVgsS0FBUUEsS0FHaERvQyIsImZpbGUiOiJhbGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7XHJcbiAgICBcclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFxyXG4vLyBEZWNsYXJlIGFwcCBsZXZlbCBtb2R1bGVcclxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJywgWyduZ1JvdXRlJywgJ25nU2FuaXRpemUnXSk7XHJcblxyXG4vLyBEZWZpbmUgYSBjb25zdGFudCB3aXRoIHRoZSBBUEkgYmFzZSB1cmxcclxuYXBwLmNvbnN0YW50KCdBcGlCYXNlVXJsJywgJy9hcGknKTtcclxuXHJcbi8vIENvbmZpZ3VyZSB0aGUgYXBwbGljYXRpb24gcm91dGVzXHJcbmFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlcicsICckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJGh0dHBQcm92aWRlcikge1xyXG4gICAgICBcclxuICAgICAgLy8gUmVtb3ZlIHRoZSBoYXNoIGZyb20gdXJsXHJcbiAgICAgIC8vICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuICAgICAgXHJcbiAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG4gICAgICBcclxuICAgICAgJHJvdXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLndoZW4oJy9sb2dpbicsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiBmYWxzZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL2NoYXQnLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NoYXQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDaGF0Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IHRydWVcclxuICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9oaXN0b3J5Jywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jaGF0SGlzdG9yeS5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NoYXRIaXN0b3J5Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IHRydWVcclxuICAgICAgfSlcclxuICAgICAgICAgICAgLndoZW4oJy9yZWdpc3RlcicsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVnaXN0ZXIuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZWdpc3RlckNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBhdXRoOiBmYWxzZVxyXG4gICAgICB9KVxyXG5cclxuICAgICAgLm90aGVyd2lzZSh7IHJlZGlyZWN0VG86ICcvbG9naW4nIH0pO1xyXG59XSk7XHJcblxyXG4vLyBDaGVjayBpZiB0aGUgdXNlciBpcyBhdXRoZW50aWNhdGVkLCBhbmQgaWYgbm90IHJlZGlyZWN0IHRvIHRoZSBsb2dpbiBwYWdlXHJcbmFwcC5ydW4oWyckcm91dGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHJvdXRlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIEF1dGhTZXJ2aWNlKSB7XHJcbiAgIFxyXG4gICAgICRyb290U2NvcGUuJG9uKCckbG9jYXRpb25DaGFuZ2VTdGFydCcsIGZ1bmN0aW9uKGV2LCBuZXh0LCBjdXJyZW50KSB7XHJcbiAgICAgICAgICB2YXIgbmV4dFBhdGggPSAkbG9jYXRpb24ucGF0aCgpO1xyXG4gICAgICAgICAgdmFyIG5leHRSb3V0ZSA9ICRyb3V0ZS5yb3V0ZXNbbmV4dFBhdGhdOyBcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKG5leHRSb3V0ZSAmJiBuZXh0Um91dGUuYXV0aCAmJiAhQXV0aFNlcnZpY2UuaXNBdXRoZWQoKSkge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7ICAgICAgICAgIFxyXG4gICAgICAgICAgfVxyXG4gICAgICBcclxuICAgICB9KTtcclxuICAgIFxyXG59XSk7XHJcblxyXG59KSgpO1xyXG4iLCIvLyBDb250YWluZXIgZm9yIHRoZSBnbG9iYWwgYXBwbGljYXRpb24gbG9naWMgLyBBbHRlcm5hdGl2ZSB0byB0aGUgQW5ndWxhcidzIHJ1biBmdW5jdGlvblxyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgLy8gU3RvcmUgY3VycmVudCB1c2VyIGluZm9cclxuICAgICAgJHNjb3BlLnNldEN1cnJlbnRVc2VyID0gZnVuY3Rpb24oX2lkLCBlbWFpbCwgdXNlcm5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIG1lID0ge1xyXG4gICAgICAgICAgICAgICAgICBfaWQ6IF9pZCxcclxuICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgICBlbWFpbDogZW1haWxcclxuICAgICAgICAgICAgfTsgXHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjdXJyZW50VXNlclwiLCBKU09OLnN0cmluZ2lmeShtZSkpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUmV0cmlldmUgY3VycmVudCB1c2VyIGluZm9cclxuICAgICAgJHNjb3BlLmdldEN1cnJlbnRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjdXJyZW50VXNlclwiKSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiB0aGUgdXNlciBpcyBhdXRoZW50aWNhdGVkXHJcbiAgICAgICRzY29wZS5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmlzQXV0aGVkKCkgIT09IG51bGwgJiYgQXV0aFNlcnZpY2UuaXNBdXRoZWQoKSAhPT0gZmFsc2U7ICAgICBcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIExvZ291dCBmcm9tIHRoZSBjaGF0XHJcbiAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ291dCgpO1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdjdXJyZW50VXNlcicpO1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XHJcbiAgICAgIH07XHJcbn1dKTsgICIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQ2hhdENvbnRyb2xsZXInLCBbJyRzY29wZScsICckd2luZG93JywgJyRzY2UnLCAnU29ja2V0U2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsICR3aW5kb3csICRzY2UsIFNvY2tldFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgICRzY29wZS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAkc2NvcGUucm9vbUxpc3QgPSBbXTtcclxuICAgICAgJHNjb3BlLnJvb20gPSAnTG9iYnknO1xyXG4gICAgICAkc2NvcGUuaW5wdXRNZXNzYWdlID0gJyc7XHJcbiAgICAgICRzY29wZS5uZXdSb29tID0gJyc7XHJcbiAgICAgICRzY29wZS5uZXdSb29tRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgcmVzdWx0cyBvZiBhIG5hbWUtY2hhbmdlIGF0dGVtcHRcclxuICAgICAgU29ja2V0U2VydmljZS5vbignbmFtZVJlc3VsdCcsIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgIFx0dmFyIG1lc3NhZ2U7XHJcbiAgICAgICAgICBcdFxyXG4gICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdZb3UgYXJlIG5vdyBrbm93biBhcyAnICsgcmVzdWx0Lm5hbWUgKyAnLic7XHJcbiAgICAgICAgICBcdH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSByZXN1bHQubWVzc2FnZTtcclxuICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChtZXNzYWdlKTtcclxuICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgcmVzdWx0cyBvZiBhIHJvb20gY2hhbmdlICAgICAgIFxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCdqb2luUmVzdWx0JywgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgXHQkc2NvcGUucm9vbSA9IHJlc3VsdC5yb29tO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goJ1lvdSBhcmUgbm93IGluIHRoZSByb29tICcgKyByZXN1bHQucm9vbSk7XHJcbiAgICAgIH0pOyAgICBcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IHJlY2VpdmVkIG1lc3NhZ2VzXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ21lc3NhZ2UnLCBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChtZXNzYWdlLnRleHQpO1xyXG4gICAgICB9KTsgICAgXHRcdFx0XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSBsaXN0IG9mIHJvb21zIGF2YWlsYWJsZVxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCdyb29tcycsIGZ1bmN0aW9uIChyb29tcykge1xyXG4gICAgICAgICAgICAkc2NvcGUucm9vbUxpc3QgPSBbXTtcclxuICAgICAgICAgIFx0Zm9yICh2YXIgcm9vbSBpbiByb29tcykge1xyXG4gICAgICAgICAgICAgICAgcm9vbSA9IHJvb20uc3Vic3RyaW5nKDEsIHJvb20ubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIGlmIChyb29tICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yb29tTGlzdC5wdXNoKHJvb20pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgXHR9XHJcblxyXG4gICAgICB9KTtcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBSZXF1ZXN0IGxpc3Qgb2Ygcm9vbXMgYXZhaWxhYmxlIGludGVybWl0dGVudGx5XHJcbiAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCdyb29tcycpO1xyXG4gICAgICB9LCAxMDAwKTtcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBBbGxvdyBzdWJtaXR0aW5nIHRoZSBmb3JtIHRvIHNlbmQgYSBjaGF0IG1lc3NhZ2VcclxuICAgICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgXHRwcm9jZXNzVXNlcklucHV0KG1lc3NhZ2UpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQWxsb3cgY2xpY2sgYSByb29tIG5hbWUgdG8gY2hhbmdlIHRvIHRoYXQgY2hhdHJvb21cclxuICAgICAgJHNjb3BlLmZvY3VzQ2hhdHJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG5cdFx0cHJvY2Vzc0NvbW1hbmQoJy9qb2luICcgKyByb29tKTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKCdSb29tIGNoYW5nZWQuJyk7XHJcblx0fTtcclxuICAgICAgXHJcbiAgICAgIC8vIENyZWF0ZSBuZXcgY2hhdHJvb21cclxuICAgICAgJHNjb3BlLmNyZWF0ZU5ld0NoYXRyb29tID0gZnVuY3Rpb24gKHJvb20pIHtcclxuICAgICAgICAgICAgaWYgKCFyb29tKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5uZXdSb29tRXJyb3IgPSB0cnVlO1xyXG5cdCAgICAgIH0gZWxzZSB7XHJcbiAgICAgIFx0XHQgcHJvY2Vzc1VzZXJJbnB1dChcIi9qb2luIFwiICsgcm9vbSk7XHJcbiAgICAgIFx0ICBcdCAkKCcjbXlNb2RhbCcpLm1vZGFsKCdoaWRlJyk7XHJcbiAgICAgIFx0XHQgJHNjb3BlLm5ld1Jvb21FcnJvciA9IGZhbHNlO1xyXG4gICAgICBcdH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFNhbml6aXRlIEh0bWxcclxuICAgICAgJHNjb3BlLnNhbml0aXplSHRtbCA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwodmFsdWUpO1xyXG4gICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAvKipcclxuICAgICAgICogUHJpdmF0ZSBoZWxwZXJzXHJcbiAgICAgICAqL1xyXG4gICAgICBcclxuICAgICAgLy8gUHJvY2VzcyB0aGUgaW5wdXQgXHJcbiAgICAgIGZ1bmN0aW9uIHByb2Nlc3NVc2VySW5wdXQobWVzc2FnZSkge1xyXG4gICAgICAgICAgICB2YXIgc3lzdGVtTWVzc2FnZTtcclxuICAgICAgICAgIFx0XHJcbiAgICAgICAgICAgIC8vIElmIHVzZXIgaW5wdXQgYmVnaW5zIHdpdGggc2xhc2gsIHRyZWF0IGl0IGFzIGNvbW1hbmRcclxuICAgICAgICAgICAgaWYgKG1lc3NhZ2UuY2hhckF0KDApID09ICcvJykge1xyXG4gICAgICAgICAgICAgICAgICBzeXN0ZW1NZXNzYWdlID0gcHJvY2Vzc0NvbW1hbmQobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChzeXN0ZW1NZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKHN5c3RlbU1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vIEJyb2FkY2FzdCBub25jb21tYW5kIGlucHV0IHRvIG90aGVyIHVzZXJzXHJcbiAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlKCRzY29wZS5yb29tLCBtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goXCJNZTogXCIgKyBtZXNzYWdlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmlucHV0TWVzc2FnZSA9ICcnO1xyXG4gICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gU2VuZCBjaGF0IG1lc3NhZ2VzXHJcbiAgICAgIGZ1bmN0aW9uIHNlbmRNZXNzYWdlKHJvb20sIHRleHQpIHtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgIHJvb206IHJvb20sXHJcbiAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCdtZXNzYWdlJywgbWVzc2FnZSk7XHJcbiAgICAgIH1cclxuICAgICAgXHRcclxuICAgICAgLy8gQ2hhbmdlIHJvb21zXHJcbiAgICAgIGZ1bmN0aW9uIGNoYW5nZVJvb20ocm9vbSkge1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ2pvaW4nLCB7XHJcbiAgICAgICAgICAgICAgICAgIG5ld1Jvb206IHJvb21cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHRcclxuICAgICAgLy8gUHJvY2Vzc2luZyBjaGF0IGNvbW1hbmRzXHJcbiAgICAgIGZ1bmN0aW9uIHByb2Nlc3NDb21tYW5kKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgdmFyIHdvcmRzID0gY29tbWFuZC5zcGxpdCgnICcpO1xyXG4gICAgICAgICAgICAvLyBQYXJzZSBjb21tYW5kIGZyb20gZmlyc3Qgd29yZFxyXG4gICAgICAgICAgICBjb21tYW5kID0gd29yZHNbMF1cclxuICAgICAgICAgICAgICAgICAgLnN1YnN0cmluZygxLCB3b3Jkc1swXS5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGZhbHNlO1xyXG4gIFxyXG4gICAgICAgICAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcclxuICAgICAgICAgICAgICAgICAgY2FzZSAnam9pbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb29tID0gd29yZHMuam9pbignICcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgcm9vbSBjaGFuZ2luZyAvIGNyZWF0aW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZVJvb20ocm9vbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICduaWNrJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB3b3Jkcy5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBuYW1lLWNoYW5nZSBhdHRlbXB0c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ25hbWVBdHRlbXB0JywgbmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgbWVzc2FnZSBpZiBjb21tYW5kIGlzbid0IHJlY29nbml6ZWQgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnVW5yZWNvZ25pemVkIGNvbW1hbmQuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xyXG4gICAgICB9XHJcblxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdDaGF0SGlzdG9yeUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCAnQ2hhdEhpc3RvcnlTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwgQ2hhdEhpc3RvcnlTZXJ2aWNlKSB7XHJcbiAgICBcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgIFxyXG4gICAgLy8gSW5pdGlhbGl6ZSB0aGUgY2hhdHJvb20gbmFtZSAgIFxyXG4gICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9ICdMb2JieSc7XHJcbiAgICBcclxuICAgIC8vIEluaXRpYWxpemUgdGhlIGVycm9yIG1lc3NhZ2VcclxuICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnJztcclxuICAgXHJcbiAgICBDaGF0SGlzdG9yeVNlcnZpY2UuZ2V0Q2hhdFJvb21zKClcclxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5jaGF0Um9vbXMgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH0sZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ0FuIGVycm9yIG9jdXJyZWQgcmV0cmlldmluZyB0aGUgaGlzdG9yeS4gUGxlYXNlIHJlbG9hZCBkZSBwYWdlLic7XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgIGdldEhpc3RvcnkoJ0xvYmJ5Jyk7XHJcbiAgICBcclxuICAgICRzY29wZS5yZWxvYWRIaXN0b3J5ID0gZnVuY3Rpb24gKGNoYXRSb29tKSB7XHJcbiAgICAgICAgcmV0dXJuIGdldEhpc3RvcnkoY2hhdFJvb20pO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gZ2V0SGlzdG9yeShjaGF0Um9vbSkge1xyXG4gICAgICAgIENoYXRIaXN0b3J5U2VydmljZS5nZXRDaGF0Um9vbUhpc3RvcnkoY2hhdFJvb20pXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jaGF0Um9vbU5hbWUgPSBjaGF0Um9vbTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jaGF0TGluZXMgPSByZXNwb25zZS5kYXRhOyAgICAgICBcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICdBbiBlcnJvciBvY3VycmVkIHJldHJpZXZpbmcgdGhlIGhpc3RvcnkuIFBsZWFzZSByZWxvYWQgZGUgcGFnZS4nOyAgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSBjcmVkZW50aWFsc1xyXG4gICAgICAkc2NvcGUuY3JlZGVudGlhbHMgPSB7XHJcbiAgICAgICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6ICcnXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHRoZSBlcnJvciBtZXNzYWdlXHJcbiAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnJztcclxuXHJcbiAgICAgIC8vIEF1dGhlbnRpY2F0ZSBcclxuICAgICAgJHNjb3BlLmF1dGhlbnRpY2F0ZSA9IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVHJ5IHRvIGxvZ2luIFxyXG4gICAgICAgICAgICBBdXRoU2VydmljZS5sb2dpbihjcmVkZW50aWFscylcclxuICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gQXV0aFNlcnZpY2UucGFyc2VUb2tlbihyZXNwb25zZS5kYXRhLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNldEN1cnJlbnRVc2VyKHBhcmFtcy51c2VyLl9pZCwgcGFyYW1zLnVzZXIuZW1haWwsIHBhcmFtcy51c2VyLnVzZXJuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9jaGF0Jyk7XHJcbiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTsgICAgICBcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG59XSk7ICIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignUmVnaXN0ZXJDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgJ1VzZXJTZXJ2aWNlJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwgVXNlclNlcnZpY2UsIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHRoZSBVc2VyXHJcbiAgICAgICRzY29wZS51c2VyID0ge1xyXG4gICAgICAgICAgICBlbWFpbDogJycsXHJcbiAgICAgICAgICAgIHVzZXJuYW1lOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6ICcnXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIHJlZ2lzdHJhdGlvbiBlcnJvciBtZXNzYWdlXHJcbiAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnJztcclxuXHJcbiAgICAgIC8vIFJlZ2lzdGVyIGEgbmV3IHVzZXJcclxuICAgICAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFRyeSB0byByZWdpc3RlciBcclxuICAgICAgICAgICAgVXNlclNlcnZpY2UucmVnaXN0ZXIodXNlcilcclxuICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gQXV0aFNlcnZpY2UucGFyc2VUb2tlbihyZXNwb25zZS5kYXRhLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNldEN1cnJlbnRVc2VyKHBhcmFtcy51c2VyLl9pZCwgcGFyYW1zLnVzZXIuZW1haWwsIHBhcmFtcy51c2VyLnVzZXJuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9jaGF0Jyk7IFxyXG4gICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7ICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxufV0pOyIsIi8vIEluamVjdCB0aGUgJGludGVyY2VwdG9yIHRvIGF2b2lkIGNpcmN1bGFyIGRlcGVuZGVuY2llc1xyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGluamVjdG9yJywgZnVuY3Rpb24gKCRxLCAkaW5qZWN0b3IpIHtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBBdXRvbWF0aWNhbGx5IGF0dGFjaCBBdXRob3JpemF0aW9uIGhlYWRlclxyXG4gICAgICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbiAoY29uZmlnKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICB2YXIgQXV0aFNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KCdBdXRoU2VydmljZScpO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoU2VydmljZS5nZXRUb2tlbigpO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWyd4LWFjY2Vzcy10b2tlbiddID0gdG9rZW47XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PVVURi04JztcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XHJcblxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICBcclxuICAgICAgICAgICAgLy8gSWYgYSB0b2tlbiB3YXMgc2VudCBiYWNrLCB0aGVuIHNhdmUgaXRcclxuICAgICAgICAgICAgcmVzcG9uc2U6IGZ1bmN0aW9uIChyZXMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IHJlcy5kYXRhLnRva2VuO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgQXV0aFNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KCdBdXRoU2VydmljZScpO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnNhdmVUb2tlbih0b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7XHJcbiAgICAgICAgICAgIH1cclxuICB9O1xyXG5cclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQXV0aFNlcnZpY2UnLCBbJyRodHRwJywgJyR3aW5kb3cnLCAnQXBpQmFzZVVybCcsIGZ1bmN0aW9uICgkaHR0cCwgJHdpbmRvdywgQXBpQmFzZVVybCkge1xyXG5cclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgICAgdmFyIGF1dGhTZXJ2aWNlID0ge307XHJcbiBcclxuICAgICAgLy8gU2F2ZSB0aGUgdG9rZW4gaW4gdGhlIGxvY2FsIHN0b3JhZ2VcclxuICAgICAgYXV0aFNlcnZpY2Uuc2F2ZVRva2VuID0gZnVuY3Rpb24odG9rZW4pIHtcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW4gPSB0b2tlbjtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHJpZXZlIHRoZSB0b2tlbiBpbiB0aGUgbG9jYWwgc3RvcmFnZVxyXG4gICAgICBhdXRoU2VydmljZS5nZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW47XHJcbiAgICAgIH07XHJcbiAgICAgICAgICAgXHJcbiAgICAgIC8vIExvZ2luIC0gTWFrZSBhIHJlcXVlc3QgdG8gdGhlIGFwaSBmb3IgYXV0aGVudGljYXRpbmcgICAgICBcclxuICAgICAgYXV0aFNlcnZpY2UubG9naW4gPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoQXBpQmFzZVVybCArICcvYXV0aGVudGljYXRlJywgY3JlZGVudGlhbHMpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gTG9nb3V0XHJcbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKGF1dGhTZXJ2aWNlLmdldFRva2VuKCkpIHtcclxuICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnand0VG9rZW4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZFxyXG4gICAgICBhdXRoU2VydmljZS5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBhdXRoU2VydmljZS5wYXJzZVRva2VuKHRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgdmFyIGRhdGVOb3cgPSBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgdG9rZW4gaGFzIG5vdCBleHBpcmVkXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlTm93IDw9IHBhcmFtcy5leHA7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUGFyc2UgdGhlIEpTT04gV2ViIFRva2VuXHJcbiAgICAgIGF1dGhTZXJ2aWNlLnBhcnNlVG9rZW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XHJcbiAgICAgICAgICAgIHZhciBiYXNlNjQgPSBiYXNlNjRVcmwucmVwbGFjZSgnLScsJysnKS5yZXBsYWNlKCdfJywnLycpO1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LmF0b2IoYmFzZTY0KSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXR1cm4gYXV0aFNlcnZpY2U7XHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ0NoYXRIaXN0b3J5U2VydmljZScsIFsnJGh0dHAnLCAnQXBpQmFzZVVybCcsIGZ1bmN0aW9uICgkaHR0cCwgQXBpQmFzZVVybCkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgdmFyIGNoYXRIaXN0b3J5U2VydmljZSA9IHt9O1xyXG5cclxuICAgICAgLy8gR2V0IHRoZSBjaGF0IGhpc3Rvcnkgb2YgYSBnaXZlbiBjaGF0cm9vbSBcclxuICAgICAgY2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tSGlzdG9yeSA9IGZ1bmN0aW9uIChjaGF0Um9vbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KEFwaUJhc2VVcmwgKyAnL2hpc3RvcnkvJyArIGNoYXRSb29tKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEdldCBhbGwgdGhlIGNoYXRyb29tcyB0aGF0IGhhdmUgaGlzdG9yeVxyXG4gICAgICBjaGF0SGlzdG9yeVNlcnZpY2UuZ2V0Q2hhdFJvb21zID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KEFwaUJhc2VVcmwgKyAnL2NoYXRyb29tJyk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXR1cm4gY2hhdEhpc3RvcnlTZXJ2aWNlO1xyXG59XSk7IiwiLy8gQ3JlYXRlIGEgbmV3IHNlcnZpY2UgZm9yIG1hbmFnaW5nIHdlYnNvY2tldHMgd2l0aCBzb2NrZXRJby4gXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnU29ja2V0U2VydmljZScsIFsnJHJvb3RTY29wZScsIGZ1bmN0aW9uICgkcm9vdFNjb3BlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICB2YXIgc29ja2V0U2VydmljZSA9IHt9O1xyXG5cclxuICAgICAgdmFyIHNvY2tldCA9IGlvLmNvbm5lY3QoKTtcclxuXHJcbiAgICAgIHNvY2tldFNlcnZpY2Uub24gPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQub24oZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHNvY2tldFNlcnZpY2UuZW1pdCA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGRhdGEsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXR1cm4gc29ja2V0U2VydmljZTtcclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBbJyRodHRwJywgJ0FwaUJhc2VVcmwnLCBmdW5jdGlvbiAoJGh0dHAsIEFwaUJhc2VVcmwpIHtcclxuXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICAgIHZhciB1c2VyU2VydmljZSA9IHt9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgLy8gUmVnaXN0ZXIgYSBuZXcgdXNlciAgICAgIFxyXG4gICAgICB1c2VyU2VydmljZS5yZWdpc3RlciA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChBcGlCYXNlVXJsICsgJy91c2VycycsIHsgJ3VzZXInOiB1c2VyIH0pO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHVzZXJTZXJ2aWNlO1xyXG59XSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9