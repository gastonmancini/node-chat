!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.constant("ApiBaseUrl","/api"),t.config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,r){r.interceptors.push("AuthInterceptor"),t.when("/login",{templateUrl:"/views/login.html",controller:"LoginController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}]),t.run(["$route","$rootScope","$location","AuthService",function(t,e,r,o){e.$on("$locationChangeStart",function(e,n,l){var i=r.path(),a=t.routes[i];a&&a.auth&&!o.isAuthed()&&r.path("/login")})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$window","$location","AuthService",function(e,t,r,n){"use strict";e.setCurrentUser=function(e,r,n){var o={_id:e,username:n,email:r};t.localStorage.setItem("currentUser",JSON.stringify(o))},e.getCurrentUser=function(){return JSON.parse(t.localStorage.getItem("currentUser"))},e.isAuthed=function(){return null!==n.isAuthed()&&n.isAuthed()!==!1},e.logout=function(){n.logout(),t.localStorage.removeItem("currentUser"),r.path("/login")}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","ChatHistoryService",function(e,o){"use strict";function r(){o.getChatRooms().then(function(o,r,t,a){e.chatRooms=o.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."}),t("Lobby")}function t(r){o.getChatRoomHistory(r).then(function(o,t,a,n){e.chatRoomName=r,e.chatLines=o.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."})}e.chatRoomName="Lobby",e.errorMessage="",r(),e.reloadHistory=function(e){return t(e)}}]);
angular.module("chatApp").controller("LoginController",["$scope","$location","AuthService",function(e,r,t){"use strict";e.credentials={email:"",password:""},e.errorMessage="",e.authenticate=function(a){t.login(a).then(function(a,n,o,s){var i=t.parseToken(a.data.token);e.setCurrentUser(i.user._id,i.user.email,i.user.username),r.path("/chat")},function(r,t,a,n){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location","UserService","AuthService",function(e,r,s,t,a){"use strict";e.user={email:"",username:"",password:""},e.errorMessage="",e.register=function(r){t.register(r).then(function(r,t,n,o){var u=a.parseToken(r.data.token);e.setCurrentUser(u.user._id,u.user.email,u.user.username),s.path("/chat")},function(r,s,t,a){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").factory("AuthInterceptor",["$injector",function(e){return{request:function(t){var n=e.get("AuthService"),r=n.getToken();return r&&(t.headers["x-access-token"]=r),t.headers["Content-Type"]="application/json; charset=UTF-8",t},response:function(t){var n=t.data.token,r=e.get("AuthService");return n&&r.saveToken(n),t}}}]);
angular.module("chatApp").factory("AuthService",["$http","$window","ApiBaseUrl",function(e,t,n){"use strict";var o={};return o.saveToken=function(e){t.localStorage.setItem("jwtToken",e)},o.getToken=function(){return t.localStorage.getItem("jwtToken")},o.login=function(t){return e.post(n+"/authenticate",t)},o.logout=function(){o.getToken()&&t.localStorage.removeItem("jwtToken")},o.isAuthed=function(){var e=o.getToken();if(e){var t=o.parseToken(e),n=Math.round((new Date).getTime()/1e3);return n<=t.exp}return!1},o.parseToken=function(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))},o}]);
angular.module("chatApp").factory("ChatHistoryService",["$http","ApiBaseUrl",function(t,r){"use strict";var o={};return o.getChatRoomHistory=function(o){return t.get(r+"/history/"+o)},o.getChatRooms=function(){return t.get(r+"/chatroom")},o}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
angular.module("chatApp").factory("UserService",["$http","ApiBaseUrl",function(r,e){"use strict";var t={};return t.register=function(t){return r.post(e+"/users",{user:t})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvY2hhdENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0SGlzdG9yeUNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9yZWdpc3RlckNvbnRyb2xsZXIuanMiLCJpbnRlcmNlcHRvcnMvYXV0aEludGVyY2VwdG9yLmpzIiwic2VydmljZXMvYXV0aFNlcnZpY2UuanMiLCJzZXJ2aWNlcy9jaGF0SGlzdG9yeVNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlclNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImF1dGgiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwicnVuIiwiJHJvdXRlIiwiJHJvb3RTY29wZSIsIiRsb2NhdGlvbiIsIkF1dGhTZXJ2aWNlIiwiJG9uIiwiZXYiLCJuZXh0IiwiY3VycmVudCIsIm5leHRQYXRoIiwicGF0aCIsIm5leHRSb3V0ZSIsInJvdXRlcyIsImlzQXV0aGVkIiwiJHNjb3BlIiwiJHdpbmRvdyIsInNldEN1cnJlbnRVc2VyIiwiX2lkIiwiZW1haWwiLCJ1c2VybmFtZSIsIm1lIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRDdXJyZW50VXNlciIsInBhcnNlIiwiZ2V0SXRlbSIsImxvZ291dCIsInJlbW92ZUl0ZW0iLCIkc2NlIiwiU29ja2V0U2VydmljZSIsInByb2Nlc3NVc2VySW5wdXQiLCJtZXNzYWdlIiwic3lzdGVtTWVzc2FnZSIsImNoYXJBdCIsInByb2Nlc3NDb21tYW5kIiwibWVzc2FnZXMiLCJzZW5kTWVzc2FnZSIsInJvb20iLCJpbnB1dE1lc3NhZ2UiLCJ0ZXh0IiwiZW1pdCIsImNoYW5nZVJvb20iLCJuZXdSb29tIiwiY29tbWFuZCIsIndvcmRzIiwic3BsaXQiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsInNoaWZ0Iiwiam9pbiIsIm5hbWUiLCJyb29tTGlzdCIsIm5ld1Jvb21FcnJvciIsIm9uIiwicmVzdWx0Iiwic3VjY2VzcyIsInJvb21zIiwic2V0SW50ZXJ2YWwiLCJzdWJtaXQiLCJmb2N1c0NoYXRyb29tIiwiY3JlYXRlTmV3Q2hhdHJvb20iLCIkIiwibW9kYWwiLCJzYW5pdGl6ZUh0bWwiLCJ2YWx1ZSIsInRydXN0QXNIdG1sIiwiQ2hhdEhpc3RvcnlTZXJ2aWNlIiwibG9hZERlZmF1bHREYXRhIiwiZ2V0Q2hhdFJvb21zIiwidGhlbiIsInJlc3BvbnNlIiwic3RhdHVzIiwiaGVhZGVycyIsImNoYXRSb29tcyIsImRhdGEiLCJlcnJvck1lc3NhZ2UiLCJnZXRIaXN0b3J5IiwiY2hhdFJvb20iLCJnZXRDaGF0Um9vbUhpc3RvcnkiLCJjaGF0Um9vbU5hbWUiLCJjaGF0TGluZXMiLCJyZWxvYWRIaXN0b3J5IiwiY3JlZGVudGlhbHMiLCJwYXNzd29yZCIsImF1dGhlbnRpY2F0ZSIsImxvZ2luIiwicGFyYW1zIiwicGFyc2VUb2tlbiIsInRva2VuIiwidXNlciIsIiRodHRwIiwiVXNlclNlcnZpY2UiLCJyZWdpc3RlciIsImZhY3RvcnkiLCIkaW5qZWN0b3IiLCJyZXF1ZXN0IiwiZ2V0IiwiZ2V0VG9rZW4iLCJyZXMiLCJzYXZlVG9rZW4iLCJBcGlCYXNlVXJsIiwiYXV0aFNlcnZpY2UiLCJwb3N0IiwiZGF0ZU5vdyIsIk1hdGgiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwiYmFzZTY0VXJsIiwiYmFzZTY0IiwicmVwbGFjZSIsImF0b2IiLCJjaGF0SGlzdG9yeVNlcnZpY2UiLCJzb2NrZXRTZXJ2aWNlIiwic29ja2V0IiwiaW8iLCJjb25uZWN0IiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiLCJ1c2VyU2VydmljZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FFQSxZQUlBLElBQUlBLEdBQU1DLFFBQVFDLE9BQU8sV0FBWSxVQUFXLGNBR2hERixHQUFJRyxTQUFTLGFBQWMsUUFHM0JILEVBQUlJLFFBQVEsaUJBQWtCLG9CQUFxQixnQkFBaUIsU0FBVUMsRUFBZ0JDLEVBQW1CQyxHQUszR0EsRUFBY0MsYUFBYUMsS0FBSyxtQkFFaENKLEVBQ09LLEtBQUssVUFDTkMsWUFBYSxvQkFDYkMsV0FBWSxrQkFDWkMsTUFBTSxJQUVMSCxLQUFLLFNBQ05DLFlBQWEsbUJBQ2JDLFdBQVksaUJBQ1pDLE1BQU0sSUFFTEgsS0FBSyxZQUNOQyxZQUFhLDBCQUNiQyxXQUFZLHdCQUNaQyxNQUFNLElBRUxILEtBQUssYUFDTkMsWUFBYSx1QkFDYkMsV0FBWSxxQkFDWkMsTUFBTSxJQUdYQyxXQUFZQyxXQUFZLGNBSS9CZixFQUFJZ0IsS0FBSyxTQUFVLGFBQWMsWUFBYSxjQUFlLFNBQVVDLEVBQVFDLEVBQVlDLEVBQVdDLEdBRWpHRixFQUFXRyxJQUFJLHVCQUF3QixTQUFTQyxFQUFJQyxFQUFNQyxHQUNyRCxHQUFJQyxHQUFXTixFQUFVTyxPQUNyQkMsRUFBWVYsRUFBT1csT0FBT0gsRUFFMUJFLElBQWFBLEVBQVVkLE9BQVNPLEVBQVlTLFlBQzlDVixFQUFVTyxLQUFLO0FDbkQzQnpCLFFBQVFDLE9BQU8sV0FBV1UsV0FBVyx5QkFBMEIsU0FBVSxVQUFXLFlBQWEsY0FBZSxTQUFVa0IsRUFBUUMsRUFBU1osRUFBV0MsR0FFaEosWUFHQVUsR0FBT0UsZUFBaUIsU0FBU0MsRUFBS0MsRUFBT0MsR0FDdkMsR0FBSUMsSUFDRUgsSUFBS0EsRUFDTEUsU0FBVUEsRUFDVkQsTUFBT0EsRUFFYkgs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QUNsQ0osRUFBTzlELEdBQUdpRSxFQUFXLFdBQ2YsR0FBSUUsR0FBT0MsU0FDWDFILEdBQVcySCxPQUFPLFdBQ1pILEVBQVNJLE1BQU1SLEVBQVFLLFFBS3pDTixFQUFjM0UsS0FBTyxTQUFVK0UsRUFBVzVDLEVBQU02QyxHQUMxQ0osRUFBTzVFLEtBQUsrRSxFQUFXNUMsRUFBTSxXQUN2QixHQUFJOEMsR0FBT0MsU0FDWDFILEdBQVcySCxPQUFPLFdBQ1JILEdBQ0RBLEVBQVNJLE1BQU1SLEVBQVFLLFFBTXJDTjtBQzdCYnBJLFFBQVFDLE9BQU8sV0FBVzhHLFFBQVEsZUFBZ0IsUUFBUyxhQUFjLFNBQVVILEVBQU9VLEdBRXBGLFlBRUEsSUFBSXdCLEtBT0osT0FKQUEsR0FBWWhDLFNBQVcsU0FBVUgsR0FDN0IsTUFBT0MsR0FBTVksS0FBS0YsRUFBYSxVQUFZWCxLQUFRQSxLQUdoRG1DIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtcclxuICAgIFxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG4gICAgXHJcbi8vIERlY2xhcmUgYXBwIGxldmVsIG1vZHVsZVxyXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnLCBbJ25nUm91dGUnLCAnbmdTYW5pdGl6ZSddKTtcclxuXHJcbi8vIERlZmluZSBhIGNvbnN0YW50IHdpdGggdGhlIEFQSSBiYXNlIHVybFxyXG5hcHAuY29uc3RhbnQoJ0FwaUJhc2VVcmwnLCAnL2FwaScpO1xyXG5cclxuLy8gQ29uZmlndXJlIHRoZSBhcHBsaWNhdGlvbiByb3V0ZXNcclxuYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZW1vdmUgdGhlIGhhc2ggZnJvbSB1cmxcclxuICAgICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG4gICAgICBcclxuICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXV0aEludGVyY2VwdG9yJyk7XHJcbiAgICAgIFxyXG4gICAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgICAgICAud2hlbignL2xvZ2luJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IGZhbHNlXHJcbiAgICAgIH0pXHJcbiAgICAgICAgICAgIC53aGVuKCcvY2hhdCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY2hhdC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0NoYXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogdHJ1ZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL2hpc3RvcnknLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NoYXRIaXN0b3J5Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ2hhdEhpc3RvcnlDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgYXV0aDogdHJ1ZVxyXG4gICAgICB9KVxyXG4gICAgICAgICAgICAud2hlbignL3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWdpc3Rlci5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIGF1dGg6IGZhbHNlXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICAub3RoZXJ3aXNlKHsgcmVkaXJlY3RUbzogJy9sb2dpbicgfSk7XHJcbn1dKTtcclxuXHJcbi8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWQsIGFuZCBpZiBub3QgcmVkaXJlY3QgdG8gdGhlIGxvZ2luIHBhZ2VcclxuYXBwLnJ1bihbJyRyb3V0ZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkcm91dGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgQXV0aFNlcnZpY2UpIHtcclxuICAgXHJcbiAgICAgJHJvb3RTY29wZS4kb24oJyRsb2NhdGlvbkNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oZXYsIG5leHQsIGN1cnJlbnQpIHtcclxuICAgICAgICAgIHZhciBuZXh0UGF0aCA9ICRsb2NhdGlvbi5wYXRoKCk7XHJcbiAgICAgICAgICB2YXIgbmV4dFJvdXRlID0gJHJvdXRlLnJvdXRlc1tuZXh0UGF0aF07IFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAobmV4dFJvdXRlICYmIG5leHRSb3V0ZS5hdXRoICYmICFBdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTsgICAgICAgICAgXHJcbiAgICAgICAgICB9XHJcbiAgICAgIFxyXG4gICAgIH0pO1xyXG4gICAgXHJcbn1dKTtcclxuXHJcbn0pKCk7XHJcbiIsIi8vIENvbnRhaW5lciBmb3IgdGhlIGdsb2JhbCBhcHBsaWNhdGlvbiBsb2dpYyAvIEFsdGVybmF0aXZlIHRvIHRoZSBBbmd1bGFyJ3MgcnVuIGZ1bmN0aW9uXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuY29udHJvbGxlcignQXBwbGljYXRpb25Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJHdpbmRvdycsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkd2luZG93LCAkbG9jYXRpb24sIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBTdG9yZSBjdXJyZW50IHVzZXIgaW5mb1xyXG4gICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbihfaWQsIGVtYWlsLCB1c2VybmFtZSkge1xyXG4gICAgICAgICAgICB2YXIgbWUgPSB7XHJcbiAgICAgICAgICAgICAgICAgIF9pZDogX2lkLFxyXG4gICAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbFxyXG4gICAgICAgICAgICB9OyBcclxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImN1cnJlbnRVc2VyXCIsIEpTT04uc3RyaW5naWZ5KG1lKSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZXRyaWV2ZSBjdXJyZW50IHVzZXIgaW5mb1xyXG4gICAgICAkc2NvcGUuZ2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImN1cnJlbnRVc2VyXCIpKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcclxuICAgICAgJHNjb3BlLmlzQXV0aGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gQXV0aFNlcnZpY2UuaXNBdXRoZWQoKSAhPT0gbnVsbCAmJiBBdXRoU2VydmljZS5pc0F1dGhlZCgpICE9PSBmYWxzZTsgICAgIFxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gTG9nb3V0IGZyb20gdGhlIGNoYXRcclxuICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UubG9nb3V0KCk7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2N1cnJlbnRVc2VyJyk7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgfTtcclxufV0pOyAgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdDaGF0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnJHNjZScsICdTb2NrZXRTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgJHNjZSwgU29ja2V0U2VydmljZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICRzY29wZS5yb29tTGlzdCA9IFtdO1xyXG4gICAgICAkc2NvcGUucm9vbSA9ICdMb2JieSc7XHJcbiAgICAgICRzY29wZS5pbnB1dE1lc3NhZ2UgPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb20gPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgbmFtZS1jaGFuZ2UgYXR0ZW1wdFxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCduYW1lUmVzdWx0JywgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgXHR2YXIgbWVzc2FnZTtcclxuICAgICAgICAgIFx0XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ1lvdSBhcmUgbm93IGtub3duIGFzICcgKyByZXN1bHQubmFtZSArICcuJztcclxuICAgICAgICAgIFx0fSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IHJlc3VsdC5tZXNzYWdlO1xyXG4gICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgcm9vbSBjaGFuZ2UgICAgICAgXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ2pvaW5SZXN1bHQnLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICBcdCRzY29wZS5yb29tID0gcmVzdWx0LnJvb207XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaCgnWW91IGFyZSBub3cgaW4gdGhlIHJvb20gJyArIHJlc3VsdC5yb29tKTtcclxuICAgICAgfSk7ICAgIFxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIERpc3BsYXkgcmVjZWl2ZWQgbWVzc2FnZXNcclxuICAgICAgU29ja2V0U2VydmljZS5vbignbWVzc2FnZScsIGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UudGV4dCk7XHJcbiAgICAgIH0pOyAgICBcdFx0XHRcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IGxpc3Qgb2Ygcm9vbXMgYXZhaWxhYmxlXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ3Jvb21zJywgZnVuY3Rpb24gKHJvb21zKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yb29tTGlzdCA9IFtdO1xyXG4gICAgICAgICAgXHRmb3IgKHZhciByb29tIGluIHJvb21zKSB7XHJcbiAgICAgICAgICAgICAgICByb29tID0gcm9vbS5zdWJzdHJpbmcoMSwgcm9vbS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvb20gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJvb21MaXN0LnB1c2gocm9vbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICBcdH1cclxuXHJcbiAgICAgIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIFJlcXVlc3QgbGlzdCBvZiByb29tcyBhdmFpbGFibGUgaW50ZXJtaXR0ZW50bHlcclxuICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ3Jvb21zJyk7XHJcbiAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIEFsbG93IHN1Ym1pdHRpbmcgdGhlIGZvcm0gdG8gc2VuZCBhIGNoYXQgbWVzc2FnZVxyXG4gICAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICBcdHByb2Nlc3NVc2VySW5wdXQobWVzc2FnZSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBBbGxvdyBjbGljayBhIHJvb20gbmFtZSB0byBjaGFuZ2UgdG8gdGhhdCBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuZm9jdXNDaGF0cm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcblx0XHRwcm9jZXNzQ29tbWFuZCgnL2pvaW4gJyArIHJvb20pO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goJ1Jvb20gY2hhbmdlZC4nKTtcclxuXHR9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuY3JlYXRlTmV3Q2hhdHJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICBpZiAoIXJvb20pIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IHRydWU7XHJcblx0ICAgICAgfSBlbHNlIHtcclxuICAgICAgXHRcdCBwcm9jZXNzVXNlcklucHV0KFwiL2pvaW4gXCIgKyByb29tKTtcclxuICAgICAgXHQgIFx0ICQoJyNteU1vZGFsJykubW9kYWwoJ2hpZGUnKTtcclxuICAgICAgXHRcdCAkc2NvcGUubmV3Um9vbUVycm9yID0gZmFsc2U7XHJcbiAgICAgIFx0fVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gU2FuaXppdGUgSHRtbFxyXG4gICAgICAkc2NvcGUuc2FuaXRpemVIdG1sID0gZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh2YWx1ZSk7XHJcbiAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBQcml2YXRlIGhlbHBlcnNcclxuICAgICAgICovXHJcbiAgICAgIFxyXG4gICAgICAvLyBQcm9jZXNzIHRoZSBpbnB1dCBcclxuICAgICAgZnVuY3Rpb24gcHJvY2Vzc1VzZXJJbnB1dChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHZhciBzeXN0ZW1NZXNzYWdlO1xyXG4gICAgICAgICAgXHRcclxuICAgICAgICAgICAgLy8gSWYgdXNlciBpbnB1dCBiZWdpbnMgd2l0aCBzbGFzaCwgdHJlYXQgaXQgYXMgY29tbWFuZFxyXG4gICAgICAgICAgICBpZiAobWVzc2FnZS5jaGFyQXQoMCkgPT0gJy8nKSB7XHJcbiAgICAgICAgICAgICAgICAgIHN5c3RlbU1lc3NhZ2UgPSBwcm9jZXNzQ29tbWFuZChtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKHN5c3RlbU1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goc3lzdGVtTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgLy8gQnJvYWRjYXN0IG5vbmNvbW1hbmQgaW5wdXQgdG8gb3RoZXIgdXNlcnNcclxuICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2UoJHNjb3BlLnJvb20sIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChcIk1lOiBcIiArIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaW5wdXRNZXNzYWdlID0gJyc7XHJcbiAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAvLyBTZW5kIGNoYXQgbWVzc2FnZXNcclxuICAgICAgZnVuY3Rpb24gc2VuZE1lc3NhZ2Uocm9vbSwgdGV4dCkge1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgcm9vbTogcm9vbSxcclxuICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ21lc3NhZ2UnLCBtZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgICBcdFxyXG4gICAgICAvLyBDaGFuZ2Ugcm9vbXNcclxuICAgICAgZnVuY3Rpb24gY2hhbmdlUm9vbShyb29tKSB7XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnam9pbicsIHtcclxuICAgICAgICAgICAgICAgICAgbmV3Um9vbTogcm9vbVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBcdFxyXG4gICAgICAvLyBQcm9jZXNzaW5nIGNoYXQgY29tbWFuZHNcclxuICAgICAgZnVuY3Rpb24gcHJvY2Vzc0NvbW1hbmQoY29tbWFuZCkge1xyXG4gICAgICAgICAgICB2YXIgd29yZHMgPSBjb21tYW5kLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgIC8vIFBhcnNlIGNvbW1hbmQgZnJvbSBmaXJzdCB3b3JkXHJcbiAgICAgICAgICAgIGNvbW1hbmQgPSB3b3Jkc1swXVxyXG4gICAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKDEsIHdvcmRzWzBdLmxlbmd0aClcclxuICAgICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gZmFsc2U7XHJcbiAgXHJcbiAgICAgICAgICAgIHN3aXRjaCAoY29tbWFuZCkge1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICdqb2luJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvb20gPSB3b3Jkcy5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSByb29tIGNoYW5naW5nIC8gY3JlYXRpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlUm9vbShyb29tKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ25pY2snOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3Jkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHdvcmRzLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIG5hbWUtY2hhbmdlIGF0dGVtcHRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnbmFtZUF0dGVtcHQnLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBtZXNzYWdlIGlmIGNvbW1hbmQgaXNuJ3QgcmVjb2duaXplZCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdVbnJlY29nbml6ZWQgY29tbWFuZC4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICAgIH1cclxuXHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0NoYXRIaXN0b3J5Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ0NoYXRIaXN0b3J5U2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsIENoYXRIaXN0b3J5U2VydmljZSkge1xyXG4gICAgXHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9ICdMb2JieSc7ICAgICAgICBcclxuICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnJztcclxuXHJcbiAgICBsb2FkRGVmYXVsdERhdGEoKTtcclxuICAgIFxyXG4gICAgJHNjb3BlLnJlbG9hZEhpc3RvcnkgPSBmdW5jdGlvbiAoY2hhdFJvb20pIHtcclxuICAgICAgICByZXR1cm4gZ2V0SGlzdG9yeShjaGF0Um9vbSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBsb2FkRGVmYXVsdERhdGEoKSB7XHJcbiAgICAgICAgQ2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tcygpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jaGF0Um9vbXMgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICB9LGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnQW4gZXJyb3Igb2N1cnJlZCByZXRyaWV2aW5nIHRoZSBoaXN0b3J5LiBQbGVhc2UgcmVsb2FkIGRlIHBhZ2UuJztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZ2V0SGlzdG9yeSgnTG9iYnknKTsgICAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBnZXRIaXN0b3J5KGNoYXRSb29tKSB7XHJcbiAgICAgICAgQ2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tSGlzdG9yeShjaGF0Um9vbSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9IGNoYXRSb29tO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXRMaW5lcyA9IHJlc3BvbnNlLmRhdGE7ICAgICAgIFxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ0FuIGVycm9yIG9jdXJyZWQgcmV0cmlldmluZyB0aGUgaGlzdG9yeS4gUGxlYXNlIHJlbG9hZCBkZSBwYWdlLic7ICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIGNyZWRlbnRpYWxzXHJcbiAgICAgICRzY29wZS5jcmVkZW50aWFscyA9IHtcclxuICAgICAgICAgICAgZW1haWw6ICcnLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogJydcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgdGhlIGVycm9yIG1lc3NhZ2VcclxuICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgLy8gQXV0aGVudGljYXRlIFxyXG4gICAgICAkc2NvcGUuYXV0aGVudGljYXRlID0gZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBUcnkgdG8gbG9naW4gXHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ2luKGNyZWRlbnRpYWxzKVxyXG4gICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBBdXRoU2VydmljZS5wYXJzZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIocGFyYW1zLnVzZXIuX2lkLCBwYXJhbXMudXNlci5lbWFpbCwgcGFyYW1zLnVzZXIudXNlcm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NoYXQnKTtcclxuICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlOyAgICAgIFxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbn1dKTsgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdSZWdpc3RlckNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCAnVXNlclNlcnZpY2UnLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCBVc2VyU2VydmljZSwgQXV0aFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgdGhlIFVzZXJcclxuICAgICAgJHNjb3BlLnVzZXIgPSB7XHJcbiAgICAgICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICAgICAgdXNlcm5hbWU6ICcnLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogJydcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgcmVnaXN0cmF0aW9uIGVycm9yIG1lc3NhZ2VcclxuICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgLy8gUmVnaXN0ZXIgYSBuZXcgdXNlclxyXG4gICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVHJ5IHRvIHJlZ2lzdGVyIFxyXG4gICAgICAgICAgICBVc2VyU2VydmljZS5yZWdpc3Rlcih1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBBdXRoU2VydmljZS5wYXJzZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIocGFyYW1zLnVzZXIuX2lkLCBwYXJhbXMudXNlci5lbWFpbCwgcGFyYW1zLnVzZXIudXNlcm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NoYXQnKTsgXHJcbiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTsgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG59XSk7IiwiLy8gSW5qZWN0IHRoZSAkaW50ZXJjZXB0b3IgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jaWVzXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgWyckaW5qZWN0b3InLCBmdW5jdGlvbiAoJGluamVjdG9yKSB7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQXV0b21hdGljYWxseSBhdHRhY2ggQXV0aG9yaXphdGlvbiBoZWFkZXJcclxuICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIEF1dGhTZXJ2aWNlID0gJGluamVjdG9yLmdldCgnQXV0aFNlcnZpY2UnKTtcclxuICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFNlcnZpY2UuZ2V0VG9rZW4oKTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1sneC1hY2Nlc3MtdG9rZW4nXSA9IHRva2VuO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCc7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgXHJcbiAgICAgICAgICAgIC8vIElmIGEgdG9rZW4gd2FzIHNlbnQgYmFjaywgdGhlbiBzYXZlIGl0XHJcbiAgICAgICAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbiAocmVzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSByZXMuZGF0YS50b2tlbjtcclxuICAgICAgICAgICAgICAgICAgdmFyIEF1dGhTZXJ2aWNlID0gJGluamVjdG9yLmdldCgnQXV0aFNlcnZpY2UnKTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBdXRoU2VydmljZS5zYXZlVG9rZW4odG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgICAgICB9XHJcbiAgfTtcclxuXHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgWyckaHR0cCcsICckd2luZG93JywgJ0FwaUJhc2VVcmwnLCBmdW5jdGlvbiAoJGh0dHAsICR3aW5kb3csIEFwaUJhc2VVcmwpIHtcclxuXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICAgIHZhciBhdXRoU2VydmljZSA9IHt9O1xyXG4gXHJcbiAgICAgIC8vIFNhdmUgdGhlIHRva2VuIGluIHRoZSBsb2NhbCBzdG9yYWdlXHJcbiAgICAgIGF1dGhTZXJ2aWNlLnNhdmVUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2p3dFRva2VuJywgdG9rZW4pO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUmV0cmlldmUgdGhlIHRva2VuIGluIHRoZSBsb2NhbCBzdG9yYWdlXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmdldFRva2VuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdqd3RUb2tlbicpO1xyXG4gICAgICB9O1xyXG4gICAgICAgICAgIFxyXG4gICAgICAvLyBMb2dpbiAtIE1ha2UgYSByZXF1ZXN0IHRvIHRoZSBhcGkgZm9yIGF1dGhlbnRpY2F0aW5nICAgICAgXHJcbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luID0gZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KEFwaUJhc2VVcmwgKyAnL2F1dGhlbnRpY2F0ZScsIGNyZWRlbnRpYWxzKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIExvZ291dFxyXG4gICAgICBhdXRoU2VydmljZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5nZXRUb2tlbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2p3dFRva2VuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcclxuICAgICAgYXV0aFNlcnZpY2UuaXNBdXRoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBhdXRoU2VydmljZS5nZXRUb2tlbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gYXV0aFNlcnZpY2UucGFyc2VUb2tlbih0b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBkYXRlTm93ID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHRva2VuIGhhcyBub3QgZXhwaXJlZFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZU5vdyA8PSBwYXJhbXMuZXhwO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFBhcnNlIHRoZSBKU09OIFdlYiBUb2tlblxyXG4gICAgICBhdXRoU2VydmljZS5wYXJzZVRva2VuID0gZnVuY3Rpb24gKHRva2VuKSB7XHJcbiAgICAgICAgICAgIHZhciBiYXNlNjRVcmwgPSB0b2tlbi5zcGxpdCgnLicpWzFdO1xyXG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCcrJykucmVwbGFjZSgnXycsJy8nKTtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlO1xyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdDaGF0SGlzdG9yeVNlcnZpY2UnLCBbJyRodHRwJywgJ0FwaUJhc2VVcmwnLCBmdW5jdGlvbiAoJGh0dHAsIEFwaUJhc2VVcmwpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIHZhciBjaGF0SGlzdG9yeVNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgY2hhdCBoaXN0b3J5IG9mIGEgZ2l2ZW4gY2hhdHJvb20gXHJcbiAgICAgIGNoYXRIaXN0b3J5U2VydmljZS5nZXRDaGF0Um9vbUhpc3RvcnkgPSBmdW5jdGlvbiAoY2hhdFJvb20pIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChBcGlCYXNlVXJsICsgJy9oaXN0b3J5LycgKyBjaGF0Um9vbSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBHZXQgYWxsIHRoZSBjaGF0cm9vbXMgdGhhdCBoYXZlIGhpc3RvcnlcclxuICAgICAgY2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChBcGlCYXNlVXJsICsgJy9jaGF0cm9vbScpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIGNoYXRIaXN0b3J5U2VydmljZTtcclxufV0pOyIsIi8vIENyZWF0ZSBhIG5ldyBzZXJ2aWNlIGZvciBtYW5hZ2luZyB3ZWJzb2NrZXRzIHdpdGggc29ja2V0SW8uIFxyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ1NvY2tldFNlcnZpY2UnLCBbJyRyb290U2NvcGUnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSkge1xyXG4gICAgICBcclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgdmFyIHNvY2tldFNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KCk7XHJcblxyXG4gICAgICBzb2NrZXRTZXJ2aWNlLm9uID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIHNvY2tldFNlcnZpY2U7XHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgWyckaHR0cCcsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRodHRwLCBBcGlCYXNlVXJsKSB7XHJcblxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICB2YXIgdXNlclNlcnZpY2UgPSB7fTtcclxuICAgICAgICAgICAgXHJcbiAgICAgIC8vIFJlZ2lzdGVyIGEgbmV3IHVzZXIgICAgICBcclxuICAgICAgdXNlclNlcnZpY2UucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoQXBpQmFzZVVybCArICcvdXNlcnMnLCB7ICd1c2VyJzogdXNlciB9KTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB1c2VyU2VydmljZTtcclxufV0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==