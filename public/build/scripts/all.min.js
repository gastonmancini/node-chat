!function(){"use strict";var t=angular.module("chatApp",["ngRoute","ngSanitize"]);t.constant("ApiBaseUrl","/api"),t.config(["$routeProvider","$locationProvider","$httpProvider",function(t,e,r){r.interceptors.push("AuthInterceptor"),t.when("/login",{templateUrl:"/views/login.html",controller:"LoginController",auth:!1}).when("/chat",{templateUrl:"/views/chat.html",controller:"ChatController",auth:!0}).when("/history",{templateUrl:"/views/chatHistory.html",controller:"ChatHistoryController",auth:!0}).when("/register",{templateUrl:"/views/register.html",controller:"RegisterController",auth:!1}).otherwise({redirectTo:"/login"})}]),t.run(["$route","$rootScope","$location","AuthService",function(t,e,r,o){e.$on("$locationChangeStart",function(e,n,l){var i=r.path(),a=t.routes[i];a&&a.auth&&!o.isAuthed()&&r.path("/login")})}])}();
angular.module("chatApp").controller("ApplicationController",["$scope","$window","$location","AuthService",function(e,t,r,n){"use strict";e.setCurrentUser=function(e,r,n){var o={_id:e,username:n,email:r};t.localStorage.setItem("currentUser",JSON.stringify(o))},e.getCurrentUser=function(){return JSON.parse(t.localStorage.getItem("currentUser"))},e.isAuthed=function(){return null!==n.isAuthed()&&n.isAuthed()!==!1},e.logout=function(){n.logout(),t.localStorage.removeItem("currentUser"),r.path("/login")}}]);
angular.module("chatApp").controller("ChatController",["$scope","$window","$sce","SocketService",function(o,e,s,n){"use strict";function t(e){var s;"/"==e.charAt(0)?(s=m(e),s&&o.messages.push(s)):(r(o.room,e),o.messages.push("Me: "+e)),o.inputMessage=""}function r(o,e){var s={room:o,text:e};n.emit("message",s)}function a(o){n.emit("join",{newRoom:o})}function m(o){var e=o.split(" ");o=e[0].substring(1,e[0].length).toLowerCase();var s=!1;switch(o){case"join":e.shift();var t=e.join(" ");a(t);break;case"nick":e.shift();var r=e.join(" ");n.emit("nameAttempt",r);break;default:s="Unrecognized command."}return s}o.messages=[],o.roomList=[],o.room="Lobby",o.inputMessage="",o.newRoom="",o.newRoomError=!1,n.on("nameResult",function(e){var s;s=e.success?"You are now known as "+e.name+".":e.message,o.messages.push(s)}),n.on("joinResult",function(e){o.room=e.room,o.messages=[],o.messages.push("You are now in the room "+e.room)}),n.on("message",function(e){o.messages.push(e.text)}),n.on("rooms",function(e){o.roomList=[];for(var s in e)s=s.substring(1,s.length),""!==s&&o.roomList.push(s)}),setInterval(function(){n.emit("rooms")},1e3),o.submit=function(o){t(o)},o.focusChatroom=function(e){m("/join "+e),o.messages=[],o.messages.push("Room changed.")},o.createNewChatroom=function(e){e?(t("/join "+e),$("#myModal").modal("hide"),o.newRoomError=!1):o.newRoomError=!0},o.sanitizeHtml=function(o){return s.trustAsHtml(o)}}]);
angular.module("chatApp").controller("ChatHistoryController",["$scope","ChatHistoryService",function(e,o){"use strict";function r(){o.getChatRooms().then(function(o,r,t,a){e.chatRooms=o.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."}),t("Lobby")}function t(r){o.getChatRoomHistory(r).then(function(o,t,a,n){e.chatRoomName=r,e.chatLines=o.data},function(o,r,t,a){e.errorMessage="An error ocurred retrieving the history. Please reload de page."})}e.chatRoomName="Lobby",e.errorMessage="",r(),e.reloadHistory=function(e){return t(e)}}]);
angular.module("chatApp").controller("LoginController",["$scope","$location","AuthService",function(e,r,t){"use strict";e.credentials={email:"",password:""},e.errorMessage="",e.authenticate=function(a){t.login(a).then(function(a,n,o,s){var i=t.parseToken(a.data.token);e.setCurrentUser(i.user._id,i.user.email,i.user.username),r.path("/chat")},function(r,t,a,n){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").controller("RegisterController",["$scope","$http","$location","UserService","AuthService",function(e,r,s,t,a){"use strict";e.user={email:"",username:"",password:""},e.errorMessage="",e.register=function(r){t.register(r).then(function(r,t,n,o){var u=a.parseToken(r.data.token);e.setCurrentUser(u.user._id,u.user.email,u.user.username),s.path("/chat")},function(r,s,t,a){e.errorMessage=r.data.message})}}]);
angular.module("chatApp").factory("AuthInterceptor",["$injector",function(e){return{request:function(t){var n=e.get("AuthService"),r=n.getToken();return r&&(t.headers["x-access-token"]=r),t.headers["Content-Type"]="application/json; charset=UTF-8",t},response:function(t){var n=t.data.token,r=e.get("AuthService");return n&&r.saveToken(n),t}}}]);
angular.module("chatApp").factory("AuthService",["$http","$window","ApiBaseUrl",function(e,t,n){"use strict";var o={};return o.saveToken=function(e){t.localStorage.setItem("jwtToken",e)},o.getToken=function(){return t.localStorage.getItem("jwtToken")},o.login=function(t){return e.post(n+"/authenticate",t)},o.logout=function(){o.getToken()&&t.localStorage.removeItem("jwtToken")},o.isAuthed=function(){var e=o.getToken();if(e){var t=o.parseToken(e),n=Math.round((new Date).getTime()/1e3);return n<=t.exp}return!1},o.parseToken=function(e){var n=e.split(".")[1],o=n.replace("-","+").replace("_","/");return JSON.parse(t.atob(o))},o}]);
angular.module("chatApp").factory("ChatHistoryService",["$http","ApiBaseUrl",function(t,r){"use strict";var o={};return o.getChatRoomHistory=function(o){return t.get(r+"/history/"+o)},o.getChatRooms=function(){return t.get(r+"/chatroom")},o}]);
angular.module("chatApp").factory("SocketService",["$rootScope",function(n){"use strict";var t={},o=io.connect();return t.on=function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},t.emit=function(t,c,a){o.emit(t,c,function(){var t=arguments;n.$apply(function(){a&&a.apply(o,t)})})},t}]);
angular.module("chatApp").factory("UserService",["$http","ApiBaseUrl",function(r,e){"use strict";var t={};return t.register=function(t){return r.post(e+"/users",{user:t})},t}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiY29udHJvbGxlcnMvYXBwbGljYXRpb25Db250cm9sbGVyLmpzIiwiY29udHJvbGxlcnMvY2hhdENvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9jaGF0SGlzdG9yeUNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9sb2dpbkNvbnRyb2xsZXIuanMiLCJjb250cm9sbGVycy9yZWdpc3RlckNvbnRyb2xsZXIuanMiLCJpbnRlcmNlcHRvcnMvYXV0aEludGVyY2VwdG9yLmpzIiwic2VydmljZXMvYXV0aFNlcnZpY2UuanMiLCJzZXJ2aWNlcy9jaGF0SGlzdG9yeVNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zb2NrZXRTZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlclNlcnZpY2UuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRodHRwUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImF1dGgiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwicnVuIiwiJHJvdXRlIiwiJHJvb3RTY29wZSIsIiRsb2NhdGlvbiIsIkF1dGhTZXJ2aWNlIiwiJG9uIiwiZXYiLCJuZXh0IiwiY3VycmVudCIsIm5leHRQYXRoIiwicGF0aCIsIm5leHRSb3V0ZSIsInJvdXRlcyIsImlzQXV0aGVkIiwiJHNjb3BlIiwiJHdpbmRvdyIsInNldEN1cnJlbnRVc2VyIiwiX2lkIiwiZW1haWwiLCJ1c2VybmFtZSIsIm1lIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRDdXJyZW50VXNlciIsInBhcnNlIiwiZ2V0SXRlbSIsImxvZ291dCIsInJlbW92ZUl0ZW0iLCIkc2NlIiwiU29ja2V0U2VydmljZSIsInByb2Nlc3NVc2VySW5wdXQiLCJtZXNzYWdlIiwic3lzdGVtTWVzc2FnZSIsImNoYXJBdCIsInByb2Nlc3NDb21tYW5kIiwibWVzc2FnZXMiLCJzZW5kTWVzc2FnZSIsInJvb20iLCJpbnB1dE1lc3NhZ2UiLCJ0ZXh0IiwiZW1pdCIsImNoYW5nZVJvb20iLCJuZXdSb29tIiwiY29tbWFuZCIsIndvcmRzIiwic3BsaXQiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsInNoaWZ0Iiwiam9pbiIsIm5hbWUiLCJyb29tTGlzdCIsIm5ld1Jvb21FcnJvciIsIm9uIiwicmVzdWx0Iiwic3VjY2VzcyIsInJvb21zIiwic2V0SW50ZXJ2YWwiLCJzdWJtaXQiLCJmb2N1c0NoYXRyb29tIiwiY3JlYXRlTmV3Q2hhdHJvb20iLCIkIiwibW9kYWwiLCJzYW5pdGl6ZUh0bWwiLCJ2YWx1ZSIsInRydXN0QXNIdG1sIiwiQ2hhdEhpc3RvcnlTZXJ2aWNlIiwibG9hZERlZmF1bHREYXRhIiwiZ2V0Q2hhdFJvb21zIiwidGhlbiIsInJlc3BvbnNlIiwic3RhdHVzIiwiaGVhZGVycyIsImNoYXRSb29tcyIsImRhdGEiLCJlcnJvck1lc3NhZ2UiLCJnZXRIaXN0b3J5IiwiY2hhdFJvb20iLCJnZXRDaGF0Um9vbUhpc3RvcnkiLCJjaGF0Um9vbU5hbWUiLCJjaGF0TGluZXMiLCJyZWxvYWRIaXN0b3J5IiwiY3JlZGVudGlhbHMiLCJwYXNzd29yZCIsImF1dGhlbnRpY2F0ZSIsImxvZ2luIiwicGFyYW1zIiwicGFyc2VUb2tlbiIsInRva2VuIiwidXNlciIsIiRodHRwIiwiVXNlclNlcnZpY2UiLCJyZWdpc3RlciIsImZhY3RvcnkiLCIkaW5qZWN0b3IiLCJyZXF1ZXN0IiwiZ2V0IiwiZ2V0VG9rZW4iLCJyZXMiLCJzYXZlVG9rZW4iLCJBcGlCYXNlVXJsIiwiYXV0aFNlcnZpY2UiLCJwb3N0IiwiZGF0ZU5vdyIsIk1hdGgiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwiYmFzZTY0VXJsIiwiYmFzZTY0IiwicmVwbGFjZSIsImF0b2IiLCJjaGF0SGlzdG9yeVNlcnZpY2UiLCJzb2NrZXRTZXJ2aWNlIiwic29ja2V0IiwiaW8iLCJjb25uZWN0IiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiLCJ1c2VyU2VydmljZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FFRSxZQUlBLElBQUlBLEdBQU1DLFFBQVFDLE9BQU8sV0FBWSxVQUFXLGNBR2hERixHQUFJRyxTQUFTLGFBQWMsUUFHM0JILEVBQUlJLFFBQVEsaUJBQWtCLG9CQUFxQixnQkFBaUIsU0FBVUMsRUFBZ0JDLEVBQW1CQyxHQUsvR0EsRUFBY0MsYUFBYUMsS0FBSyxtQkFFaENKLEVBQ0dLLEtBQUssVUFDTkMsWUFBYSxvQkFDYkMsV0FBWSxrQkFDWkMsTUFBTSxJQUVMSCxLQUFLLFNBQ05DLFlBQWEsbUJBQ2JDLFdBQVksaUJBQ1pDLE1BQU0sSUFFTEgsS0FBSyxZQUNOQyxZQUFhLDBCQUNiQyxXQUFZLHdCQUNaQyxNQUFNLElBRUxILEtBQUssYUFDTkMsWUFBYSx1QkFDYkMsV0FBWSxxQkFDWkMsTUFBTSxJQUdMQyxXQUFZQyxXQUFZLGNBSTdCZixFQUFJZ0IsS0FBSyxTQUFVLGFBQWMsWUFBYSxjQUFlLFNBQVVDLEVBQVFDLEVBQVlDLEVBQVdDLEdBRXBHRixFQUFXRyxJQUFJLHVCQUF3QixTQUFVQyxFQUFJQyxFQUFNQyxHQUN6RCxHQUFJQyxHQUFXTixFQUFVTyxPQUNyQkMsRUFBWVYsRUFBT1csT0FBT0gsRUFFMUJFLElBQWFBLEVBQVVkLE9BQVNPLEVBQVlTLFlBQzlDVixFQUFVTyxLQUFLO0FDbkR2QnpCLFFBQVFDLE9BQU8sV0FBV1UsV0FBVyx5QkFBMEIsU0FBVSxVQUFXLFlBQWEsY0FBZSxTQUFVa0IsRUFBUUMsRUFBU1osRUFBV0MsR0FFaEosWUFHQVUsR0FBT0UsZUFBaUIsU0FBVUMsRUFBS0MsRUFBT0MsR0FDeEMsR0FBSUMsSUFDRUgsSUFBS0EsRUFDTEUsU0FBVUEsRUFDVkQsTUFBT0EsRUFFYkgs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bENKLEVBQU85RCxHQUFHaUUsRUFBVyxXQUNmLEdBQUlFLEdBQU9DLFNBQ1gxSCxHQUFXMkgsT0FBTyxXQUNaSCxFQUFTSSxNQUFNUixFQUFRSyxRQUt6Q04sRUFBYzNFLEtBQU8sU0FBVStFLEVBQVc1QyxFQUFNNkMsR0FDMUNKLEVBQU81RSxLQUFLK0UsRUFBVzVDLEVBQU0sV0FDdkIsR0FBSThDLEdBQU9DLFNBQ1gxSCxHQUFXMkgsT0FBTyxXQUNSSCxHQUNEQSxFQUFTSSxNQUFNUixFQUFRSyxRQU1yQ047QUM3QmJwSSxRQUFRQyxPQUFPLFdBQVc4RyxRQUFRLGVBQWdCLFFBQVMsYUFBYyxTQUFVSCxFQUFPVSxHQUVwRixZQUVBLElBQUl3QixLQU9KLE9BSkFBLEdBQVloQyxTQUFXLFNBQVVILEdBQzdCLE1BQU9DLEdBQU1ZLEtBQUtGLEVBQWEsVUFBWVgsS0FBUUEsS0FHaERtQyIsImZpbGUiOiJhbGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFxyXG4gIC8vIERlY2xhcmUgYXBwIGxldmVsIG1vZHVsZVxyXG4gIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcsIFsnbmdSb3V0ZScsICduZ1Nhbml0aXplJ10pO1xyXG5cclxuICAvLyBEZWZpbmUgYSBjb25zdGFudCB3aXRoIHRoZSBBUEkgYmFzZSB1cmxcclxuICBhcHAuY29uc3RhbnQoJ0FwaUJhc2VVcmwnLCAnL2FwaScpO1xyXG5cclxuICAvLyBDb25maWd1cmUgdGhlIGFwcGxpY2F0aW9uIHJvdXRlc1xyXG4gIGFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlcicsICckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJGh0dHBQcm92aWRlcikge1xyXG4gICAgICBcclxuICAgIC8vIFJlbW92ZSB0aGUgaGFzaCBmcm9tIHVybFxyXG4gICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG4gICAgICBcclxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG5cclxuICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgIC53aGVuKCcvbG9naW4nLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2xvZ2luLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJyxcclxuICAgICAgYXV0aDogZmFsc2VcclxuICAgIH0pXHJcbiAgICAgIC53aGVuKCcvY2hhdCcsIHtcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY2hhdC5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ0NoYXRDb250cm9sbGVyJyxcclxuICAgICAgYXV0aDogdHJ1ZVxyXG4gICAgfSlcclxuICAgICAgLndoZW4oJy9oaXN0b3J5Jywge1xyXG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jaGF0SGlzdG9yeS5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ0NoYXRIaXN0b3J5Q29udHJvbGxlcicsXHJcbiAgICAgIGF1dGg6IHRydWVcclxuICAgIH0pXHJcbiAgICAgIC53aGVuKCcvcmVnaXN0ZXInLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlZ2lzdGVyLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAnUmVnaXN0ZXJDb250cm9sbGVyJyxcclxuICAgICAgYXV0aDogZmFsc2VcclxuICAgIH0pXHJcblxyXG4gICAgICAub3RoZXJ3aXNlKHsgcmVkaXJlY3RUbzogJy9sb2dpbicgfSk7XHJcbiAgfV0pO1xyXG5cclxuICAvLyBDaGVjayBpZiB0aGUgdXNlciBpcyBhdXRoZW50aWNhdGVkLCBhbmQgaWYgbm90IHJlZGlyZWN0IHRvIHRoZSBsb2dpbiBwYWdlXHJcbiAgYXBwLnJ1bihbJyRyb3V0ZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkcm91dGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgQXV0aFNlcnZpY2UpIHtcclxuXHJcbiAgICAkcm9vdFNjb3BlLiRvbignJGxvY2F0aW9uQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXYsIG5leHQsIGN1cnJlbnQpIHtcclxuICAgICAgdmFyIG5leHRQYXRoID0gJGxvY2F0aW9uLnBhdGgoKTtcclxuICAgICAgdmFyIG5leHRSb3V0ZSA9ICRyb3V0ZS5yb3V0ZXNbbmV4dFBhdGhdO1xyXG5cclxuICAgICAgaWYgKG5leHRSb3V0ZSAmJiBuZXh0Um91dGUuYXV0aCAmJiAhQXV0aFNlcnZpY2UuaXNBdXRoZWQoKSkge1xyXG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICB9XSk7XHJcblxyXG59KSgpO1xyXG4iLCIvLyBDb250YWluZXIgZm9yIHRoZSBnbG9iYWwgYXBwbGljYXRpb24gbG9naWMgLyBBbHRlcm5hdGl2ZSB0byB0aGUgQW5ndWxhcidzIHJ1biBmdW5jdGlvblxyXG5hbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnJGxvY2F0aW9uJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgJGxvY2F0aW9uLCBBdXRoU2VydmljZSkge1xyXG5cclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgICBcclxuICAgICAgLy8gU3RvcmUgY3VycmVudCB1c2VyIGluZm9cclxuICAgICAgJHNjb3BlLnNldEN1cnJlbnRVc2VyID0gZnVuY3Rpb24gKF9pZCwgZW1haWwsIHVzZXJuYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciBtZSA9IHtcclxuICAgICAgICAgICAgICAgICAgX2lkOiBfaWQsXHJcbiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjdXJyZW50VXNlclwiLCBKU09OLnN0cmluZ2lmeShtZSkpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUmV0cmlldmUgY3VycmVudCB1c2VyIGluZm9cclxuICAgICAgJHNjb3BlLmdldEN1cnJlbnRVc2VyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VycmVudFVzZXJcIikpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZFxyXG4gICAgICAkc2NvcGUuaXNBdXRoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5pc0F1dGhlZCgpICE9PSBudWxsICYmIEF1dGhTZXJ2aWNlLmlzQXV0aGVkKCkgIT09IGZhbHNlO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gTG9nb3V0IGZyb20gdGhlIGNoYXRcclxuICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgQXV0aFNlcnZpY2UubG9nb3V0KCk7XHJcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2N1cnJlbnRVc2VyJyk7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgfTtcclxufV0pOyAgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdDaGF0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJyR3aW5kb3cnLCAnJHNjZScsICdTb2NrZXRTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgJHNjZSwgU29ja2V0U2VydmljZSkge1xyXG5cclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgICAgJHNjb3BlLm1lc3NhZ2VzID0gW107XHJcbiAgICAgICRzY29wZS5yb29tTGlzdCA9IFtdO1xyXG4gICAgICAkc2NvcGUucm9vbSA9ICdMb2JieSc7XHJcbiAgICAgICRzY29wZS5pbnB1dE1lc3NhZ2UgPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb20gPSAnJztcclxuICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgbmFtZS1jaGFuZ2UgYXR0ZW1wdFxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCduYW1lUmVzdWx0JywgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgdmFyIG1lc3NhZ2U7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdZb3UgYXJlIG5vdyBrbm93biBhcyAnICsgcmVzdWx0Lm5hbWUgKyAnLic7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlID0gcmVzdWx0Lm1lc3NhZ2U7XHJcbiAgICB9XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSByZXN1bHRzIG9mIGEgcm9vbSBjaGFuZ2UgICAgICAgXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ2pvaW5SZXN1bHQnLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAkc2NvcGUucm9vbSA9IHJlc3VsdC5yb29tO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goJ1lvdSBhcmUgbm93IGluIHRoZSByb29tICcgKyByZXN1bHQucm9vbSk7XHJcbiAgICAgIH0pOyAgICBcclxuICAgICAgICAgIFxyXG4gICAgICAvLyBEaXNwbGF5IHJlY2VpdmVkIG1lc3NhZ2VzXHJcbiAgICAgIFNvY2tldFNlcnZpY2Uub24oJ21lc3NhZ2UnLCBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChtZXNzYWdlLnRleHQpO1xyXG4gICAgICB9KTsgICAgXHRcdFx0XHJcbiAgICAgICAgICBcclxuICAgICAgLy8gRGlzcGxheSBsaXN0IG9mIHJvb21zIGF2YWlsYWJsZVxyXG4gICAgICBTb2NrZXRTZXJ2aWNlLm9uKCdyb29tcycsIGZ1bmN0aW9uIChyb29tcykge1xyXG4gICAgICAgICAgICAkc2NvcGUucm9vbUxpc3QgPSBbXTtcclxuICAgIGZvciAodmFyIHJvb20gaW4gcm9vbXMpIHtcclxuICAgICAgcm9vbSA9IHJvb20uc3Vic3RyaW5nKDEsIHJvb20ubGVuZ3RoKTtcclxuICAgICAgaWYgKHJvb20gIT09ICcnKSB7XHJcbiAgICAgICAgJHNjb3BlLnJvb21MaXN0LnB1c2gocm9vbSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAgIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIFJlcXVlc3QgbGlzdCBvZiByb29tcyBhdmFpbGFibGUgaW50ZXJtaXR0ZW50bHlcclxuICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBTb2NrZXRTZXJ2aWNlLmVtaXQoJ3Jvb21zJyk7XHJcbiAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIEFsbG93IHN1Ym1pdHRpbmcgdGhlIGZvcm0gdG8gc2VuZCBhIGNoYXQgbWVzc2FnZVxyXG4gICAgICAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgIHByb2Nlc3NVc2VySW5wdXQobWVzc2FnZSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBBbGxvdyBjbGljayBhIHJvb20gbmFtZSB0byBjaGFuZ2UgdG8gdGhhdCBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuZm9jdXNDaGF0cm9vbSA9IGZ1bmN0aW9uIChyb29tKSB7XHJcbiAgICBwcm9jZXNzQ29tbWFuZCgnL2pvaW4gJyArIHJvb20pO1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2VzLnB1c2goJ1Jvb20gY2hhbmdlZC4nKTtcclxuICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXRlIG5ldyBjaGF0cm9vbVxyXG4gICAgICAkc2NvcGUuY3JlYXRlTmV3Q2hhdHJvb20gPSBmdW5jdGlvbiAocm9vbSkge1xyXG4gICAgICAgICAgICBpZiAoIXJvb20pIHtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLm5ld1Jvb21FcnJvciA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwcm9jZXNzVXNlcklucHV0KFwiL2pvaW4gXCIgKyByb29tKTtcclxuICAgICAgJCgnI215TW9kYWwnKS5tb2RhbCgnaGlkZScpO1xyXG4gICAgICAkc2NvcGUubmV3Um9vbUVycm9yID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBTYW5peml0ZSBIdG1sXHJcbiAgICAgICRzY29wZS5zYW5pdGl6ZUh0bWwgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHZhbHVlKTtcclxuICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgLyoqXHJcbiAgICAgICAqIFByaXZhdGUgaGVscGVyc1xyXG4gICAgICAgKi9cclxuICAgICAgXHJcbiAgICAgIC8vIFByb2Nlc3MgdGhlIGlucHV0IFxyXG4gICAgICBmdW5jdGlvbiBwcm9jZXNzVXNlcklucHV0KG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdmFyIHN5c3RlbU1lc3NhZ2U7XHJcbiAgICAgICAgICBcdFxyXG4gICAgICAgICAgICAvLyBJZiB1c2VyIGlucHV0IGJlZ2lucyB3aXRoIHNsYXNoLCB0cmVhdCBpdCBhcyBjb21tYW5kXHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlLmNoYXJBdCgwKSA9PSAnLycpIHtcclxuICAgICAgICAgICAgICAgICAgc3lzdGVtTWVzc2FnZSA9IHByb2Nlc3NDb21tYW5kKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAoc3lzdGVtTWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZXMucHVzaChzeXN0ZW1NZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAvLyBCcm9hZGNhc3Qgbm9uY29tbWFuZCBpbnB1dCB0byBvdGhlciB1c2Vyc1xyXG4gICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZSgkc2NvcGUucm9vbSwgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlcy5wdXNoKFwiTWU6IFwiICsgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5pbnB1dE1lc3NhZ2UgPSAnJztcclxuICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgIC8vIFNlbmQgY2hhdCBtZXNzYWdlc1xyXG4gICAgICBmdW5jdGlvbiBzZW5kTWVzc2FnZShyb29tLCB0ZXh0KSB7XHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICByb29tOiByb29tLFxyXG4gICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnbWVzc2FnZScsIG1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICAgIFx0XHJcbiAgICAgIC8vIENoYW5nZSByb29tc1xyXG4gICAgICBmdW5jdGlvbiBjaGFuZ2VSb29tKHJvb20pIHtcclxuICAgICAgICAgICAgU29ja2V0U2VydmljZS5lbWl0KCdqb2luJywge1xyXG4gICAgICAgICAgICAgICAgICBuZXdSb29tOiByb29tXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFx0XHJcbiAgICAgIC8vIFByb2Nlc3NpbmcgY2hhdCBjb21tYW5kc1xyXG4gICAgICBmdW5jdGlvbiBwcm9jZXNzQ29tbWFuZChjb21tYW5kKSB7XHJcbiAgICAgICAgICAgIHZhciB3b3JkcyA9IGNvbW1hbmQuc3BsaXQoJyAnKTtcclxuICAgICAgICAgICAgLy8gUGFyc2UgY29tbWFuZCBmcm9tIGZpcnN0IHdvcmRcclxuICAgICAgICAgICAgY29tbWFuZCA9IHdvcmRzWzBdXHJcbiAgICAgICAgICAgICAgICAgIC5zdWJzdHJpbmcoMSwgd29yZHNbMF0ubGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoY29tbWFuZCkge1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICdqb2luJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvb20gPSB3b3Jkcy5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSByb29tIGNoYW5naW5nIC8gY3JlYXRpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlUm9vbShyb29tKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ25pY2snOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3Jkcy5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHdvcmRzLmpvaW4oJyAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIG5hbWUtY2hhbmdlIGF0dGVtcHRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFNvY2tldFNlcnZpY2UuZW1pdCgnbmFtZUF0dGVtcHQnLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBtZXNzYWdlIGlmIGNvbW1hbmQgaXNuJ3QgcmVjb2duaXplZCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICdVbnJlY29nbml6ZWQgY29tbWFuZC4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICAgIH1cclxuXHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmNvbnRyb2xsZXIoJ0NoYXRIaXN0b3J5Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ0NoYXRIaXN0b3J5U2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsIENoYXRIaXN0b3J5U2VydmljZSkge1xyXG4gICAgXHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9ICdMb2JieSc7ICAgICAgICBcclxuICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnJztcclxuXHJcbiAgICBsb2FkRGVmYXVsdERhdGEoKTtcclxuICAgIFxyXG4gICAgJHNjb3BlLnJlbG9hZEhpc3RvcnkgPSBmdW5jdGlvbiAoY2hhdFJvb20pIHtcclxuICAgICAgICByZXR1cm4gZ2V0SGlzdG9yeShjaGF0Um9vbSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBsb2FkRGVmYXVsdERhdGEoKSB7XHJcbiAgICAgICAgQ2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tcygpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jaGF0Um9vbXMgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICB9LGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvck1lc3NhZ2UgPSAnQW4gZXJyb3Igb2N1cnJlZCByZXRyaWV2aW5nIHRoZSBoaXN0b3J5LiBQbGVhc2UgcmVsb2FkIGRlIHBhZ2UuJztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZ2V0SGlzdG9yeSgnTG9iYnknKTsgICAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBnZXRIaXN0b3J5KGNoYXRSb29tKSB7XHJcbiAgICAgICAgQ2hhdEhpc3RvcnlTZXJ2aWNlLmdldENoYXRSb29tSGlzdG9yeShjaGF0Um9vbSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXRSb29tTmFtZSA9IGNoYXRSb29tO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXRMaW5lcyA9IHJlc3BvbnNlLmRhdGE7ICAgICAgIFxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gJ0FuIGVycm9yIG9jdXJyZWQgcmV0cmlldmluZyB0aGUgaGlzdG9yeS4gUGxlYXNlIHJlbG9hZCBkZSBwYWdlLic7ICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgIFxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJbml0aWFsaXplIGNyZWRlbnRpYWxzXHJcbiAgICAgICRzY29wZS5jcmVkZW50aWFscyA9IHtcclxuICAgICAgICAgICAgZW1haWw6ICcnLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogJydcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgdGhlIGVycm9yIG1lc3NhZ2VcclxuICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgLy8gQXV0aGVudGljYXRlIFxyXG4gICAgICAkc2NvcGUuYXV0aGVudGljYXRlID0gZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBUcnkgdG8gbG9naW4gXHJcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ2luKGNyZWRlbnRpYWxzKVxyXG4gICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBBdXRoU2VydmljZS5wYXJzZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIocGFyYW1zLnVzZXIuX2lkLCBwYXJhbXMudXNlci5lbWFpbCwgcGFyYW1zLnVzZXIudXNlcm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NoYXQnKTtcclxuICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JNZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlOyAgICAgIFxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbn1dKTsgIiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5jb250cm9sbGVyKCdSZWdpc3RlckNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCAnVXNlclNlcnZpY2UnLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCBVc2VyU2VydmljZSwgQXV0aFNlcnZpY2UpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgdGhlIFVzZXJcclxuICAgICAgJHNjb3BlLnVzZXIgPSB7XHJcbiAgICAgICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICAgICAgdXNlcm5hbWU6ICcnLFxyXG4gICAgICAgICAgICBwYXNzd29yZDogJydcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgcmVnaXN0cmF0aW9uIGVycm9yIG1lc3NhZ2VcclxuICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgLy8gUmVnaXN0ZXIgYSBuZXcgdXNlclxyXG4gICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVHJ5IHRvIHJlZ2lzdGVyIFxyXG4gICAgICAgICAgICBVc2VyU2VydmljZS5yZWdpc3Rlcih1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBBdXRoU2VydmljZS5wYXJzZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIocGFyYW1zLnVzZXIuX2lkLCBwYXJhbXMudXNlci5lbWFpbCwgcGFyYW1zLnVzZXIudXNlcm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NoYXQnKTsgXHJcbiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yTWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTsgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG59XSk7IiwiLy8gSW5qZWN0IHRoZSAkaW50ZXJjZXB0b3IgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jaWVzXHJcbmFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgWyckaW5qZWN0b3InLCBmdW5jdGlvbiAoJGluamVjdG9yKSB7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQXV0b21hdGljYWxseSBhdHRhY2ggQXV0aG9yaXphdGlvbiBoZWFkZXJcclxuICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgdmFyIEF1dGhTZXJ2aWNlID0gJGluamVjdG9yLmdldCgnQXV0aFNlcnZpY2UnKTtcclxuICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFNlcnZpY2UuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1sneC1hY2Nlc3MtdG9rZW4nXSA9IHRva2VuO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCc7XHJcblxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgXHJcbiAgICAgICAgICAgIC8vIElmIGEgdG9rZW4gd2FzIHNlbnQgYmFjaywgdGhlbiBzYXZlIGl0XHJcbiAgICAgICAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbiAocmVzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSByZXMuZGF0YS50b2tlbjtcclxuICAgICAgICAgICAgICAgICAgdmFyIEF1dGhTZXJ2aWNlID0gJGluamVjdG9yLmdldCgnQXV0aFNlcnZpY2UnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBBdXRoU2VydmljZS5zYXZlVG9rZW4odG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgICAgICB9XHJcbiAgfTtcclxuXHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnY2hhdEFwcCcpLmZhY3RvcnkoJ0F1dGhTZXJ2aWNlJywgWyckaHR0cCcsICckd2luZG93JywgJ0FwaUJhc2VVcmwnLCBmdW5jdGlvbiAoJGh0dHAsICR3aW5kb3csIEFwaUJhc2VVcmwpIHtcclxuXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICAgIHZhciBhdXRoU2VydmljZSA9IHt9O1xyXG4gXHJcbiAgICAgIC8vIFNhdmUgdGhlIHRva2VuIGluIHRoZSBsb2NhbCBzdG9yYWdlXHJcbiAgICAgIGF1dGhTZXJ2aWNlLnNhdmVUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdqd3RUb2tlbicsIHRva2VuKTtcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHJpZXZlIHRoZSB0b2tlbiBpbiB0aGUgbG9jYWwgc3RvcmFnZVxyXG4gICAgICBhdXRoU2VydmljZS5nZXRUb2tlbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2p3dFRva2VuJyk7XHJcbiAgICAgIH07XHJcbiAgICAgICAgICAgXHJcbiAgICAgIC8vIExvZ2luIC0gTWFrZSBhIHJlcXVlc3QgdG8gdGhlIGFwaSBmb3IgYXV0aGVudGljYXRpbmcgICAgICBcclxuICAgICAgYXV0aFNlcnZpY2UubG9naW4gPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoQXBpQmFzZVVybCArICcvYXV0aGVudGljYXRlJywgY3JlZGVudGlhbHMpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gTG9nb3V0XHJcbiAgICAgIGF1dGhTZXJ2aWNlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKGF1dGhTZXJ2aWNlLmdldFRva2VuKCkpIHtcclxuICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnand0VG9rZW4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHVzZXIgaXMgYXV0aGVudGljYXRlZFxyXG4gICAgICBhdXRoU2VydmljZS5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBhdXRoU2VydmljZS5wYXJzZVRva2VuKHRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgdmFyIGRhdGVOb3cgPSBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XHJcbiAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgdG9rZW4gaGFzIG5vdCBleHBpcmVkXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlTm93IDw9IHBhcmFtcy5leHA7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUGFyc2UgdGhlIEpTT04gV2ViIFRva2VuXHJcbiAgICAgIGF1dGhTZXJ2aWNlLnBhcnNlVG9rZW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XHJcbiAgICAgICAgICAgIHZhciBiYXNlNjQgPSBiYXNlNjRVcmwucmVwbGFjZSgnLScsICcrJykucmVwbGFjZSgnXycsICcvJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cuYXRvYihiYXNlNjQpKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBhdXRoU2VydmljZTtcclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdjaGF0QXBwJykuZmFjdG9yeSgnQ2hhdEhpc3RvcnlTZXJ2aWNlJywgWyckaHR0cCcsICdBcGlCYXNlVXJsJywgZnVuY3Rpb24gKCRodHRwLCBBcGlCYXNlVXJsKSB7XHJcblxyXG4gICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICB2YXIgY2hhdEhpc3RvcnlTZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIGNoYXQgaGlzdG9yeSBvZiBhIGdpdmVuIGNoYXRyb29tIFxyXG4gICAgICBjaGF0SGlzdG9yeVNlcnZpY2UuZ2V0Q2hhdFJvb21IaXN0b3J5ID0gZnVuY3Rpb24gKGNoYXRSb29tKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvaGlzdG9yeS8nICsgY2hhdFJvb20pO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gR2V0IGFsbCB0aGUgY2hhdHJvb21zIHRoYXQgaGF2ZSBoaXN0b3J5XHJcbiAgICAgIGNoYXRIaXN0b3J5U2VydmljZS5nZXRDaGF0Um9vbXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoQXBpQmFzZVVybCArICcvY2hhdHJvb20nKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBjaGF0SGlzdG9yeVNlcnZpY2U7XHJcbn1dKTsiLCIvLyBDcmVhdGUgYSBuZXcgc2VydmljZSBmb3IgbWFuYWdpbmcgd2Vic29ja2V0cyB3aXRoIHNvY2tldElvLiBcclxuYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdTb2NrZXRTZXJ2aWNlJywgWyckcm9vdFNjb3BlJywgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcclxuICAgICAgXHJcbiAgICAgICd1c2Ugc3RyaWN0JztcclxuICAgICAgXHJcbiAgICAgIHZhciBzb2NrZXRTZXJ2aWNlID0ge307XHJcblxyXG4gICAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCgpO1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5vbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgc29ja2V0U2VydmljZS5lbWl0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0LmVtaXQoZXZlbnROYW1lLCBkYXRhLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBzb2NrZXRTZXJ2aWNlO1xyXG59XSk7IiwiYW5ndWxhci5tb2R1bGUoJ2NoYXRBcHAnKS5mYWN0b3J5KCdVc2VyU2VydmljZScsIFsnJGh0dHAnLCAnQXBpQmFzZVVybCcsIGZ1bmN0aW9uICgkaHR0cCwgQXBpQmFzZVVybCkge1xyXG5cclxuICAgICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgICAgdmFyIHVzZXJTZXJ2aWNlID0ge307XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAvLyBSZWdpc3RlciBhIG5ldyB1c2VyICAgICAgXHJcbiAgICAgIHVzZXJTZXJ2aWNlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KEFwaUJhc2VVcmwgKyAnL3VzZXJzJywgeyAndXNlcic6IHVzZXIgfSk7XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gdXNlclNlcnZpY2U7XHJcbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=